{
    "componentChunkName": "component---src-templates-post-tsx",
    "path": "/tao-rest-api-tren-nodejs-voi-express-va-prisma-su-dung-typescript",
    "result": {"data":{"post":{"headings":[{"depth":2},{"depth":2},{"depth":3},{"depth":3},{"depth":3},{"depth":3},{"depth":3},{"depth":3},{"depth":3},{"depth":3},{"depth":3},{"depth":3},{"depth":3},{"depth":3},{"depth":3},{"depth":3},{"depth":3},{"depth":2}],"frontmatter":{"title":"Tạo REST API trên Nodejs với Express và Prisma sử dụng Typescript","path":"/tao-rest-api-tren-nodejs-voi-express-va-prisma-su-dung-typescript","tags":["Nodejs","Boilerplate","Typescript","Express","Prisma","Docker","Postgres"],"excerpt":"Ngoại trừ vợ chính dotNET, mình thi thoảng chơi vợ 2 PHP, hôm nay công việc yêu cầu build 1 em REST API trên nodejs để làm việc với vài thư viện web3, nên mình build luôn 1 boilerplate Nodejs đơn giản để sẵn sau này đỡ phải dựng lại.","created":"2022-03-10T00:00:00.000Z","createdPretty":"10 March, 2022","updated":"2022-03-10T00:00:00.000Z","updatedPretty":"10 March, 2022","featuredImage":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABh0lEQVQoz4WRTUsCQRjH/UDRrW4do0unDn2AvkDktUvQLahOVnSoiKICxS7RpReyF8oyLVk11zfStDW33dnR0d2Z55nQhSBq7XcZGOY385//45M/iRRpWPk8TBnnBQuxu4MoOcg/8blL75gElEOBlM9/55u5HVhKCkQH5PojW4qyJ427F/WTR9Yz49vqxG5uci9vC/ho4ci2MREkNQr/yChxcFkZDqSnQsX5s6rOuPoJkVfnusLzhgD0iP3N/nN95e59J06OX0wOqDF8s3jZdGpUeP7Zhdh1s6NQJwVI3IRptTi3Gp4NhDdCpwjCU7YFy+iXBSOhfFw8aSfMYVLKh2R2bHpt1L+1sHkk0Vtuc5rVb+6roWg1mNCOOqIlpRQASibnXzy4jac8C3PbyhvRrH5dMmMlM9YtH6DRaLCmpeYKZc0gzc4/hRFb09sVG8AGtAEIpW/1um4autkyabufjL2RcSmuGtqlRlSL5WgnZlg1h3yPs9/L3bQSbRQCu3BADsB7Vf2WvwBAq5ySdj5nKQAAAABJRU5ErkJggg==","aspectRatio":1.6666666666666667,"src":"/static/b6a6328b68b15b23ccb59561960eaa13/90823/nodejs-express-posgres-prisma-boilerplate.png","srcSet":"/static/b6a6328b68b15b23ccb59561960eaa13/dc47e/nodejs-express-posgres-prisma-boilerplate.png 200w,\n/static/b6a6328b68b15b23ccb59561960eaa13/9f2d5/nodejs-express-posgres-prisma-boilerplate.png 400w,\n/static/b6a6328b68b15b23ccb59561960eaa13/90823/nodejs-express-posgres-prisma-boilerplate.png 800w,\n/static/b6a6328b68b15b23ccb59561960eaa13/02d1c/nodejs-express-posgres-prisma-boilerplate.png 1000w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"html":"<h2 id=\"lời-mở-đầu\" style=\"position:relative;\"><a href=\"#l%E1%BB%9Di-m%E1%BB%9F-%C4%91%E1%BA%A7u\" aria-label=\"lời mở đầu permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Lời mở đầu</h2>\n<p>Thế giới của lập trình viên web đang hết sức quen thuộc với những \"containerized application\", hay nói cách khác bây giờ đang là thời đại của microservice, và vì thế mỗi service chúng ta có thể chọn dùng dotNET, java, hay Nodejs tuỳ vào mục đích và nhu cầu của từng service.</p>\n<p>Ngoại trừ vợ chính dotNET, mình thi thoảng chơi vợ 2 PHP, hôm nay công việc yêu cầu build 1 Nodejs REST API để làm việc với vài thư viện web3, nên mình build luôn 1 boilerplate Nodejs đơn giản để sẵn sau này đỡ phải dựng lại.</p>\n<p>Template này mình sẽ sử dụng Express làm backend framework, thêm vào đó sẽ sử dụng Prisma làm ORM để thao tác với dữ liệu PostgresQL, code bằng Typescript, dùng docker để deploy. Ok, let's get started.</p>\n<p>Update: Mình đã up code lên git, các bạn có thể xem output cuối cùng ở đây: <a href=\"https://github.com/kienmatu/express-prisma-typescript-boilerplate\">express-prisma-typescript-boilerplate</a></p>\n<h2 id=\"bắt-tay-vào-dựng-nodejs-service\" style=\"position:relative;\"><a href=\"#b%E1%BA%AFt-tay-v%C3%A0o-d%E1%BB%B1ng-nodejs-service\" aria-label=\"bắt tay vào dựng nodejs service permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Bắt tay vào dựng Nodejs Service</h2>\n<h3 id=\"setup-project\" style=\"position:relative;\"><a href=\"#setup-project\" aria-label=\"setup project permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup project</h3>\n<p>Tạo folder có tên \"express-prisma-typescript-boilerplate\", dùng vscode mở nó lên, [mấy pha tạo folder hay file này mình thấy dùng windows hơi bất tiện, nếu dùng linux thì vài dòng bash là xong rồi].</p>\n<p>Đầu tiên mình có vài config cần thêm vào, đó chính là prettier config để format code theo đúng chuẩn, tránh trường hợp conflict code giữa anh em trong team.</p>\n<p>Trong folder <strong>\"express-prisma-typescript-boilerplate\"</strong>, tạo file .prettierrc.json, folder .vscode, trong đó tạo settings.json</p>\n<p>Cấu trúc như sau:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">├── .vscode\n│   └── settings.json\n└── .prettierrc.json</code></pre></div>\n<p>Sửa nội dung file settings.json để dùng prettier làm trình formatter mặc định:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"editor.defaultFormatter\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"esbenp.prettier-vscode\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>File .prettierrc.json (Đây là những thứ mình config, các bạn có thể tìm docs và config theo ý mình ở <a href=\"https://prettier.io/\">https://prettier.io/</a>)</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"trailingComma\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"all\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"tabWidth\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"semi\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"singleQuote\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"khởi-tạo-nodejs-project\" style=\"position:relative;\"><a href=\"#kh%E1%BB%9Fi-t%E1%BA%A1o-nodejs-project\" aria-label=\"khởi tạo nodejs project permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Khởi tạo Nodejs project</h3>\n<p>Tất nhiên rồi, trước khi chúng ta có thể code, thì phải khởi tạo package.json để config info cho project cũng như cho phép chúng ta cài đặt các dependencies. Ở đây mình dùng npm, ai xài yarn có thể chạy lệnh tương tự.</p>\n<p>Trong vsCode, mở terminal bằng tổ hợp <strong>Ctrl</strong> + <strong>~</strong>\nChạy command:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> init</code></pre></div>\n<p>Terminal sẽ nhảy yêu cầu nhập thông tin, ta điền các thông tin phù hợp, các field khác có thể bỏ qua, tuy nhiên hãy để main là \"src/index.ts\". Đây là file của mình sau khi nhập xong:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"express-prisma-typescript-boilerplate\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0.0\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"main\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"src/index.ts\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"author\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"kienmatu\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"license\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ISC\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"repository\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"git\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"git+https://github.com/kienmatu/express-prisma-typescript-boilerplate.git\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"cài-typescript\" style=\"position:relative;\"><a href=\"#c%C3%A0i-typescript\" aria-label=\"cài typescript permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cài Typescript</h3>\n<p>Chạy lệnh sau để cài dependency typescript cho project:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> i typescript</code></pre></div>\n<p>Chạy xong thì bạn sẽ thấy typescript được thêm vào package.json:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token comment\">//...</span>\n<span class=\"token property\">\"dependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"typescript\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^4.6.2\"</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"khởi-tạo-tsconfigjson\" style=\"position:relative;\"><a href=\"#kh%E1%BB%9Fi-t%E1%BA%A1o-tsconfigjson\" aria-label=\"khởi tạo tsconfigjson permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Khởi tạo tsconfig.json</h3>\n<p>Chạy command sau để khởi tạo tsconfig.json:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">npx tsc --init</code></pre></div>\n<p>(Ở đây mình dùng thêm npx bởi vì chúng ta cài typescript cục bộ, nếu muốn bỏ cái npx mà dùng trực tiếp tsc, bạn cần thêm <strong>-g</strong> vào command trước đó: <strong>npm i -g typescript</strong>)</p>\n<p>Chạy xong lệnh trên thì chúng ta đã có file tsconfig.json với hầu hết config đều được comment lại, chúng ta để ý option sau:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token comment\">// </span><span class=\"token property\">\"outDir\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./\"</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>Bỏ comment option này và sửa nó thành:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"outDir\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./dist\"</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p><strong>dist</strong> ở đây là thư mục chứa các file đã được biên dịch sang Javascript, Nodejs sẽ chạy code ở thư mục này. Hiển nhiên rồi, chúng ta code Typescript và sẽ phải biên dịch nó qua JS.</p>\n<p>Nếu bạn ghét rườm rà và thích sự tinh gọn, hãy xoá hết các dòng comment trong đó, chúng ta sẽ có file tsconfig như sau:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"compilerOptions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"target\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"es2019\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"module\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"commonjs\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"outDir\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"dist\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"strict\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"esModuleInterop\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"skipLibCheck\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"forceConsistentCasingInFileNames\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"cài-thêm-các-thư-viện\" style=\"position:relative;\"><a href=\"#c%C3%A0i-th%C3%AAm-c%C3%A1c-th%C6%B0-vi%E1%BB%87n\" aria-label=\"cài thêm các thư viện permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cài thêm các thư viện</h3>\n<p>Command:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> i cross-env dotenv express rimraf</code></pre></div>\n<p>Thông tin về các package trên:</p>\n<ul>\n<li><strong>cross-env</strong>: Support cross platform.</li>\n<li><strong>dot-env</strong>: Giúp chúng ta có thể config environment variable trong file .env và đưa vào process.env và file ts.</li>\n<li><strong>express</strong>: Là backend framework như mình đề cập trước đó, hỗ trợ tạo REST API (GET, PUT, POST, PATCH, DELETE).</li>\n<li><strong>rimraf</strong>: Thư viện hỗ trợ rm -rf cross-platform để xoá các file trong mục dist khi build lại app. (anh em windows mà xoá file thì đúng là cực hình, dùng em này tiện hehe)</li>\n</ul>\n<p>Các package phía trên hầu hết hỗ trợ Typescript, cho nên chúng ta có thể dùng trực tiếp luôn, tuy nhiên có thể 1 số package chúng ta cài vào sẽ không support Typescript, vậy nên chúng ta phải cài thêm:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> i @types/express @types/node</code></pre></div>\n<h3 id=\"development-tool-dependencies\" style=\"position:relative;\"><a href=\"#development-tool-dependencies\" aria-label=\"development tool dependencies permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Development tool dependencies</h3>\n<p>Yeah, với việc phát triển 1 app nodejs bằng typescript thì chúng ta sẽ cần 1 vài thư viện khác. <strong>nodemon</strong> để theo dõi (watch) thay đổi trong lúc code và preview, còn <strong>concurrently</strong> để support việc chạy nhiều command cùng 1 lúc.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> i --save-dev concurrently nodemon</code></pre></div>\n<p>Lệnh trên chúng ta thêm tag --save-dev, tức là những package trên chỉ xuất hiện trong devDependencies, với mục đích phục vụ cho quá trình development, không ảnh hưởng tới code production.</p>\n<h3 id=\"npm-scripts\" style=\"position:relative;\"><a href=\"#npm-scripts\" aria-label=\"npm scripts permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NPM Scripts</h3>\n<p>Okay, xong phần dependencies thì chúng ta cũng sẽ cần setup các script cho dự án.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"rimraf dist &amp;&amp; tsc\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"predev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"npm run build\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cross-env NODE_ENV=development concurrently \\\"tsc --watch\\\" \\\"nodemon -q dist/index.js\\\"\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"prestart\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"npm run build\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"start\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cross-env NODE_ENV=production node dist/index.js\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>Yoo, hãy điểm qua 1 lượt các command trên xem chúng sẽ làm gì nào:</p>\n<ul>\n<li>\n<p><strong>build</strong> sẽ được gọi lại ở vài command khác. Mục đích chính của command này là compile (đóng gói/ biên dịch) app của chúng ta.\nLệnh rimraf sẽ xoá hết các file của bản build cũ trong thư mục <strong>dist</strong> (ở trên chúng ta config thư mục này trong file tsconfig.json).</p>\n</li>\n<li>\n<p><strong>predev</strong> sẽ gọi qua command build để clean lại thư mục dist, compile lại project bằng lệnh tsc. Lệnh này sẽ tự động được gọi trước khi command \"dev\" được gọi (npm run serve / yarn server trên localhost).</p>\n</li>\n<li>\n<p><strong>dev</strong> dùng package cross-env để thiết lập NODE_ENV thành development. Bên cạnh đó sử dụng tsc --watch (TypeScript Compiler in “watch mode”), chế độ này sẽ build lại mỗi khi ta sửa code, output trong thư mục dist sẽ được compile lại, nodemon sẽ reload dist/index.js.</p>\n</li>\n<li>\n<p><strong>prestart</strong> giống với predev, chuẩn bị output cho production.</p>\n</li>\n<li>\n<p><strong>start</strong> lệnh này chạy app lên giống dev, nhưng không có theo dõi thay đổi, môi trường là production.</p>\n</li>\n<li>\n<p><strong>test</strong> Chạy unit test, alright, mình nghĩ mình sẽ làm riêng 1 bài về nó sau nếu có thời gian, còn hiện tại có thể bỏ qua.</p>\n</li>\n</ul>\n<p>Yooo, cài xong khá nhiều thứ rồi nhỉ, đây là file package.json của chúng ta sau khi cài mấy thứ trên. Về cơ bản sau khi cài những thứ trên chúng ta có thể bắt đầu code được rồi.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"express-prisma-typescript-boilerplate\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0.0\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"main\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"src/index.ts\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"rimraf dist &amp;&amp; tsc\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"predev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"npm run build\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cross-env NODE_ENV=development concurrently \\\"tsc --watch\\\" \\\"nodemon -q dist/index.js\\\"\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"prestart\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"npm run build\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"start\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cross-env NODE_ENV=production node dist/index.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"author\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"kienmatu\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"license\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ISC\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"repository\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"git\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"git+https://github.com/kienmatu/express-prisma-typescript-boilerplate.git\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"dependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"@types/express\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^4.17.13\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"@types/node\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^17.0.21\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"cross-env\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^7.0.3\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"dotenv\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^16.0.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"express\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^4.17.3\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"rimraf\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^3.0.2\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"typescript\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^4.6.2\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"devDependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"concurrently\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^7.0.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"nodemon\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^2.0.15\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"indexts\" style=\"position:relative;\"><a href=\"#indexts\" aria-label=\"indexts permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>index.ts</h3>\n<p>Giờ chúng ta tạo 1 file bên trong /src có tên là <strong>index.ts</strong>, file này đóng vai trò là cửa ngõ của app, giống như program.cs trong dotnet vậy. (Lúc nãy chúng ta đã config nó trong package.json).</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"xin chào các bạn\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Okay, hãy chạy thử nào</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">npm</span> run dev</code></pre></div>\n<p>Output:\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 713px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d4dccbbf4358d72b1b8e97526989e2e7/01267/hello-world.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABJ0AAASdAHeZh94AAAAtUlEQVQoz6WOWRKDIBBEOUcWoyKCrCJlkvtfrFNDqRXJR5Ly48HAdPcMG1yANBbSejRCQhmHqu2grIPUFnJ5p8cTcb7jfGs2LnWLa8N3MBtiNtsx5kAaoKzP+CnBjRO0D/AxYUxzrqlnQkTd9bsBBKMGBQmlweUA3iuIwWQxTaTt6F4N1bIJ/dOGJazXdgvMoTlQ48YFTlX9sUEJhbzXjA4ylqyCb5Q69o/4F1hp3Nft8cCjvAAKmN8bpBs09gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Console output\"\n        title=\"Console output\"\n        src=\"/static/d4dccbbf4358d72b1b8e97526989e2e7/01267/hello-world.png\"\n        srcset=\"/static/d4dccbbf4358d72b1b8e97526989e2e7/5a46d/hello-world.png 300w,\n/static/d4dccbbf4358d72b1b8e97526989e2e7/0a47e/hello-world.png 600w,\n/static/d4dccbbf4358d72b1b8e97526989e2e7/01267/hello-world.png 713w\"\n        sizes=\"(max-width: 713px) 100vw, 713px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"cài-đặt-express\" style=\"position:relative;\"><a href=\"#c%C3%A0i-%C4%91%E1%BA%B7t-express\" aria-label=\"cài đặt express permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cài đặt Express</h3>\n<p>Sửa lại file index.ts như sau để test thử express:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> express<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> Express<span class=\"token punctuation\">,</span> Request<span class=\"token punctuation\">,</span> Response <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"express\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> dotenv <span class=\"token keyword\">from</span> <span class=\"token string\">\"dotenv\"</span><span class=\"token punctuation\">;</span>\n\ndotenv<span class=\"token punctuation\">.</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">PORT</span> <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">PORT</span> <span class=\"token operator\">||</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> app<span class=\"token punctuation\">:</span> Express <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>express<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">:</span> Request<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">:</span> Response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&lt;h1>Nhiệt liệt chào mừng quý vị đại coder!&lt;/h1>\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PORT</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Running on </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">PORT</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> ⚡</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>\n<p>dotenv.config() sẽ lấy config từ file .env vào process.env</p>\n</li>\n<li>\n<p>PORT ở đây là cổng của app, tạo file .env ngang hàng với src để config, còn code sẽ mặc định port 3000 nếu không thấy config:</p>\n<div class=\"gatsby-highlight\" data-language=\"env\"><pre class=\"language-env\"><code class=\"language-env\">PORT=3000</code></pre></div>\n</li>\n<li>\n<p>app là 1 instance của Express, chúng ta sử dụng middleware express.json() để parse json từ request để app có thể đọc được.</p>\n</li>\n<li>\n<p>app.get() là phương thức đăng ký REST method cho 1 route nào đó, ở đây chúng ta đăng ký cho đường dẫn index và trả về <code class=\"language-text\">&quot;&lt;h1&gt;Nhiệt liệt chào mừng quý vị đại coder!&lt;/h1&gt;&quot;</code></p>\n</li>\n<li>\n<p>app.listen(): Listen request từ client theo 1 cổng đã được config trước đó.</p>\n</li>\n</ul>\n<p>Chạy lần nữa lệnh <strong>npm run dev</strong>, rồi mở trình duyệt vào <a href=\"http://localhost:3000\">http://localhost:3000</a>, bạn sẽ thấy điều kỳ diệu :D\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 798px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABJ0AAASdAHeZh94AAABdklEQVQoz5WSTY7TQBCFfQKOwdnmFixYchZWrGfBHWCFhkVkFMVxMu7/7uq2P1Q9xErYIFp6sqrc/d7TqxqqCNZajDH928+2sf3B/bnVzjnmecY5D1uFNeGXmSaFQUQwi+mEenFd1we01h6gvRAC1+uVGAOTFX5Oie+HhdkVBiU6Ho/EGHflcfzFOI5cLpfeU+c3aK0w1oF4nj5b3n9aePfhlY/PkaGU0hVTSh3BB1zwhBi7SEqx93POlJyJIVBr7W7ZGj/mxtcX4cu3xMtcGdR2CJHaWr9YciFLQWpF89VItK/kNjgWZ0hSSJJJ+k8aKQmvNgMrg/eexRhKkV25SqXVNwEl7Ll5j0+RmCMpp06YRVhCY7YFGytt3Rg0j8PhwPl87plZY5imqQ9Jg9e+RnI6nfpUg1mQFB+mX6XQWu0GBlXvq2AXLpcZZx3q+m0YBh883ru9TjHsK3W/WsqjsQw93P89nehxN2/ku8O/Vf+F+zf3hL8BstEHUckDmxoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Index request of expressjs\"\n        title=\"Index request of expressjs\"\n        src=\"/static/88c9e75a7dedb9288be286c21308a46d/898f6/home-page.png\"\n        srcset=\"/static/88c9e75a7dedb9288be286c21308a46d/5a46d/home-page.png 300w,\n/static/88c9e75a7dedb9288be286c21308a46d/0a47e/home-page.png 600w,\n/static/88c9e75a7dedb9288be286c21308a46d/898f6/home-page.png 798w\"\n        sizes=\"(max-width: 798px) 100vw, 798px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>Đây là file dist/index.js, là output của file main.ts được compile theo chuẩn es5 như trong tsconfig.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token string\">\"use strict\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> __importDefault <span class=\"token operator\">=</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>__importDefault<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span>\n  <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">mod</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> mod <span class=\"token operator\">&amp;&amp;</span> mod<span class=\"token punctuation\">.</span>__esModule <span class=\"token operator\">?</span> mod <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">default</span><span class=\"token punctuation\">:</span> mod <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nObject<span class=\"token punctuation\">.</span><span class=\"token function\">defineProperty</span><span class=\"token punctuation\">(</span>exports<span class=\"token punctuation\">,</span> <span class=\"token string\">\"__esModule\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> value<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> express_1 <span class=\"token operator\">=</span> <span class=\"token function\">__importDefault</span><span class=\"token punctuation\">(</span><span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"express\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> dotenv_1 <span class=\"token operator\">=</span> <span class=\"token function\">__importDefault</span><span class=\"token punctuation\">(</span><span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dotenv\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ndotenv_1<span class=\"token punctuation\">.</span>default<span class=\"token punctuation\">.</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> <span class=\"token constant\">PORT</span> <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">PORT</span> <span class=\"token operator\">||</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> app <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> express_1<span class=\"token punctuation\">.</span>default<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>express_1<span class=\"token punctuation\">.</span>default<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&lt;h1>Nhiệt liệt chào mừng quý vị đại coder!&lt;/h1>\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PORT</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Running on \"</span><span class=\"token punctuation\">.</span><span class=\"token function\">concat</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PORT</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\" \\u26A1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Lưu ý: Các bạn có thể đổi target es5 thành chuẩn khác, nhớ check trước availability bằng link này <a href=\"https://kangax.github.io/compat-table/es5/\">https://kangax.github.io/compat-table/es5/</a> để chọn chuẩn ECMAScript phù hợp.</p>\n<h3 id=\"thêm-controllers\" style=\"position:relative;\"><a href=\"#th%C3%AAm-controllers\" aria-label=\"thêm controllers permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Thêm Controllers</h3>\n<p>MVC là 1 mô hình rất phổ biến để cấu trúc 1 web app, được apply ở nhiều framework như Spring, dotNET core..., 1 thành phần chính của nó là Controller. Chúng ta có thể để logic xử lý request ở trong này, vì sử dụng typescript nên chúng ta sẽ áp dụng vài thứ về OOP.</p>\n<p>Tạo tiếp những class sau:\nsrc/controllers/abstractions/base-controller.ts:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> express <span class=\"token keyword\">from</span> <span class=\"token string\">\"express\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BaseController</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">public</span> router<span class=\"token punctuation\">:</span> express<span class=\"token punctuation\">.</span>Router<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>router <span class=\"token operator\">=</span> express<span class=\"token punctuation\">.</span><span class=\"token function\">Router</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token function\">initializeRoutes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>src/controllers/hero-controller.ts</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> express <span class=\"token keyword\">from</span> <span class=\"token string\">\"express\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> BaseController <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./abstractions/base-controller\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HeroController</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseController</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">public</span> path <span class=\"token operator\">=</span> <span class=\"token string\">\"/heroes\"</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">initializeRoutes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token function\">initializeRoutes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>router<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>getAllHero<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>router<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>addHero<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Bạn có thể thêm put, patch, delete sau.</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function-variable function\">getAllHero</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">request<span class=\"token punctuation\">:</span> express<span class=\"token punctuation\">.</span>Request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">:</span> express<span class=\"token punctuation\">.</span>Response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function-variable function\">addHero</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">request<span class=\"token punctuation\">:</span> express<span class=\"token punctuation\">.</span>Request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">:</span> express<span class=\"token punctuation\">.</span>Response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Tạo thêm 1 file src/app.ts</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> express <span class=\"token keyword\">from</span> <span class=\"token string\">\"express\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> BaseController <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./controllers/abstractions/base-controller\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">public</span> app<span class=\"token punctuation\">:</span> express<span class=\"token punctuation\">.</span>Application<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">public</span> port<span class=\"token punctuation\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">|</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">controllers<span class=\"token punctuation\">:</span> BaseController<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> port<span class=\"token punctuation\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">|</span> <span class=\"token builtin\">string</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>port <span class=\"token operator\">=</span> port<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">initializeMiddlewares</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">initializeControllers</span><span class=\"token punctuation\">(</span>controllers<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token function\">initializeMiddlewares</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>express<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token function\">initializeControllers</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">controllers<span class=\"token punctuation\">:</span> BaseController<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>app<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">request<span class=\"token punctuation\">,</span> response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      response<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Application is running\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    controllers<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">controller</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span> controller<span class=\"token punctuation\">.</span>router<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>app<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>port<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">App listening on the port </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>port<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> App<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Quay lại index.ts:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> dotenv <span class=\"token keyword\">from</span> <span class=\"token string\">\"dotenv\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> App <span class=\"token keyword\">from</span> <span class=\"token string\">\"./app\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> HeroController <span class=\"token keyword\">from</span> <span class=\"token string\">\"./controllers/hero-controller\"</span><span class=\"token punctuation\">;</span>\n\ndotenv<span class=\"token punctuation\">.</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> port <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">PORT</span> <span class=\"token operator\">||</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HeroController</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> port<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Okay, chạy app lên bằng lệnh npm run dev hoặc yarn dev, test thử method post:\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 915px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/67dd471623190849b6d080bffdf04250/4255a/test-hero-request-post.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABJ0AAASdAHeZh94AAABfElEQVQoz4VS7YrcMAzMu5b+6b++VikcFAp9krsn6HFJIF+WZcmyPUXOLrfdW1rDJLZsz1gaDcyMdV2RUkKMESEEbNuGfd8RjgPHBb72v5/xOxQZVRk/nxlfngI+fz/w/GYYfHOcJ1AkUAiYpgnTPGGcJrzNI+Z57vD4OI6d9BRntMz49ZLw9Qfh07cDL6NhUFXsdCBIAnGGr3MtUNqRJKDUilIKaq3IOaO1hut4n1VIyj0yuJqnxklB8n6kH2+tE1zRo3ex2hpYCxayLj64sppBVWAxgGPCEhJE7bxQ2weS9kHIxc9MBv+wCJIkiNcnMraQoJp7mr5/Rb2Z/4VeDoNZNyUiifSnPxq3NRMRBCZEZURJSJqwUsa4KrZ4ZjQQEV5ff/dW8Zbx9ri2iMd8f1kWcCQkOh4Kimp/XWsVg0/o0lum2l0WUWjO3VXr9c0oZqhmD41x6IX0YkqBWYasKyIxpo177H8luHXfyU7CUmDlXLRaO/7l7D3RPeEf4xpZV0W3fwQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Test hero post request\"\n        title=\"Test hero post request\"\n        src=\"/static/67dd471623190849b6d080bffdf04250/4255a/test-hero-request-post.png\"\n        srcset=\"/static/67dd471623190849b6d080bffdf04250/5a46d/test-hero-request-post.png 300w,\n/static/67dd471623190849b6d080bffdf04250/0a47e/test-hero-request-post.png 600w,\n/static/67dd471623190849b6d080bffdf04250/4255a/test-hero-request-post.png 915w\"\n        sizes=\"(max-width: 915px) 100vw, 915px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"khởi-tạo-database-bằng-docker\" style=\"position:relative;\"><a href=\"#kh%E1%BB%9Fi-t%E1%BA%A1o-database-b%E1%BA%B1ng-docker\" aria-label=\"khởi tạo database bằng docker permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Khởi tạo database bằng docker</h3>\n<p>Bây giờ chúng ta đã có 1 web api, tuy nhiên vẫn sẽ cần database để lưu/truy xuất thông tin. DB mình chọn là Postgresql, và sử dụng prisma làm ORM.</p>\n<p>Tạo file docker-compose.yml ngang hàng với src:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">postgres</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> postgres\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> postgres_db_container\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> POSTGRES_DB=$<span class=\"token punctuation\">{</span>POSTGRES_DB<span class=\"token punctuation\">:</span><span class=\"token punctuation\">-</span>postgres<span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">-</span> POSTGRES_USER=$<span class=\"token punctuation\">{</span>POSTGRES_USER<span class=\"token punctuation\">:</span><span class=\"token punctuation\">-</span>postgres<span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">-</span> POSTGRES_PASSWORD=$<span class=\"token punctuation\">{</span>POSTGRES_PASSWORD<span class=\"token punctuation\">:</span><span class=\"token punctuation\">-</span>password1<span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"5432:5432\"</span>\n    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> unless<span class=\"token punctuation\">-</span>stopped</code></pre></div>\n<p>Ở đây mình đặt các value mặc định, các bạn có thể thay đổi.</p>\n<p>Okay, mở command chạy lệnh sau để compose và khởi chạy postgres trên docker.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker-compose up -d postgres</code></pre></div>\n<p>Khi chạy xong chúng ta chạy lệnh sau để kiểm tra xem container đã chạy chưa (hoặc bạn có thể mở docker desktop lên xem):</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker <span class=\"token function\">ps</span></code></pre></div>\n<!-- | CONTAINER ID | IMAGE    | COMMAND                | CREATED        | STATUS       | PORTS                  | NAMES                 |\n| ------------ | -------- | ---------------------- | -------------- | ------------ | ---------------------- | --------------------- |\n| a9a1a82d5dd1 | postgres | \"docker-entrypoint.s…\" | 10 seconds ago | Up 9 seconds | 0.0.0.0:5432->5432/tcp | postgres_db_container | -->\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1159px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/498345d5fca52a238b859c84268d6693/1d553/docker-ps.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABJ0AAASdAHeZh94AAAAx0lEQVQY01VQ266DMAzr/3/hzgsSD5x1CI0WeiGB4smRQFulNnVqO0ndsixQUWzbZrvWalFE7vv3/s6VUgxfXEY3DAP+Hg+s64qS8/1ohVSRc0bK2Qx43/fdInFrDapiWuaJXa0F8/uNozXQnFXneUbXdWb88h7/zyeWGOG9x3EcGMcRIUZwiWzo+970XC6lhBjjzzjsjsLzPBFCtMp8YxecIIRwj02uqJoHJ3I8SLrIxOyYBOYYaZ5TMjFNpmmCiFr++m/qiD8neYNXjzu+fQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Docker Ps\"\n        title=\"Docker Ps\"\n        src=\"/static/498345d5fca52a238b859c84268d6693/1d553/docker-ps.png\"\n        srcset=\"/static/498345d5fca52a238b859c84268d6693/5a46d/docker-ps.png 300w,\n/static/498345d5fca52a238b859c84268d6693/0a47e/docker-ps.png 600w,\n/static/498345d5fca52a238b859c84268d6693/1d553/docker-ps.png 1159w\"\n        sizes=\"(max-width: 1159px) 100vw, 1159px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Đã có DB, bây giờ chúng ta sẽ cài đặt prisma và prisma client để làm ORM.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> prisma @prisma/client</code></pre></div>\n<p>Cài xong prisma chúng ta sẽ có thể khởi tạo schema prisma.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">npx prisma init</code></pre></div>\n<p>1 file mới sẽ xuất hiện dưới đường dẫn prisma/schema.prisma:</p>\n<div class=\"gatsby-highlight\" data-language=\"psl\"><pre class=\"language-psl\"><code class=\"language-psl\">// This is your Prisma schema file,\n// learn more about it in the docs: https://pris.ly/d/prisma-schema\n\ngenerator client {\n  provider = &quot;prisma-client-js&quot;\n}\n\ndatasource db {\n  provider = &quot;postgresql&quot;\n  url      = env(&quot;DATABASE_URL&quot;)\n}</code></pre></div>\n<p>Lệnh init trên cũng sẽ thêm 1 config vào file .env:</p>\n<div class=\"gatsby-highlight\" data-language=\"env\"><pre class=\"language-env\"><code class=\"language-env\">PORT=3000\n\n# This was inserted by `prisma init`:\n\n# Environment variables declared in this file are automatically made available to Prisma.\n\n# See the documentation for more detail: https://pris.ly/d/prisma-schema#accessing-environment-variables-from-the-schema\n\n# Prisma supports the native connection string format for PostgreSQL, MySQL, SQLite, SQL Server, MongoDB (Preview) and CockroachDB (Preview).\n\n# See the documentation for all the connection string options: https://pris.ly/d/connection-strings\n\nDATABASE_URL=&quot;postgresql://johndoe:randompassword@localhost:5432/mydb?schema=public&quot;\n</code></pre></div>\n<p>Chúng ta cần sửa lại DATABASE_URL theo như config postgresdb của file docker compose phía trên, xoá đi các comment:</p>\n<div class=\"gatsby-highlight\" data-language=\"env\"><pre class=\"language-env\"><code class=\"language-env\">DB_HOST=localhost\nDB_PORT=5432\nDB_SCHEMA=public\nPOSTGRES_USER=postgres\nPOSTGRES_PASSWORD=password1\nPOSTGRES_DB=hero_db\n\n# See the documentation for all the connection string options: https://pris.ly/d/connection-strings\n\nDATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${DB_HOST}:${DB_PORT}/${POSTGRES_DB}?schema=${DB_SCHEMA}&amp;sslmode=prefer\n</code></pre></div>\n<ul>\n<li><strong><span style=\"color:#ffc107\">Lưu ý to bự</span></strong>: DB_HOST hiện tại là localhost, tuy nhiên ở bước sau chúng ta sẽ cần sửa lại DB_HOST cho trùng với ID của service trong docker-compose (postgres) trong trường hợp chúng ta cần deploy docker container.</li>\n</ul>\n<p>Hiện tại đã có DB, việc chúng ta cần làm là khởi tạo 1 DB mới theo file schema bằng lệnh migrate, hoặc sẽ tạo schema từ DB có sẵn, trong trường hợp này chúng ta sẽ tạo DB từ schema.</p>\n<p>Sửa lại file schema, thêm vào model:</p>\n<div class=\"gatsby-highlight\" data-language=\"psl\"><pre class=\"language-psl\"><code class=\"language-psl\">// This is your Prisma schema file,\n// learn more about it in the docs: https://pris.ly/d/prisma-schema\n\ngenerator client {\n  provider = &quot;prisma-client-js&quot;\n}\n\ndatasource db {\n  provider = &quot;postgresql&quot;\n  url      = env(&quot;DATABASE_URL&quot;)\n}\n\nmodel Hero {\n  id            Int      @id @default(autoincrement())\n  createdAt     DateTime @default(now())\n  updatedAt     DateTime @updatedAt\n  name          String   @db.VarChar(255)\n  origin        String?  @db.VarChar(255)\n  description   String?\n}</code></pre></div>\n<p>Migrate database:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">npx prisma migrate dev --name init</code></pre></div>\n<p>Lệnh trên sẽ làm 2 việc:</p>\n<ul>\n<li>Tạo file migration sql theo schema</li>\n<li>Migrate db theo file migration</li>\n<li>Output:\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1032px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/38153b3aca1d67d287122dd304bc9699/12bff/prisma-init-migration.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABJ0AAASdAHeZh94AAABMElEQVQoz42SaXKDMAyFc42kFIyNLW/Zmsn9j/Y6T2AgmXbaHw8sIX9oO3TGQsoZIVdMMcOGCJ8KfMzquz2eGJxHbycw9i8dPoZRQU7Soqg2RTCh9I9eFGymoOIP3m2yFOgTsymYYkJIBaleEOtFoQTxXG9fqNe72rzza4Z8EECglLlsltvawCyZCeM+R7deJPRdCmSQ5LpcnstsLWjnl7ektSVh6TV/To6WbH1U4P3xRL3ckOoVJp3RjRO6fkQ37PSfoRx7g5O1MDnDlgwTI7ogODqHE2Xdev6pzKZTb7ah2JxhUoLLBb6eVWPKGEQwBIErBb0PWhb7uVebtvWi32egF9hJ4ELSnkyS1TdYD7ME87ytyiuUa8Ppr3tIw+2a3QbCJZ9924D2Q2p3aLc9/AY7whuMTH/XogAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"prisma-init-migration\"\n        title=\"prisma-init-migration\"\n        src=\"/static/38153b3aca1d67d287122dd304bc9699/12bff/prisma-init-migration.png\"\n        srcset=\"/static/38153b3aca1d67d287122dd304bc9699/5a46d/prisma-init-migration.png 300w,\n/static/38153b3aca1d67d287122dd304bc9699/0a47e/prisma-init-migration.png 600w,\n/static/38153b3aca1d67d287122dd304bc9699/12bff/prisma-init-migration.png 1032w\"\n        sizes=\"(max-width: 1032px) 100vw, 1032px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></li>\n</ul>\n<p>Lúc này nếu bạn dùng trình quản lý db nào đó, chẳng hạn như dbeaver và connect vào thì sẽ thấy db đã xuất hiện:\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 572px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/90e23e8e3f81cbb07e20d885bc6fcfaf/a805e/postgres-db-dbeaver.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 112.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAABJ0AAASdAHeZh94AAACqElEQVQ4y51V2XabMBTk/z+rfWyah8ZtbGMWLYCQMPtizDI9kpemDrHT6hwdxEWaO5q7YGVliaZp0LUt+r7H8XhEXdfoug5t2+JwOOAy5nm+Pt+u3w6rKEvkeY6yLKGkRJbnKIoSWZahqirs93vkeWEcJEli9mqHel3XjTmnHU/ThGEYYPmxgooFIiEQCwEqU7zuXMRRAKUUpJSI49g4C8MQIhIGTIgIeZaDMQalEsRSQsYCFg0FwiAwG/WBRIPkFZ7dANvNGjwIDCvNOM8yvEZ7RHSLPbfBkhQ00k4icEbhximsUJy8p2lqvGpW+zQFi2Jja8/aai37wwF1d0DbaI1b1F1nbEnVIExzCP8nLJsr7GwbhBAQSuH7HjzPg+95CMPAMNSg4zgajcZxOK3H0TxHbdP6TYDcPcFSQsL1iNGiqmqj10W3/ng0ILeRfD9m6B1q/QWWz10EzgqUUmRpavQqisJE8q8j51T5cAJg22dYGBqQKMDLjoB4nrnGEshSzt3mJmUBLP1S9TNSugJjFEEkrqD3gJYSXKeddTLM6LoGREg4m19o2vYhwyWb0IBnKyYAY61AfBuEh8a2dLWPrqszQeexdca7AryWgMu4yU0dHJ2LlwDdMry8t02D9XoNxvkfhvrTVAkI7iAQ0iSurlMNqpvHPcBj35u9V4ZXwNSFcp7hUl3H0lSNLrnPXPtGw8kAjokN6XzHxvEN0DAcTcl9FJS3U3eb94Bqjb3zBMIj01HuRXTp2wLDDaT9DTs/AGcM84MoPwSc9jZi+xu2LoHrOJBSmU262/wTw2me0UcrhNSB7+6Q5YX5FWj99NT6fBrwUim99xWcM1DG0R/6u9F8yDAbAG4/Y/XyA75PTMf5n+ZwYtgoMPcFT6sNCPFRLyTx3U54A/gbaOD0EXaEb04AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"postgres-db-dbeaver\"\n        title=\"postgres-db-dbeaver\"\n        src=\"/static/90e23e8e3f81cbb07e20d885bc6fcfaf/a805e/postgres-db-dbeaver.png\"\n        srcset=\"/static/90e23e8e3f81cbb07e20d885bc6fcfaf/5a46d/postgres-db-dbeaver.png 300w,\n/static/90e23e8e3f81cbb07e20d885bc6fcfaf/a805e/postgres-db-dbeaver.png 572w\"\n        sizes=\"(max-width: 572px) 100vw, 572px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"crud-cùng-prisma\" style=\"position:relative;\"><a href=\"#crud-c%C3%B9ng-prisma\" aria-label=\"crud cùng prisma permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CRUD cùng Prisma</h3>\n<p>Cài xong prisma, bây giờ chúng ta đã có đủ nguyên liệu cần thiết cho món chính là xào xáo dữ liệu.</p>\n<p>Sửa lại file base-controller.ts để thêm prisma vào:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> PrismaClient <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@prisma/client\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> express <span class=\"token keyword\">from</span> <span class=\"token string\">\"express\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BaseController</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">public</span> router<span class=\"token punctuation\">:</span> express<span class=\"token punctuation\">.</span>Router<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">public</span> prisma<span class=\"token punctuation\">:</span> PrismaClient<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>prisma <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PrismaClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>router <span class=\"token operator\">=</span> express<span class=\"token punctuation\">.</span><span class=\"token function\">Router</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token function\">initializeRoutes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Sửa lại 2 method getAllHero, addHero trong hero-controller.ts:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token function-variable function\">getAllHero</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">request<span class=\"token punctuation\">:</span> express<span class=\"token punctuation\">.</span>Request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">:</span> express<span class=\"token punctuation\">.</span>Response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> heroes <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>prisma<span class=\"token punctuation\">.</span>hero<span class=\"token punctuation\">.</span><span class=\"token function\">findMany</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span>heroes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function-variable function\">addHero</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">request<span class=\"token punctuation\">:</span> express<span class=\"token punctuation\">.</span>Request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">:</span> express<span class=\"token punctuation\">.</span>Response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> reqBody <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> hero <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>prisma<span class=\"token punctuation\">.</span>hero<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    data<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      name<span class=\"token punctuation\">:</span> reqBody<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span>\n      origin<span class=\"token punctuation\">:</span> reqBody<span class=\"token punctuation\">.</span>origin<span class=\"token punctuation\">,</span>\n      description<span class=\"token punctuation\">:</span> reqBody<span class=\"token punctuation\">.</span>description<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span>hero<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Mở terminal chạy npm run dev, dùng postman test thử:\nThêm hero:\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9a4042c2f1d86464eeb649bf2925fdfa/4a00e/create-hero-api.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABJ0AAASdAHeZh94AAABRElEQVQoz5WRSW4cMQxFdeMscy4vcpIscgIDBpyUqjVwklTfIHtwuw3DiIAHURRFUp+p1opSClpr2LYN+76jE6H3/gF6OF9h6iiN8OOp4uevhkREoEhAkbS2it4KOjVQJzBzQCyYc37Bwp+Xgd/PhqRmkVBE4LaqQJkxhKCqMNXwsS58t4YZkme3MUBbxpYrKht0LIhN6AW3RQdIDKwjIHnf5eIbYyKN4cYAs4BY0UjA/lAGOhs66x2GSoLSOeKutnPqGrKkU96Qt+2mnw+I+SzBGvbpW8daUFPYNNgwDGdOlH7+QRJVtN4hrptraAb3iWgEH8fxwFcKHhGf5lpRgf6+Iu81Wq9kaGz43+UFk4/dNWw5418uyJVxaoJcJfY9UJSuUcx9p4vtvv3uHEPxKc81b19a64B3fSPuH3yP93PFO2/sDQ4cDOB+idl4AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"create-hero-api\"\n        title=\"create-hero-api\"\n        src=\"/static/9a4042c2f1d86464eeb649bf2925fdfa/c1b63/create-hero-api.png\"\n        srcset=\"/static/9a4042c2f1d86464eeb649bf2925fdfa/5a46d/create-hero-api.png 300w,\n/static/9a4042c2f1d86464eeb649bf2925fdfa/0a47e/create-hero-api.png 600w,\n/static/9a4042c2f1d86464eeb649bf2925fdfa/c1b63/create-hero-api.png 1200w,\n/static/9a4042c2f1d86464eeb649bf2925fdfa/4a00e/create-hero-api.png 1406w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\nGet tất cả:\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dcfb03999e24bde1ab7813d8ad1a8090/d4b10/get-all-hero-api.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABJ0AAASdAHeZh94AAABhElEQVQoz5VTW07EMAzsrbkIZ+EASNyAHw7AD2zTJs7DcZIOsrNddj/4wNLIqetMPNNmISJs2wbNtVZD7/2G1trD+h5aizEiBI/3z4LXjx0L+R0lZwQirOuKfd8RUzSkmJDSL0opNzAz8nXdpeL5LePpJWOJwYOCR+8DY0xIb2i9zea7ac84jgNNGh5jQHLEUpkhIlPSVRaO2aJ1PeAkUehzVkWRUEWsX1pDSBWbj1guX19wziGEAB+CSZ4SI1rlB7LbdOrfGHOAPr1M3JGKYJHW54StYfSOMQ5r1LpuUp6T0IC/4xhDCRvGcSC7FeQ2OGJQrvCpokrHf0IPXHQaJeQQsF42rCEjFjFPKIuR75FvNYWufZwHK86aKjLCPtSLYUXN0gaqWnHNLPP9PdSSx+cxCbkqs07owUSgImZuzGKb/i1ZCVVy2Rzct8PFF2QWm7bUZj5q5jNrrQ2wDMsKndAIASz6yc9fIWU2spMw8R3K9JMSw+2Ey0agmJFysRujV1Yvwg8O66sLO0bIUwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"get-all-hero-api\"\n        title=\"get-all-hero-api\"\n        src=\"/static/dcfb03999e24bde1ab7813d8ad1a8090/c1b63/get-all-hero-api.png\"\n        srcset=\"/static/dcfb03999e24bde1ab7813d8ad1a8090/5a46d/get-all-hero-api.png 300w,\n/static/dcfb03999e24bde1ab7813d8ad1a8090/0a47e/get-all-hero-api.png 600w,\n/static/dcfb03999e24bde1ab7813d8ad1a8090/c1b63/get-all-hero-api.png 1200w,\n/static/dcfb03999e24bde1ab7813d8ad1a8090/d4b10/get-all-hero-api.png 1394w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Bonus, express có support router param để follow đúng best practices của REST API, implement luôn nhé.\nhero-controller.ts</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\">  <span class=\"token keyword\">public</span> <span class=\"token function\">initializeRoutes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>router<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>getAllHero<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>router<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>addHero<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>router<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>path <span class=\"token operator\">+</span> <span class=\"token string\">\"/:heroId\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>getHeroById<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Bạn có thể thêm put, patch, delete sau.</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function-variable function\">getHeroById</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token parameter\">request<span class=\"token punctuation\">:</span> express<span class=\"token punctuation\">.</span>Request<span class=\"token punctuation\">,</span>\n    response<span class=\"token punctuation\">:</span> express<span class=\"token punctuation\">.</span>Response<span class=\"token punctuation\">,</span></span>\n  <span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> hero <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>prisma<span class=\"token punctuation\">.</span>hero<span class=\"token punctuation\">.</span><span class=\"token function\">findUnique</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      where<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        id<span class=\"token punctuation\">:</span> Number<span class=\"token punctuation\">.</span><span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">.</span>heroId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span>hero<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Test thử:\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/238e60c94a80db3861961cc79c345f9f/f1c64/get-hero-by-id-api.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABJ0AAASdAHeZh94AAABKElEQVQoz5VRS05DMQzMhTkO5+ASnIENG7aU0veJ49j5DbJLqlepLBhpZDuKxh47qCooRuScccMYeIQxhnPmhhgjVASogqqMsK4b1nXFsiy4XC6eM7MzpXTLHzExI9OOjxPh6WXH8yshpH1DZoaIuEDiBNbstU1tDiy32HtHaw2jXydtrWOMDq0db58d7ydFyJlBRBgHWxOq5c7iJOfsja3BjUXAtCPs6+J7oJSuJPJpjLWUOyFjrRWcGSwZWhSlKnKp+N4ELBXBxShC8rQpPoHtqNfqkx8F/8Rvs9D6QCsF6fyFjQSRCygX7/ZfmPVQWkNVRTx/47wQtmSiipXEhbekHonV3y2fTWc9aUcKdrXrYgdqs4s1lNogpUHLNVqtMx55+GO1Wf4B/lG/25gLAwcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"get-hero-by-id-api\"\n        title=\"get-hero-by-id-api\"\n        src=\"/static/238e60c94a80db3861961cc79c345f9f/c1b63/get-hero-by-id-api.png\"\n        srcset=\"/static/238e60c94a80db3861961cc79c345f9f/5a46d/get-hero-by-id-api.png 300w,\n/static/238e60c94a80db3861961cc79c345f9f/0a47e/get-hero-by-id-api.png 600w,\n/static/238e60c94a80db3861961cc79c345f9f/c1b63/get-hero-by-id-api.png 1200w,\n/static/238e60c94a80db3861961cc79c345f9f/f1c64/get-hero-by-id-api.png 1390w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"error-handling\" style=\"position:relative;\"><a href=\"#error-handling\" aria-label=\"error handling permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Error Handling</h3>\n<p>1 phần cực kì thiết yếu trong app chính là error handling, chúng ta sẽ áp dụng 1 middleware để xử lý vụ này.</p>\n<p>src/exceptions/http-exception.ts:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HttpException</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Error</span> <span class=\"token punctuation\">{</span>\n  status<span class=\"token punctuation\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  message<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">status<span class=\"token punctuation\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>status <span class=\"token operator\">=</span> status<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>message <span class=\"token operator\">=</span> message<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>src/middlewares/error.middleware.ts:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> NextFunction<span class=\"token punctuation\">,</span> Request<span class=\"token punctuation\">,</span> Response <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"express\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> HttpException <span class=\"token keyword\">from</span> <span class=\"token string\">\"../exceptions/http-exception\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">errorMiddleware</span><span class=\"token punctuation\">(</span>\n  <span class=\"token parameter\">error<span class=\"token punctuation\">:</span> HttpException<span class=\"token punctuation\">,</span>\n  request<span class=\"token punctuation\">:</span> Request<span class=\"token punctuation\">,</span>\n  response<span class=\"token punctuation\">:</span> Response<span class=\"token punctuation\">,</span>\n  next<span class=\"token punctuation\">:</span> NextFunction</span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> status <span class=\"token operator\">=</span> error<span class=\"token punctuation\">.</span>status <span class=\"token operator\">||</span> <span class=\"token number\">500</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> message <span class=\"token operator\">=</span> error<span class=\"token punctuation\">.</span>message <span class=\"token operator\">||</span> <span class=\"token string\">\"Something went wrong\"</span><span class=\"token punctuation\">;</span>\n  response<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    status<span class=\"token punctuation\">,</span>\n    message<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>src/app.ts:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> express <span class=\"token keyword\">from</span> <span class=\"token string\">\"express\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> BaseController <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./controllers/abstractions/base-controller\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> errorMiddleware <span class=\"token keyword\">from</span> <span class=\"token string\">\"./middlewares/error.middleware\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">public</span> app<span class=\"token punctuation\">:</span> express<span class=\"token punctuation\">.</span>Application<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">public</span> port<span class=\"token punctuation\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">|</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">controllers<span class=\"token punctuation\">:</span> BaseController<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> port<span class=\"token punctuation\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">|</span> <span class=\"token builtin\">string</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>port <span class=\"token operator\">=</span> port<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">initializeMiddlewares</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">initializeControllers</span><span class=\"token punctuation\">(</span>controllers<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">initializeErrorHandling</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token function\">initializeMiddlewares</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>express<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token function\">initializeErrorHandling</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>errorMiddleware<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token function\">initializeControllers</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">controllers<span class=\"token punctuation\">:</span> BaseController<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>app<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">request<span class=\"token punctuation\">,</span> response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      response<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Application is running\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    controllers<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">controller</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span> controller<span class=\"token punctuation\">.</span>router<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>app<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>port<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">App listening on the port </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>port<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> App<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Lưu ý: Vì express chạy các middleware theo chain từ đầu đến cuối, bạn phải gọi hàm initializeErrorHandling sau cùng.</p>\n<p>Config xong cho các exception, bây giờ chúng ta áp dụng cho hero controller, khi get hero by id nhưng không tìm thấy sẽ trả về 1 exception tên là HeroNotFoundException.</p>\n<p>src/exceptions/hero-not-found-exception.ts:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> HttpException <span class=\"token keyword\">from</span> <span class=\"token string\">\"./http-exception\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">HeroNotFoundException</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">HttpException</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">id<span class=\"token punctuation\">:</span> <span class=\"token builtin\">number</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token number\">404</span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Hero with id </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> not found</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> HeroNotFoundException<span class=\"token punctuation\">;</span></code></pre></div>\n<p>hero-controller.ts:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">//...</span>\n<span class=\"token function-variable function\">getHeroById</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token parameter\">request<span class=\"token punctuation\">:</span> express<span class=\"token punctuation\">.</span>Request<span class=\"token punctuation\">,</span>\n  response<span class=\"token punctuation\">:</span> express<span class=\"token punctuation\">.</span>Response<span class=\"token punctuation\">,</span>\n  next<span class=\"token punctuation\">:</span> express<span class=\"token punctuation\">.</span>NextFunction</span>\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> heroId <span class=\"token operator\">=</span> Number<span class=\"token punctuation\">.</span><span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">.</span>heroId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>prisma<span class=\"token punctuation\">.</span>hero\n    <span class=\"token punctuation\">.</span><span class=\"token function\">findUnique</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      where<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        id<span class=\"token punctuation\">:</span> heroId<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">hero</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>hero<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span>hero<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HeroNotFoundException</span><span class=\"token punctuation\">(</span>heroId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Test thử với 1 id bất kỳ không có trong db:\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1015px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ea2b0ef8467e681fa4a43c163ca7fd30/e088a/hero-not-found.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABJ0AAASdAHeZh94AAABZUlEQVQoz42RSZITMRBFdcG+BQfiBM0FWPQNWLNgyYZtDy4bl1yDpBw0fCJlF7ahiUARv6SScvh6cuu6Yp7nrpQS/ndY7Dh6ZBUAGZAT0BTOCi3Lgm22QEoEIoKI/FNrCAjLhDef8Pg14eOXE749M9zofU+2YofDoWvYD/DeI4QAu4EpxninEBOqEn7sCR8+Bzx8WvD0XeGCP4LNDQuICbkUJGWICnLOUNXesLX217Vvd0ppUCG4+XTq7v6MarX262+FfhdsAKXU3ddS+z4zIaWI3TDAiTCY+exQGJrPjkop3d1WyP4TJQSO8MuEaZ0RKCKQYvAJu58LVDPc8PrSH8Q4TdPUOxs/42TObZYUUWtFqaWrtoqGdtlrIMkQLb25my5JytwZGjtzZvzsNfta+F2GV0wN5cLbaSnIBn48IoaAhQSsBWSSs6557V3ZMLdmwtnH+GyH1VTv1ZPs/PZxbhpsjM3hL50LCwKbbUW8AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"hero-not-found\"\n        title=\"hero-not-found\"\n        src=\"/static/ea2b0ef8467e681fa4a43c163ca7fd30/e088a/hero-not-found.png\"\n        srcset=\"/static/ea2b0ef8467e681fa4a43c163ca7fd30/5a46d/hero-not-found.png 300w,\n/static/ea2b0ef8467e681fa4a43c163ca7fd30/0a47e/hero-not-found.png 600w,\n/static/ea2b0ef8467e681fa4a43c163ca7fd30/e088a/hero-not-found.png 1015w\"\n        sizes=\"(max-width: 1015px) 100vw, 1015px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"deploy-app-với-docker\" style=\"position:relative;\"><a href=\"#deploy-app-v%E1%BB%9Bi-docker\" aria-label=\"deploy app với docker permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Deploy app với Docker</h3>\n<p>Phần code đã xong, hiện tại chúng ta có thể viết Dockerfile để build được app trên docker.\nĐầu tiên chúng ta phải đảm bảo rằng mỗi khi app chạy lên, chúng ta sẽ migrate database để đảm bảo db luôn khớp với schema (code first).</p>\n<p>package.json:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//..</span>\n    <span class=\"token property\">\"deploy\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"npx prisma migrate deploy &amp;&amp; npm run start\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>Command deploy sẽ chạy prisma migrate để apply các migration còn thiếu vào db, sau đó mới chạy app bằng lệnh start (production), ở đây mình chuyển qua xài yarn cho tiện, vì nó có flag --pure-lockfile, nôm na sẽ cài dependencies theo file lock, tránh trường hợp lib bị update gây crash app.</p>\n<p>./Dockerfile:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\">FROM node<span class=\"token punctuation\">:</span>16<span class=\"token punctuation\">-</span>alpine3.14\n\nEXPOSE 3000\n\nARG NODE_ENV\nENV NODE_ENV $NODE_ENV\n\nRUN mkdir /app\nWORKDIR /app\nADD package.json yarn.lock .env /app/\nADD . /app\nRUN yarn <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>pure<span class=\"token punctuation\">-</span>lockfile\n\nCMD <span class=\"token punctuation\">[</span><span class=\"token string\">\"yarn\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"deploy\"</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>Sửa lại file docker-compose.yml:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">postgres</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> postgres\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> postgres_db_container\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> POSTGRES_DB=$<span class=\"token punctuation\">{</span>POSTGRES_DB<span class=\"token punctuation\">:</span><span class=\"token punctuation\">-</span>postgres<span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">-</span> POSTGRES_USER=$<span class=\"token punctuation\">{</span>POSTGRES_USER<span class=\"token punctuation\">:</span><span class=\"token punctuation\">-</span>postgres<span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">-</span> POSTGRES_PASSWORD=$<span class=\"token punctuation\">{</span>POSTGRES_PASSWORD<span class=\"token punctuation\">:</span><span class=\"token punctuation\">-</span>password1<span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"5432:5432\"</span>\n    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> unless<span class=\"token punctuation\">-</span>stopped\n  <span class=\"token key atrule\">api</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> boiler_api_container\n    <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span> .\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"3000:3000\"</span>\n    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> postgres</code></pre></div>\n<p>Sửa DB_HOST trong file .env, như đã nói trước đó, phải sửa host cho trùng với id của service trong docker compose khi mình build bằng docker:</p>\n<div class=\"gatsby-highlight\" data-language=\"txt\"><pre class=\"language-txt\"><code class=\"language-txt\">DB_HOST=postgres</code></pre></div>\n<p>Sửa 1 tí schema prisma <code class=\"language-text\">binaryTargets</code> để nó support linux:</p>\n<div class=\"gatsby-highlight\" data-language=\"psl\"><pre class=\"language-psl\"><code class=\"language-psl\">generator client {\n  provider = &quot;prisma-client-js&quot;\n  binaryTargets = [&quot;native&quot;, &quot;linux-musl&quot;]\n}</code></pre></div>\n<p>Okay giờ chúng ta có thể chạy lệnh docker để compose:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">docker-compose up -d</code></pre></div>\n<h3 id=\"thêm-file-gitignore\" style=\"position:relative;\"><a href=\"#th%C3%AAm-file-gitignore\" aria-label=\"thêm file gitignore permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Thêm file .gitignore:</h3>\n<div class=\"gatsby-highlight\" data-language=\"git\"><pre class=\"language-git\"><code class=\"language-git\">node_modules\n.env\ndist</code></pre></div>\n<h2 id=\"tổng-kết\" style=\"position:relative;\"><a href=\"#t%E1%BB%95ng-k%E1%BA%BFt\" aria-label=\"tổng kết permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tổng kết</h2>\n<p>Còn khá là nhiều thứ chúng ta có thể thêm vào app này, chẳng hạn như request model validation, testing, CI/CD, tuy nhiên mình muốn giữ cho boilerplate này thật đơn giản, các bạn có thể implement thêm tính năng nào các bạn cần.</p>\n<p>Hy vọng qua tut này các bạn có thể tự dựng được 1 project nodejs sử dụng express và prisma, typescript.</p>\n<p>Update: Bài viết có lỗi 1 tí về typo, mình đã sửa lại code từ <code class=\"language-text\">heros</code> về <code class=\"language-text\">heroes</code>.</p>"},"primaryTag":null},"pageContext":{"postId":"5dc8e7ba-04d6-5c31-9b4f-c8ea50609c9f","primaryTag":"Nodejs"}},
    "staticQueryHashes": ["1116962356","2275848304","3082461530","3089453468","545095672"]}