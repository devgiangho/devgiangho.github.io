{"componentChunkName":"component---src-templates-post-tsx","path":"/dung-golang-microservice-boilerplate-theo-clean-architecture/","result":{"data":{"post":{"headings":[{"id":"chuyện-về-việc-học","depth":2,"value":"Chuyện về việc học"},{"id":"clean-architecture","depth":2,"value":"Clean Architecture"},{"id":"sơ-bộ-về-clean-architecture","depth":4,"value":"Sơ bộ về Clean architecture"},{"id":"triển-khai-clean-architect-với-golang","depth":2,"value":"Triển khai clean architect với Golang"},{"id":"entities-layer","depth":3,"value":"Entities Layer"},{"id":"usecases-layer","depth":3,"value":"Usecases layer"},{"id":"interface-adapters-layer","depth":3,"value":"Interface Adapters layer"},{"id":"frameworks--dbs-layer","depth":3,"value":"Frameworks & DBs Layer"},{"id":"tổng-kết","depth":2,"value":"Tổng kết"}],"tableOfContents":"<ul>\n<li>\n<p><a href=\"#chuy%E1%BB%87n-v%E1%BB%81-vi%E1%BB%87c-h%E1%BB%8Dc\">Chuyện về việc học</a></p>\n</li>\n<li>\n<p><a href=\"#clean-architecture\">Clean Architecture</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"#s%C6%A1-b%E1%BB%99-v%E1%BB%81-clean-architecture\">Sơ bộ về Clean architecture</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#tri%E1%BB%83n-khai-clean-architect-v%E1%BB%9Bi-golang\">Triển khai clean architect với Golang</a></p>\n<ul>\n<li><a href=\"#entities-layer\">Entities Layer</a></li>\n<li><a href=\"#usecases-layer\">Usecases layer</a></li>\n<li><a href=\"#interface-adapters-layer\">Interface Adapters layer</a></li>\n<li><a href=\"#frameworks--dbs-layer\">Frameworks &#x26; DBs Layer</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#t%E1%BB%95ng-k%E1%BA%BFt\">Tổng kết</a></p>\n</li>\n</ul>","frontmatter":{"title":"Dựng Golang microservice boilerplate theo clean architecture","path":"/dung-golang-microservice-boilerplate-theo-clean-architecture","tags":["Golang","Microservice","Boilerplate"],"excerpt":"Một ngày đẹp trời nọ mình học xong 1 course cơ bản về Go trên udemy, rồi cũng nghiên cứu cách để áp dụng vào thực tế, dựng luôn 1 app sử dụng em nó, tuy nhiên mình vẫn luôn đau đầu với việc suy nghĩ nên áp dụng cấu trúc nào để dễ bề code, maintain, tránh việc bị kẻ maintain chửi như làng Vũ Đại. Dĩ nhiên mình không thể bê tư duy MVC cũng như nhiều thứ từ dotNET qua Go được.","created":"2022-03-27T00:00:00.000Z","createdPretty":"27 March, 2022","updated":"2022-03-27T00:00:00.000Z","updatedPretty":"27 March, 2022","featuredImage":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAECAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAAB6V7JllhX/8QAHBAAAgEFAQAAAAAAAAAAAAAAAQIRAAMSEyIx/9oACAEBAAEFAmY7bhMoZUr1jNDz/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQMBAT8BJ//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABgQAAMBAQAAAAAAAAAAAAAAAAAQESEB/9oACAEBAAY/ApVpTer/xAAbEAEBAQACAwAAAAAAAAAAAAABABEhMUFRkf/aAAgBAQABPyEOCzTiNkUJhYD7J8g/IZ22/9oADAMBAAIAAwAAABDjz//EABYRAQEBAAAAAAAAAAAAAAAAAAEAEf/aAAgBAwEBPxAIuxf/xAAWEQEBAQAAAAAAAAAAAAAAAAABECH/2gAIAQIBAT8QdJ//xAAeEAEAAgEEAwAAAAAAAAAAAAABABFBITFRwYHR8P/aAAgBAQABPxDaIrVzX3mHSosrMuwXlzAFk0bB6lYpuEXUYBVMtdT/2Q==","aspectRatio":1.6666666666666667,"src":"/static/8e8dca38a6da2caf6b18efacd51918f3/2f1b1/go-clean-arch-boilerplate.jpg","srcSet":"/static/8e8dca38a6da2caf6b18efacd51918f3/fd013/go-clean-arch-boilerplate.jpg 200w,\n/static/8e8dca38a6da2caf6b18efacd51918f3/25252/go-clean-arch-boilerplate.jpg 400w,\n/static/8e8dca38a6da2caf6b18efacd51918f3/2f1b1/go-clean-arch-boilerplate.jpg 800w,\n/static/8e8dca38a6da2caf6b18efacd51918f3/724c8/go-clean-arch-boilerplate.jpg 1000w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"html":"<h2 id=\"chuyện-về-việc-học\" style=\"position:relative;\"><a href=\"#chuy%E1%BB%87n-v%E1%BB%81-vi%E1%BB%87c-h%E1%BB%8Dc\" aria-label=\"chuyện về việc học permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Chuyện về việc học</h2>\n<p>Như các bạn đã biết, mình trước giờ chủ yếu code <strong>đột NÉT</strong>, nhưng lại có thêm vài mối tình ngoài em nó, chẳng hạn PHP, Nodejs... Rồi tình cờ mình nghe tới Golang. Xuất thế vào Obama đệ nhất nguyên niên (2009), là con út của gia tộc Google. Golang sở hữu nhiều thiên tư kinh hãi thế tục. Chẳng hạn như performance nhanh đến thần sầu, memory footprint chấp Nodejs 3 lần, quản lý bất đồng bộ xuất sắc với Goroutine, bên cạnh đó Go cũng rất dễ học và rất dễ tiếp cận.</p>\n<p>Một ngày đẹp trời nọ mình học xong 1 course cơ bản về Go trên udemy, rồi cũng nghiên cứu cách để áp dụng vào thực tế, dựng luôn 1 app sử dụng em nó, tuy nhiên mình vẫn luôn đau đầu với việc suy nghĩ nên áp dụng cấu trúc nào để dễ bề code, maintain, tránh việc bị kẻ maintain chửi như làng Vũ Đại. Dĩ nhiên mình không thể bê tư duy MVC cũng như nhiều thứ từ dotNET qua Go được.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d53f0e83f41017a247798f6dc4ce2842/b17f8/udemy-golang-certificate.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 74.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAezVaAf/xAAWEAEBAQAAAAAAAAAAAAAAAAARASD/2gAIAQEAAQUCSuf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAXEAADAQAAAAAAAAAAAAAAAAAAIDFB/9oACAEBAAY/AtIv/8QAGhABAAMAAwAAAAAAAAAAAAAAAQARIRAxkf/aAAgBAQABPyHZigku/sOoLbnP/9oADAMBAAIAAwAAABDQz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABwQAQACAgMBAAAAAAAAAAAAAAEAETFhEEFRcf/aAAgBAQABPxDcpsW6+QeKXQl8hHxbiCSB3eef/9k='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/d53f0e83f41017a247798f6dc4ce2842/c85cb/udemy-golang-certificate.webp 300w,\n/static/d53f0e83f41017a247798f6dc4ce2842/e88ff/udemy-golang-certificate.webp 600w,\n/static/d53f0e83f41017a247798f6dc4ce2842/92f8c/udemy-golang-certificate.webp 1200w,\n/static/d53f0e83f41017a247798f6dc4ce2842/fad48/udemy-golang-certificate.webp 1600w\"\n              sizes=\"(max-width: 1200px) 100vw, 1200px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/d53f0e83f41017a247798f6dc4ce2842/f93b5/udemy-golang-certificate.jpg 300w,\n/static/d53f0e83f41017a247798f6dc4ce2842/b4294/udemy-golang-certificate.jpg 600w,\n/static/d53f0e83f41017a247798f6dc4ce2842/e5166/udemy-golang-certificate.jpg 1200w,\n/static/d53f0e83f41017a247798f6dc4ce2842/b17f8/udemy-golang-certificate.jpg 1600w\"\n            sizes=\"(max-width: 1200px) 100vw, 1200px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/d53f0e83f41017a247798f6dc4ce2842/e5166/udemy-golang-certificate.jpg\"\n            alt=\"udemy-golang-certificate.jpg\"\n            title=\"udemy-golang-certificate.jpg\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>Mình không nghĩ sẽ áp dụng cấu trúc MVC như trong bài viết <a href=\"/tao-rest-api-tren-nodejs-voi-express-va-prisma-su-dung-typescript\">Tạo REST API với Nodejs và Typescript</a>, vì Golang thường thường sẽ có thể phải áp dụng cả gRPC để giao tiếp giữa các service với nhau, rồi REST để giao tiếp với client, nếu áp gRPC song song REST, vậy mình sẽ sắp xếp cấu trúc Controller như thế nào ? Để business logic ở tầng nào mới được ?</p>\n<h2 id=\"clean-architecture\" style=\"position:relative;\"><a href=\"#clean-architecture\" aria-label=\"clean architecture permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Clean Architecture</h2>\n<p>Gần đây mình có bật trạng thái open to work trên Linkedin, và mình cũng có mong muốn là công việc mới sẽ được dùng Go. Thế là thầy của mình có comment rằng nếu làm Go thì em nghiên cứu clean architecture nhé, nó sinh ra là dành cho Go.\nOkay, thế mình bắt tay vào nghiên cứu clean architect luôn mà tạm thời gác lại những mặt hàng Hexagonal Architecture, Onion Architecture...</p>\n<h4 id=\"sơ-bộ-về-clean-architecture\" style=\"position:relative;\"><a href=\"#s%C6%A1-b%E1%BB%99-v%E1%BB%81-clean-architecture\" aria-label=\"sơ bộ về clean architecture permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Sơ bộ về Clean architecture</h4>\n<p>Clean architecture là 1 triết lý (philosophy) trong thiết kế phần mềm được Robert C. Martin phát minh và đăng tải trên blog của ổng, blog <a href=\"http://cleancoder.com/products\">Uncle Bob</a>. Ông có viết luôn 1 cuốn sách về Clean Architecture, tuy nhiên trong bài viết này chỉ giới hạn những thứ mình tìm hiểu được trong thời gian vừa qua, còn cả 1 bầu trời kiến thức về em nó nữa mà cần chúng ta tìm hiểu tiếp.</p>\n<p>Clean architecture được phát triển từ clean code, mà clean code lại follow <strong>SOLID</strong> principles, chắc hẳn các bạn đã nghe qua:</p>\n<ul>\n<li><strong>S</strong>ingle responsibility principle</li>\n<li><strong>O</strong>pen/closed principle</li>\n<li><strong>L</strong>iskov substitution principle</li>\n<li><strong>I</strong>nterface segregation principle</li>\n<li><strong>D</strong>ependency inversion principle</li>\n</ul>\n<p>Clean architect:\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 772px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/07b2e4403c83a8b377ad14ab3589044c/cc5e0/CleanArchitecture.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.33333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAHSeFSaCjX/xAAZEAADAQEBAAAAAAAAAAAAAAAAAQIhEDH/2gAIAQEAAQUCdMT48Jwnz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABoQAAMBAQEBAAAAAAAAAAAAAAABESExcaH/2gAIAQEAAT8hY58FzVS3lRr1vwx1ulPZ/9oADAMBAAIAAwAAABAsD//EABgRAAMBAQAAAAAAAAAAAAAAAAABQSFR/9oACAEDAQE/EFO0eH//xAAYEQACAwAAAAAAAAAAAAAAAAABERAhMf/aAAgBAgEBPxC2Xkf/xAAbEAEAAgMBAQAAAAAAAAAAAAABABEhMVFhQf/aAAgBAQABPxDS2t1x1l5kGk+kdwCFKhOBoY9gAUrADo9jEpW21n//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/07b2e4403c83a8b377ad14ab3589044c/c85cb/CleanArchitecture.webp 300w,\n/static/07b2e4403c83a8b377ad14ab3589044c/e88ff/CleanArchitecture.webp 600w,\n/static/07b2e4403c83a8b377ad14ab3589044c/ca172/CleanArchitecture.webp 772w\"\n              sizes=\"(max-width: 772px) 100vw, 772px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/07b2e4403c83a8b377ad14ab3589044c/f93b5/CleanArchitecture.jpg 300w,\n/static/07b2e4403c83a8b377ad14ab3589044c/b4294/CleanArchitecture.jpg 600w,\n/static/07b2e4403c83a8b377ad14ab3589044c/cc5e0/CleanArchitecture.jpg 772w\"\n            sizes=\"(max-width: 772px) 100vw, 772px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/07b2e4403c83a8b377ad14ab3589044c/cc5e0/CleanArchitecture.jpg\"\n            alt=\"Clean Architecture Diagram\"\n            title=\"Clean Architecture Diagram\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>Dựa vào hình trên chúng ta có thể thấy mô hình này được chia làm 4 layer chính (không bắt buộc chỉ có 4):</p>\n<ul>\n<li>Entities layer</li>\n<li>Use cases layer</li>\n<li>Interface Adapters layer</li>\n<li>Frameworks &#x26; Drivers layers</li>\n</ul>\n<p>Theo thứ tự từ trong ra ngoài, tầng càng ở phía trong thì càng ít thay đổi và không bị phụ thuộc vào layer phía ngoài và ngược lại. Các layer bên ngoài dễ sửa đổi hơn và sẽ phụ thuộc vào các layer bên trong.</p>\n<h2 id=\"triển-khai-clean-architect-với-golang\" style=\"position:relative;\"><a href=\"#tri%E1%BB%83n-khai-clean-architect-v%E1%BB%9Bi-golang\" aria-label=\"triển khai clean architect với golang permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Triển khai clean architect với Golang</h2>\n<p>Bắt đầu triển khai 1 microsevice dùng để tạo các Todo item cho người dùng, hỗ trợ xác thực bằng JWT token.</p>\n<p>Sử dụng các công nghệ sau:</p>\n<ul>\n<li>Echo framework</li>\n<li>Postgresql + GORM</li>\n<li>Testify cho unit testing</li>\n<li>Logrus để log, UUID...</li>\n<li>Docker để build và support integration tests</li>\n</ul>\n<p>Project structure:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b5835a150487da6fbd9bb589c6a5b437/248b0/folder-structure.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABJ0AAASdAHeZh94AAACDUlEQVQ4y32U2XKcMBBF+Ygk9gyr0C6B2AfGdvkhFZcr//9BN9XyQJw4zsMthJbTfbsFyeX6CB8GrA9PsE0Akxq1NL+lTJyT2mC8bHDdgLwWSKsaGaMnR1rW+HrK8OWUIim5xHp9xOvrTzw9f8e0bBimFeOueUM/XkD7aqHQ+RZD270p9Ai2ARcKOeMoaoGkEgpcG0zbFg+lJUNG0d/rNse4hNUWRlloZWCUAa8F8ts6QSMw5wLdZY4Hv50z3GfFB5HFmks4beG1g1UmQs+3oJQIKamVRS0F1m1EJXRcJMApLw/RO0Un2TbAdwO0byCth7QO2reolX4DlmRZClyvM4TxyCr2KZBqNC4rqJHaNXHufWkikLLKK4Zl7mCa8AG2AwlGsqFHO85xL9f2sLrXPhHGIS0qrEuDcVlwLqp/ZpgxDi51rKHTLo4JWDB+wGKGBDwVFeq2RztMnwIpO7o23vqoisu4l/RHhnRV7vMSqeswbw/gyuAuzT8ACUB7yW6/rGj6EW0/woc+Nim/ZZpQhIIJDNMVYZz+22W6YlJbaOqusbEx9CXt9zcCs7LCfcFQdgtc6HCXFgdkB+9AITWCsvDKQAoVy7B3eO94wtoFmdDw0xij/W33sCxUVDNM6OYFQ7Q9wPgWyjWx67SecBdwfXrGj5cXuLZ7U+iPMdXI3H4aZO2Yu4FITKgYmCz/AqYDj5Yy25y+AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b5835a150487da6fbd9bb589c6a5b437/c85cb/folder-structure.webp 300w,\n/static/b5835a150487da6fbd9bb589c6a5b437/e88ff/folder-structure.webp 600w,\n/static/b5835a150487da6fbd9bb589c6a5b437/92f8c/folder-structure.webp 1200w,\n/static/b5835a150487da6fbd9bb589c6a5b437/c5455/folder-structure.webp 1316w\"\n              sizes=\"(max-width: 1200px) 100vw, 1200px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b5835a150487da6fbd9bb589c6a5b437/5a46d/folder-structure.png 300w,\n/static/b5835a150487da6fbd9bb589c6a5b437/0a47e/folder-structure.png 600w,\n/static/b5835a150487da6fbd9bb589c6a5b437/c1b63/folder-structure.png 1200w,\n/static/b5835a150487da6fbd9bb589c6a5b437/248b0/folder-structure.png 1316w\"\n            sizes=\"(max-width: 1200px) 100vw, 1200px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b5835a150487da6fbd9bb589c6a5b437/c1b63/folder-structure.png\"\n            alt=\"folder-structure.png\"\n            title=\"folder-structure.png\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>Ở đây các tầng như Entities, Usecases, Interface Adapter đều phụ thuộc vào domain chính là Entities, nên mình chia ra thành các module theo Entity là Auth và Todos, nằm trong folder internal.</p>\n<p>Thêm vào đó, những component như Usecase, Handler, Repository không tạo mỗi struct, mà nên implement theo Interface (D trong SOLID).</p>\n<h3 id=\"entities-layer\" style=\"position:relative;\"><a href=\"#entities-layer\" aria-label=\"entities layer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Entities Layer</h3>\n<p>internal/auth/models/user.go:</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> models\n\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"golang.org/x/crypto/bcrypt\"</span>\n\n<span class=\"token keyword\">type</span> User <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">{</span>\n\tId       <span class=\"token builtin\">string</span> <span class=\"token string\">`gorm:\"primary_key\"`</span>\n\tUsername <span class=\"token builtin\">string</span>\n\tPassword <span class=\"token builtin\">string</span>\n\tLimit    <span class=\"token builtin\">int</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span>u <span class=\"token operator\">*</span>User<span class=\"token punctuation\">)</span> <span class=\"token function\">HashPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token builtin\">error</span> <span class=\"token punctuation\">{</span>\n\thashedPassword<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> bcrypt<span class=\"token punctuation\">.</span><span class=\"token function\">GenerateFromPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token function\">byte</span><span class=\"token punctuation\">(</span>u<span class=\"token punctuation\">.</span>Password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> bcrypt<span class=\"token punctuation\">.</span>DefaultCost<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> err\n\t<span class=\"token punctuation\">}</span>\n\tu<span class=\"token punctuation\">.</span>Password <span class=\"token operator\">=</span> <span class=\"token function\">string</span><span class=\"token punctuation\">(</span>hashedPassword<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token boolean\">nil</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span>u <span class=\"token operator\">*</span>User<span class=\"token punctuation\">)</span> <span class=\"token function\">ComparePassword</span><span class=\"token punctuation\">(</span>password <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token builtin\">bool</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">:=</span> bcrypt<span class=\"token punctuation\">.</span><span class=\"token function\">CompareHashAndPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token function\">byte</span><span class=\"token punctuation\">(</span>u<span class=\"token punctuation\">.</span>Password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token function\">byte</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>internal/todos/models/todo.go:</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> models\n\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"time\"</span>\n\n<span class=\"token keyword\">type</span> Todo <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">{</span>\n\tId        <span class=\"token builtin\">string</span> <span class=\"token string\">`gorm:\"primary_key\"`</span>\n\tContent   <span class=\"token builtin\">string</span>\n\tCreatedAt time<span class=\"token punctuation\">.</span>Time\n\tCreatedBy <span class=\"token builtin\">string</span>\n\tUser      User <span class=\"token string\">`gorm:\"foreignKey:CreatedBy\"`</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Tầng entity chứa các enterprise logic nhất và ít thay đổi nhất, chẳng hạn như logic mã hoá password trong model user.</p>\n<h3 id=\"usecases-layer\" style=\"position:relative;\"><a href=\"#usecases-layer\" aria-label=\"usecases layer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Usecases layer</h3>\n<p>auth/usecase.go</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> auth\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n\t<span class=\"token string\">\"context\"</span>\n\t<span class=\"token string\">\"kienmatu/go-todos/internal/models\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">type</span> UseCase <span class=\"token keyword\">interface</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">SignUp</span><span class=\"token punctuation\">(</span>ctx context<span class=\"token punctuation\">.</span>Context<span class=\"token punctuation\">,</span> username<span class=\"token punctuation\">,</span> password <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> limit <span class=\"token builtin\">int</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>models<span class=\"token punctuation\">.</span>User<span class=\"token punctuation\">,</span> <span class=\"token builtin\">error</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token function\">SignIn</span><span class=\"token punctuation\">(</span>ctx context<span class=\"token punctuation\">.</span>Context<span class=\"token punctuation\">,</span> username<span class=\"token punctuation\">,</span> password <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">error</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token function\">ParseToken</span><span class=\"token punctuation\">(</span>ctx context<span class=\"token punctuation\">.</span>Context<span class=\"token punctuation\">,</span> accessToken <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">error</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Implement trong internal/auth/usecase/usecase.go:</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> usecase\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n\t<span class=\"token string\">\"context\"</span>\n\t<span class=\"token string\">\"fmt\"</span>\n\t<span class=\"token string\">\"strings\"</span>\n\t<span class=\"token string\">\"time\"</span>\n\n\t<span class=\"token string\">\"kienmatu/go-todos/internal/auth\"</span>\n\t<span class=\"token string\">\"kienmatu/go-todos/internal/models\"</span>\n\n\t<span class=\"token string\">\"github.com/golang-jwt/jwt\"</span>\n\t<span class=\"token string\">\"github.com/google/uuid\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">type</span> AuthClaims <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">{</span>\n\tjwt<span class=\"token punctuation\">.</span>StandardClaims\n\tUsername <span class=\"token builtin\">string</span> <span class=\"token string\">`json:\"username\"`</span>\n\tUserId   <span class=\"token builtin\">string</span> <span class=\"token string\">`json:\"userId\"`</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">type</span> authUseCase <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">{</span>\n\tuserRepo       auth<span class=\"token punctuation\">.</span>UserRepository\n\thashSalt       <span class=\"token builtin\">string</span>\n\tsigningKey     <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span>\n\texpireDuration time<span class=\"token punctuation\">.</span>Duration\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">NewAuthUseCase</span><span class=\"token punctuation\">(</span>\n\tuserRepo auth<span class=\"token punctuation\">.</span>UserRepository<span class=\"token punctuation\">,</span>\n\thashSalt <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n\tsigningKey <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">,</span>\n\ttokenTTL <span class=\"token builtin\">int64</span><span class=\"token punctuation\">)</span> auth<span class=\"token punctuation\">.</span>UseCase <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token operator\">&amp;</span>authUseCase<span class=\"token punctuation\">{</span>\n\t\tuserRepo<span class=\"token punctuation\">:</span>       userRepo<span class=\"token punctuation\">,</span>\n\t\thashSalt<span class=\"token punctuation\">:</span>       hashSalt<span class=\"token punctuation\">,</span>\n\t\tsigningKey<span class=\"token punctuation\">:</span>     signingKey<span class=\"token punctuation\">,</span>\n\t\texpireDuration<span class=\"token punctuation\">:</span> time<span class=\"token punctuation\">.</span>Second <span class=\"token operator\">*</span> time<span class=\"token punctuation\">.</span><span class=\"token function\">Duration</span><span class=\"token punctuation\">(</span>tokenTTL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span>a <span class=\"token operator\">*</span>authUseCase<span class=\"token punctuation\">)</span> <span class=\"token function\">SignUp</span><span class=\"token punctuation\">(</span>ctx context<span class=\"token punctuation\">.</span>Context<span class=\"token punctuation\">,</span> username<span class=\"token punctuation\">,</span> password <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> limit <span class=\"token builtin\">int</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>models<span class=\"token punctuation\">.</span>User<span class=\"token punctuation\">,</span> <span class=\"token builtin\">error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tfmtusername <span class=\"token operator\">:=</span> strings<span class=\"token punctuation\">.</span><span class=\"token function\">ToLower</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span>\n\teuser<span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">:=</span> a<span class=\"token punctuation\">.</span>userRepo<span class=\"token punctuation\">.</span><span class=\"token function\">GetUserByUsername</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">,</span> fmtusername<span class=\"token punctuation\">)</span>\n\n\t<span class=\"token keyword\">if</span> euser <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">,</span> auth<span class=\"token punctuation\">.</span>ErrUserExisted\n\t<span class=\"token punctuation\">}</span>\n\tuser <span class=\"token operator\">:=</span> <span class=\"token operator\">&amp;</span>models<span class=\"token punctuation\">.</span>User<span class=\"token punctuation\">{</span>\n\t\tId<span class=\"token punctuation\">:</span>       uuid<span class=\"token punctuation\">.</span><span class=\"token function\">New</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">String</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\tUsername<span class=\"token punctuation\">:</span> fmtusername<span class=\"token punctuation\">,</span>\n\t\tPassword<span class=\"token punctuation\">:</span> password<span class=\"token punctuation\">,</span>\n\t\tLimit<span class=\"token punctuation\">:</span>    limit<span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">}</span>\n\tuser<span class=\"token punctuation\">.</span><span class=\"token function\">HashPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\terr <span class=\"token operator\">:=</span> a<span class=\"token punctuation\">.</span>userRepo<span class=\"token punctuation\">.</span><span class=\"token function\">CreateUser</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">,</span> err\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">return</span> a<span class=\"token punctuation\">.</span>userRepo<span class=\"token punctuation\">.</span><span class=\"token function\">GetUserByUsername</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">,</span> username<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span>a <span class=\"token operator\">*</span>authUseCase<span class=\"token punctuation\">)</span> <span class=\"token function\">SignIn</span><span class=\"token punctuation\">(</span>ctx context<span class=\"token punctuation\">.</span>Context<span class=\"token punctuation\">,</span> username<span class=\"token punctuation\">,</span> password <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tuser<span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">:=</span> a<span class=\"token punctuation\">.</span>userRepo<span class=\"token punctuation\">.</span><span class=\"token function\">GetUserByUsername</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">,</span> username<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">if</span> user <span class=\"token operator\">==</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> auth<span class=\"token punctuation\">.</span>ErrUserNotFound\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">if</span> <span class=\"token operator\">!</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">ComparePassword</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> auth<span class=\"token punctuation\">.</span>ErrWrongPassword\n\t<span class=\"token punctuation\">}</span>\n\n\tclaims <span class=\"token operator\">:=</span> AuthClaims<span class=\"token punctuation\">{</span>\n\t\tUsername<span class=\"token punctuation\">:</span> user<span class=\"token punctuation\">.</span>Username<span class=\"token punctuation\">,</span>\n\t\tUserId<span class=\"token punctuation\">:</span>   user<span class=\"token punctuation\">.</span>Id<span class=\"token punctuation\">,</span>\n\t\tStandardClaims<span class=\"token punctuation\">:</span> jwt<span class=\"token punctuation\">.</span>StandardClaims<span class=\"token punctuation\">{</span>\n\t\t\tIssuedAt<span class=\"token punctuation\">:</span>  time<span class=\"token punctuation\">.</span><span class=\"token function\">Now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Unix</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\tIssuer<span class=\"token punctuation\">:</span>    <span class=\"token string\">\"go-todos\"</span><span class=\"token punctuation\">,</span>\n\t\t\tExpiresAt<span class=\"token punctuation\">:</span> time<span class=\"token punctuation\">.</span><span class=\"token function\">Now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">.</span>expireDuration<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Unix</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">}</span>\n\n\ttoken <span class=\"token operator\">:=</span> jwt<span class=\"token punctuation\">.</span><span class=\"token function\">NewWithClaims</span><span class=\"token punctuation\">(</span>jwt<span class=\"token punctuation\">.</span>SigningMethodHS256<span class=\"token punctuation\">,</span> claims<span class=\"token punctuation\">)</span>\n\n\t<span class=\"token keyword\">return</span> token<span class=\"token punctuation\">.</span><span class=\"token function\">SignedString</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">.</span>signingKey<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span>a <span class=\"token operator\">*</span>authUseCase<span class=\"token punctuation\">)</span> <span class=\"token function\">ParseToken</span><span class=\"token punctuation\">(</span>ctx context<span class=\"token punctuation\">.</span>Context<span class=\"token punctuation\">,</span> accessToken <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\ttoken<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> jwt<span class=\"token punctuation\">.</span><span class=\"token function\">ParseWithClaims</span><span class=\"token punctuation\">(</span>accessToken<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>AuthClaims<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">func</span><span class=\"token punctuation\">(</span>token <span class=\"token operator\">*</span>jwt<span class=\"token punctuation\">.</span>Token<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">interface</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span> ok <span class=\"token operator\">:=</span> token<span class=\"token punctuation\">.</span>Method<span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>jwt<span class=\"token punctuation\">.</span>SigningMethodHMAC<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">!</span>ok <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">return</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">,</span> fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Errorf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"unexpected signing method: %v\"</span><span class=\"token punctuation\">,</span> token<span class=\"token punctuation\">.</span>Header<span class=\"token punctuation\">[</span><span class=\"token string\">\"alg\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">return</span> a<span class=\"token punctuation\">.</span>signingKey<span class=\"token punctuation\">,</span> <span class=\"token boolean\">nil</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> err\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">if</span> claims<span class=\"token punctuation\">,</span> ok <span class=\"token operator\">:=</span> token<span class=\"token punctuation\">.</span>Claims<span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>AuthClaims<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> ok <span class=\"token operator\">&amp;&amp;</span> token<span class=\"token punctuation\">.</span>Valid <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> claims<span class=\"token punctuation\">.</span>UserId<span class=\"token punctuation\">,</span> <span class=\"token boolean\">nil</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">return</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> auth<span class=\"token punctuation\">.</span>ErrInvalidAccessToken\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Ở đây ta thấy được lợi thế của Dependency Inversion trong SOLID. Chúng ta có thể implement 1 usecase khác, sử dụng repository khác tuy nhiên vẫn implement usecase interface và không thay đổi logic chính của app.</p>\n<ul>\n<li><strong><span style=\"color:#ffc107\">Note</span></strong>:\nKhi mình chuyển từ ngôn ngữ khác qua Go, mình đã tìm hiểu về naming convention standard làm sao cho không bị conflict giữa interface và struct, mình có thử theo cách thêm prefix I vào trước interface như C#, tuy nhiên trong Go làm như vậy hơi lạ lạ, khi chúng ta muốn gọi Interface thì phải gõ chữ I, và editor sẽ suggest hàng tá interface. Nên mình áp dụng 1 cách khác, tên của Interface và struct implement nó sẽ trùng nhau, tuy nhiên struct đó sẽ không được export ra ngoài (Non-Capitalized).\n<ul>\n<li>Old way:\n<ul>\n<li><code class=\"language-text\">type IUseCase interface</code></li>\n<li><code class=\"language-text\">type UseCase struct</code></li>\n</ul>\n</li>\n<li>New way:\n<ul>\n<li><code class=\"language-text\">type UseCase interface</code></li>\n<li><code class=\"language-text\">type useCase struct</code></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"interface-adapters-layer\" style=\"position:relative;\"><a href=\"#interface-adapters-layer\" aria-label=\"interface adapters layer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Interface Adapters layer</h3>\n<p>Như diagram phía trên, app của chúng ta sẽ có handler tương tự như controller để expose api.</p>\n<p>cmd/api/main.go:</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> main\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n\t<span class=\"token string\">\"log\"</span>\n\n\t<span class=\"token string\">\"kienmatu/go-todos/config\"</span>\n\t<span class=\"token string\">\"kienmatu/go-todos/db\"</span>\n\t<span class=\"token string\">\"kienmatu/go-todos/internal/server\"</span>\n\n\t<span class=\"token string\">\"github.com/sirupsen/logrus\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Starting api server\"</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token comment\">// Initialize config</span>\n\tcfg <span class=\"token operator\">:=</span> config<span class=\"token punctuation\">.</span><span class=\"token function\">NewConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\tdb <span class=\"token operator\">:=</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">GetPostgresInstance</span><span class=\"token punctuation\">(</span>cfg<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n\ts <span class=\"token operator\">:=</span> server<span class=\"token punctuation\">.</span><span class=\"token function\">NewServer</span><span class=\"token punctuation\">(</span>cfg<span class=\"token punctuation\">,</span> db<span class=\"token punctuation\">,</span> logrus<span class=\"token punctuation\">.</span><span class=\"token function\">New</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">:=</span> s<span class=\"token punctuation\">.</span><span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Fatal</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>config/config.go:</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> main\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n\t<span class=\"token string\">\"log\"</span>\n\n\t<span class=\"token string\">\"kienmatu/go-todos/config\"</span>\n\t<span class=\"token string\">\"kienmatu/go-todos/db\"</span>\n\t<span class=\"token string\">\"kienmatu/go-todos/internal/server\"</span>\n\n\t<span class=\"token string\">\"github.com/sirupsen/logrus\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Starting api server\"</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token comment\">// Initialize config</span>\n\tcfg <span class=\"token operator\">:=</span> config<span class=\"token punctuation\">.</span><span class=\"token function\">NewConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\tdb <span class=\"token operator\">:=</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">GetPostgresInstance</span><span class=\"token punctuation\">(</span>cfg<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n\ts <span class=\"token operator\">:=</span> server<span class=\"token punctuation\">.</span><span class=\"token function\">NewServer</span><span class=\"token punctuation\">(</span>cfg<span class=\"token punctuation\">,</span> db<span class=\"token punctuation\">,</span> logrus<span class=\"token punctuation\">.</span><span class=\"token function\">New</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">:=</span> s<span class=\"token punctuation\">.</span><span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Fatal</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Ngoài ra thì tầng này còn có phức tạp hơn: <code class=\"language-text\">handler</code>, <code class=\"language-text\">middleware</code> (bao gồm middleware cho từng module, middle dùng chung cho tất cả...) và <code class=\"language-text\">presenter</code>.</p>\n<p><strong>Handler</strong> nằm trong folder <code class=\"language-text\">delivery/http</code> chịu trách nhiệm xử lý HTTP request sử dụng Usecase để xử lý logic business. Okay quay trở lại vấn đề ban đầu, bây giờ nếu mình muốn sử dụng thêm gRPC để giao tiếp giữa các service, mình chỉ cần thêm component vào <code class=\"language-text\">delivery/grpc</code></p>\n<p><strong>Presenter</strong> Ở đây sẽ chịu trách nhiệm cho việc dữ liệu được hiển thị ra ngoài từ response của handler, chẳng hạn như response của việc login/register sẽ không thể nào show ra password được, do đó ở <code class=\"language-text\">presenter</code> của module <code class=\"language-text\">auth</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> presenter\n\n<span class=\"token keyword\">type</span> SignUpInput <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">{</span>\n\tUsername <span class=\"token builtin\">string</span> <span class=\"token string\">`json:\"username\"`</span>\n\tPassword <span class=\"token builtin\">string</span> <span class=\"token string\">`json:\"password\"`</span>\n\tLimit    <span class=\"token builtin\">int</span>    <span class=\"token string\">`json:\"limit\"`</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">type</span> SignUpResponse <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">{</span>\n\tId       <span class=\"token builtin\">string</span> <span class=\"token string\">`json:\"id\"`</span>\n\tUsername <span class=\"token builtin\">string</span> <span class=\"token string\">`json:\"username\"`</span>\n\tLimit    <span class=\"token builtin\">int</span>    <span class=\"token string\">`json:\"limit\"`</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h3 id=\"frameworks--dbs-layer\" style=\"position:relative;\"><a href=\"#frameworks--dbs-layer\" aria-label=\"frameworks  dbs layer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Frameworks &#x26; DBs Layer</h3>\n<p>Theo bác Bob quý mến, thì layer này chính là layer ngoài cùng, và mọi chi tiết của app đều nằm tại đây:\nChúng ta có interface Repository và struct repository sử dụng em nó.</p>\n<p>Ví dụ như UserRepository:</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> auth\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n\t<span class=\"token string\">\"context\"</span>\n\t<span class=\"token string\">\"kienmatu/go-todos/internal/models\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> CtxUserKey <span class=\"token operator\">=</span> <span class=\"token string\">\"userId\"</span>\n\n<span class=\"token keyword\">type</span> UserRepository <span class=\"token keyword\">interface</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">CreateUser</span><span class=\"token punctuation\">(</span>ctx context<span class=\"token punctuation\">.</span>Context<span class=\"token punctuation\">,</span> user <span class=\"token operator\">*</span>models<span class=\"token punctuation\">.</span>User<span class=\"token punctuation\">)</span> <span class=\"token builtin\">error</span>\n\t<span class=\"token function\">GetUserByUsername</span><span class=\"token punctuation\">(</span>ctx context<span class=\"token punctuation\">.</span>Context<span class=\"token punctuation\">,</span> username <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>models<span class=\"token punctuation\">.</span>User<span class=\"token punctuation\">,</span> <span class=\"token builtin\">error</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token function\">GetUserById</span><span class=\"token punctuation\">(</span>ctx context<span class=\"token punctuation\">.</span>Context<span class=\"token punctuation\">,</span> userId <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>models<span class=\"token punctuation\">.</span>User<span class=\"token punctuation\">,</span> <span class=\"token builtin\">error</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Về phần framework, chúng ta sử dụng echo framework, là 1 framework được sử dụng phổ biến trong cộng đồng Go. Có 1 vài component được chia ra để dễ bề quản lý hơn như <code class=\"language-text\">middleware manager</code>, <code class=\"language-text\">routes</code>, <code class=\"language-text\">server</code>, <code class=\"language-text\">handler</code> (handler này để gom các handler và route lại cho server)...</p>\n<p>Trong server:</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> server\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n\t<span class=\"token string\">\"context\"</span>\n\t<span class=\"token string\">\"kienmatu/go-todos/config\"</span>\n\t<span class=\"token string\">\"net/http\"</span>\n\t<span class=\"token string\">\"os\"</span>\n\t<span class=\"token string\">\"os/signal\"</span>\n\t<span class=\"token string\">\"syscall\"</span>\n\t<span class=\"token string\">\"time\"</span>\n\n\t<span class=\"token string\">\"github.com/labstack/echo/v4\"</span>\n\t<span class=\"token string\">\"github.com/sirupsen/logrus\"</span>\n\t<span class=\"token string\">\"gorm.io/gorm\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">type</span> Server <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">{</span>\n\techo   <span class=\"token operator\">*</span>echo<span class=\"token punctuation\">.</span>Echo\n\tcfg    <span class=\"token operator\">*</span>config<span class=\"token punctuation\">.</span>Configuration\n\tdb     <span class=\"token operator\">*</span>gorm<span class=\"token punctuation\">.</span>DB\n\tlogger <span class=\"token operator\">*</span>logrus<span class=\"token punctuation\">.</span>Logger\n\tready  <span class=\"token keyword\">chan</span> <span class=\"token builtin\">bool</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">NewServer</span><span class=\"token punctuation\">(</span>cfg <span class=\"token operator\">*</span>config<span class=\"token punctuation\">.</span>Configuration<span class=\"token punctuation\">,</span> db <span class=\"token operator\">*</span>gorm<span class=\"token punctuation\">.</span>DB<span class=\"token punctuation\">,</span> logger <span class=\"token operator\">*</span>logrus<span class=\"token punctuation\">.</span>Logger<span class=\"token punctuation\">,</span> ready <span class=\"token keyword\">chan</span> <span class=\"token builtin\">bool</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span>Server <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token operator\">&amp;</span>Server<span class=\"token punctuation\">{</span>echo<span class=\"token punctuation\">:</span> echo<span class=\"token punctuation\">.</span><span class=\"token function\">New</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> cfg<span class=\"token punctuation\">:</span> cfg<span class=\"token punctuation\">,</span> db<span class=\"token punctuation\">:</span> db<span class=\"token punctuation\">,</span> logger<span class=\"token punctuation\">:</span> logger<span class=\"token punctuation\">,</span> ready<span class=\"token punctuation\">:</span> ready<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span>s <span class=\"token operator\">*</span>Server<span class=\"token punctuation\">)</span> <span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token builtin\">error</span> <span class=\"token punctuation\">{</span>\n\tserver <span class=\"token operator\">:=</span> <span class=\"token operator\">&amp;</span>http<span class=\"token punctuation\">.</span>Server<span class=\"token punctuation\">{</span>\n\t\tAddr<span class=\"token punctuation\">:</span>         <span class=\"token string\">\":\"</span> <span class=\"token operator\">+</span> s<span class=\"token punctuation\">.</span>cfg<span class=\"token punctuation\">.</span>Port<span class=\"token punctuation\">,</span>\n\t\tWriteTimeout<span class=\"token punctuation\">:</span> <span class=\"token number\">15</span> <span class=\"token operator\">*</span> time<span class=\"token punctuation\">.</span>Second<span class=\"token punctuation\">,</span>\n\t\tReadTimeout<span class=\"token punctuation\">:</span>  <span class=\"token number\">15</span> <span class=\"token operator\">*</span> time<span class=\"token punctuation\">.</span>Second<span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">go</span> <span class=\"token keyword\">func</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\ts<span class=\"token punctuation\">.</span>logger<span class=\"token punctuation\">.</span><span class=\"token function\">Logf</span><span class=\"token punctuation\">(</span>logrus<span class=\"token punctuation\">.</span>InfoLevel<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Server is listening on PORT: %s\"</span><span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">.</span>cfg<span class=\"token punctuation\">.</span>Port<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">:=</span> s<span class=\"token punctuation\">.</span>echo<span class=\"token punctuation\">.</span><span class=\"token function\">StartServer</span><span class=\"token punctuation\">(</span>server<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n\t\t\ts<span class=\"token punctuation\">.</span>logger<span class=\"token punctuation\">.</span><span class=\"token function\">Fatalln</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error starting Server: \"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">:=</span> s<span class=\"token punctuation\">.</span><span class=\"token function\">MapHandlers</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">.</span>echo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> err\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">if</span> s<span class=\"token punctuation\">.</span>ready <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n\t\ts<span class=\"token punctuation\">.</span>ready <span class=\"token operator\">&lt;-</span> <span class=\"token boolean\">true</span>\n\t<span class=\"token punctuation\">}</span>\n\n\tquit <span class=\"token operator\">:=</span> <span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">chan</span> os<span class=\"token punctuation\">.</span>Signal<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\tsignal<span class=\"token punctuation\">.</span><span class=\"token function\">Notify</span><span class=\"token punctuation\">(</span>quit<span class=\"token punctuation\">,</span> os<span class=\"token punctuation\">.</span>Interrupt<span class=\"token punctuation\">,</span> syscall<span class=\"token punctuation\">.</span>SIGTERM<span class=\"token punctuation\">)</span>\n\n\t<span class=\"token operator\">&lt;-</span>quit\n\n\tctx<span class=\"token punctuation\">,</span> shutdown <span class=\"token operator\">:=</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">WithTimeout</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">Background</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token operator\">*</span>time<span class=\"token punctuation\">.</span>Second<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">defer</span> <span class=\"token function\">shutdown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n\ts<span class=\"token punctuation\">.</span>logger<span class=\"token punctuation\">.</span><span class=\"token function\">Fatalln</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Server Exited Properly\"</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> s<span class=\"token punctuation\">.</span>echo<span class=\"token punctuation\">.</span>Server<span class=\"token punctuation\">.</span><span class=\"token function\">Shutdown</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h2 id=\"tổng-kết\" style=\"position:relative;\"><a href=\"#t%E1%BB%95ng-k%E1%BA%BFt\" aria-label=\"tổng kết permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tổng kết</h2>\n<p>Các bạn có thể vào repo của mình <a href=\"https://github.com/kienmatu/togo\">Golang todo clean architecture</a> và đọc readme để xem hướng dẫn chạy thử và xem.</p>\n<p>Yeah mục đích cuối cùng của việc áp dụng các design principle cũng là hỗ trợ việc code và maintain thuận lợi hơn, các bạn có thể custom lại cho phù hợp nhất với dự án. Cấu trúc này hoàn toàn có thể áp dụng sang cho các ngôn ngữ lập trình và framework khác chứ không bị gói gọn trong Go.</p>\n<p>Code của mình được tham khảo dựa trên <a href=\"https://github.com/AleksK1NG/Go-Clean-Architecture-REST-API\">repo này</a>, đa tạ tác giả ❤️❤️</p>"},"primaryTag":null,"prev":{"frontmatter":{"title":"Tạo REST API trên Nodejs với Express và Prisma sử dụng Typescript","path":"/tao-rest-api-tren-nodejs-voi-express-va-prisma-su-dung-typescript"}},"next":{"frontmatter":{"title":"Ngôn ngữ lập trình nào tốt nhất, có thực sự ngôn ngữ không quan trọng?","path":"/ngon-ngu-lap-trinh-nao-tot-nhat-co-thuc-su-ngon-ngu-khong-qu"}}},"pageContext":{"postId":"bf917d97-3702-5dc0-bb35-1f61134f6389","primaryTag":"Golang","prevId":"5dc8e7ba-04d6-5c31-9b4f-c8ea50609c9f","nextId":"19c8eab7-b585-537a-9e73-7a8123c94066"}},"staticQueryHashes":["1116962356","2275848304","3082461530","4133584024","545095672"]}