<!DOCTYPE html><html lang="vi"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 4.25.0"/><meta data-react-helmet="true" name="description" content="Mình muốn tiếp tục bằng tối ưu hiệu năng database, phần đầu tiên sẽ là connection pooling. Vậy connection pooling là gì? Sử dụng connection pool như thế nào?"/><meta data-react-helmet="true" name="og:title" content="Connection pooling: Tổng quan và implement benchmark"/><meta data-react-helmet="true" name="og:type" content="website"/><meta data-react-helmet="true" name="og:description" content="Mình muốn tiếp tục bằng tối ưu hiệu năng database, phần đầu tiên sẽ là connection pooling. Vậy connection pooling là gì? Sử dụng connection pool như thế nào?"/><meta data-react-helmet="true" name="og:url" content="https://devgiangho.github.io/connection-pooling-tong-quan-va-implement-benchmark/"/><meta data-react-helmet="true" name="twitter:label1" content="Written by"/><meta data-react-helmet="true" name="twitter:data1" content="Kiên Đinh"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Kiên Đinh"/><meta data-react-helmet="true" name="twitter:title" content="Connection pooling: Tổng quan và implement benchmark"/><meta data-react-helmet="true" name="twitter:description" content="Mình muốn tiếp tục bằng tối ưu hiệu năng database, phần đầu tiên sẽ là connection pooling. Vậy connection pooling là gì? Sử dụng connection pool như thế nào?"/><meta data-react-helmet="true" name="keywords" content="JavaScript, .NET, Go, NodeJs, Vạn Vật, Backend, Web, Go"/><meta data-react-helmet="true" name="article:published_time" content="2023-03-29T15:06:30.504Z"/><meta data-react-helmet="true" name="article:modified_time" content="2023-04-09T10:06:30.504Z"/><meta data-react-helmet="true" name="twitter:label2" content="Filed under"/><meta data-react-helmet="true" name="twitter:data2" content="Backend"/><meta data-react-helmet="true" name="og:image" content="https://devgiangho.github.io//static/5d70a032bfc7060682647360314a9e25/5d1ed/blog-database-connection-pooling.png"/><meta data-react-helmet="true" name="twitter:image" content="https://devgiangho.github.io//static/5d70a032bfc7060682647360314a9e25/5d1ed/blog-database-connection-pooling.png"/><meta name="theme-color" content="#a4cbb8"/><style data-href="/styles.8688c389d7251e1860d6.css" data-identity="gatsby-global-css">@font-face{font-named-instance:"Regular";font-display:swap;font-family:JetbrainsMono;font-style:normal;font-weight:100 900;src:url(/fonts/JetBrainsMono-Regular.woff2) format("woff2")}code,pre{font-family:JetbrainsMono,Consolas,monospace!important}code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#f8f8f2;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;-o-tab-size:4;tab-size:4;text-align:left;text-shadow:0 1px rgba(0,0,0,.3);white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{border-radius:.3em;margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#f8f8f2}.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}article.post ol ol,article.post ol ul,article.post ul ol,article.post ul ul{-webkit-padding-start:1rem;padding-inline-start:1rem}</style><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><script>
  
  function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='UA-149502908-1',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-149502908-1', 'auto', {});
      ga('set', 'anonymizeIp', true);
      
      
      
      
      }</script><title data-react-helmet="true">Connection pooling: Tổng quan và implement benchmark</title><link data-react-helmet="true" rel="preconnect" href="https://giscus.app"/><link data-react-helmet="true" rel="dns-prefetch" href="https://giscus.app"/><script data-react-helmet="true" type="application/ld+json">
        {
          "@context": "https://schema.org/",
          "@type": "Article",
          "author": {
            "@type": "Person",
            "name": "Kiên Đinh"
          },
          "keywords": "Backend, Web, Go",
          "headline": "Connection pooling: Tổng quan và implement benchmark",
          "url": "https://devgiangho.github.io/connection-pooling-tong-quan-va-implement-benchmark/",
          "datePublished": "2023-03-29T15:06:30.504Z",
          "dateModified": "2023-04-09T10:06:30.504Z",
          "image": {
            "@type": "ImageObject",
            "url": "https://devgiangho.github.io//static/5d70a032bfc7060682647360314a9e25/5d1ed/blog-database-connection-pooling.png",
            "width": "1000",
            "height": "520"
          },
          "publisher": {
            "@type": "Organization",
            "name": "Dev Giang Hồ - Blog for Devs"
          },
          "description": "Mình muốn tiếp tục bằng tối ưu hiệu năng database, phần đầu tiên sẽ là connection pooling. Vậy connection pooling là gì? Sử dụng connection pool như thế nào?",
          "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://devgiangho.github.io"
          }
        }
      </script><style data-styled="" data-styled-version="5.3.3">html{line-height:1.15;-webkit-text-size-adjust:100%;}/*!sc*/
body{margin:0;}/*!sc*/
main{display:block;}/*!sc*/
h1{font-size:2em;margin:0.67em 0;}/*!sc*/
hr{box-sizing:content-box;height:0;overflow:visible;}/*!sc*/
pre{font-family:monospace,monospace;font-size:1em;}/*!sc*/
a{background-color:transparent;}/*!sc*/
abbr[title]{border-bottom:none;-webkit-text-decoration:underline;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted;}/*!sc*/
b,strong{font-weight:bolder;}/*!sc*/
code,kbd,samp{font-family:monospace,monospace;font-size:1em;}/*!sc*/
small{font-size:80%;}/*!sc*/
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline;}/*!sc*/
sub{bottom:-0.25em;}/*!sc*/
sup{top:-0.5em;}/*!sc*/
img{border-style:none;}/*!sc*/
button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0;}/*!sc*/
button,input{overflow:visible;}/*!sc*/
button,select{text-transform:none;}/*!sc*/
button,[type="button"],[type="reset"],[type="submit"]{-webkit-appearance:button;}/*!sc*/
button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0;}/*!sc*/
button:-moz-focusring,[type="button"]:-moz-focusring,[type="reset"]:-moz-focusring,[type="submit"]:-moz-focusring{outline:1px dotted ButtonText;}/*!sc*/
fieldset{padding:0.35em 0.75em 0.625em;}/*!sc*/
legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal;}/*!sc*/
progress{vertical-align:baseline;}/*!sc*/
textarea{overflow:auto;}/*!sc*/
[type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0;}/*!sc*/
[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{height:auto;}/*!sc*/
[type="search"]{-webkit-appearance:textfield;outline-offset:-2px;}/*!sc*/
[type="search"]::-webkit-search-decoration{-webkit-appearance:none;}/*!sc*/
::-webkit-file-upload-button{-webkit-appearance:button;font:inherit;}/*!sc*/
details{display:block;}/*!sc*/
summary{display:list-item;}/*!sc*/
template{display:none;}/*!sc*/
[hidden]{display:none;}/*!sc*/
html{box-sizing:border-box;background-color:#fafafa;}/*!sc*/
body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;line-height:1.9em;}/*!sc*/
*{box-sizing:border-box;}/*!sc*/
p .footnote-ref{color:#067a5f;font-size:0.9rem;display:inline-block;-webkit-scroll-margin-top:4.7rem;-moz-scroll-margin-top:4.7rem;-ms-scroll-margin-top:4.7rem;scroll-margin-top:4.7rem;-webkit-overflow-scrolling:touch;}/*!sc*/
.footnote-list-item{-webkit-scroll-margin-top:4.9rem;-moz-scroll-margin-top:4.9rem;-ms-scroll-margin-top:4.9rem;scroll-margin-top:4.9rem;}/*!sc*/
h1,h2,h3,h4,h5,h6{outline:none;}/*!sc*/
a{color:#000;-webkit-text-decoration:none;text-decoration:none;}/*!sc*/
.gatsby-highlight{max-width:100% !important;}/*!sc*/
.gatsby-highlight-code-line{background-color:#353631;display:block;margin-right:-1em;margin-left:-1em;padding-right:1em;padding-left:0.75em;}/*!sc*/
.interactive-gif .embedded{position:relative;width:100%;height:auto;}/*!sc*/
.interactive-gif .loading,.interactive-gif .still-container,.interactive-gif .gif-container{position:absolute;top:0;width:100%;height:100%;}/*!sc*/
.interactive-gif .still,.interactive-gif .gif{width:100%;height:100%;cursor:pointer;}/*!sc*/
.interactive-gif .loading .indicator{position:absolute;bottom:0;left:0;width:80px;-webkit-filter:contrast(0.5);filter:contrast(0.5);}/*!sc*/
.interactive-gif .still-container .play{cursor:pointer;-webkit-filter:grayscale(100%);filter:grayscale(100%);width:20%;position:absolute;opacity:0.9;left:50%;top:50%;-webkit-transform:translateX(-50%) translateY(-50%);-ms-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%);}/*!sc*/
.interactive-gif .caption{font-size:90%;font-style:italic;}/*!sc*/
.interactive-gif .placeholder{-webkit-filter:grayscale(100%);filter:grayscale(100%);text-align:center;}/*!sc*/
.interactive-gif .placeholder img{width:200px;display:none;}/*!sc*/
article code:not(pre > code){border:0.1rem solid rgba(0,0,0,0.1);font-weight:300;border-radius:0.25rem;background-color:rgb(245 245 245) !important;text-shadow:none !important;padding-top:0.2rem !important;padding-bottom:0.1rem !important;padding-left:0.125rem !important;padding-right:0.125rem !important;color:rgb(11 11 11) !important;}/*!sc*/
data-styled.g2[id="sc-global-fIUfrS1"]{content:"sc-global-fIUfrS1,"}/*!sc*/
.hhzXsP{width:1260px;margin-left:auto;margin-right:auto;max-width:100%;}/*!sc*/
@media (max-width:1300px){.hhzXsP{padding:0 20px;}}/*!sc*/
data-styled.g3[id="common__Container-sc-yvdkhc-0"]{content:"hhzXsP,"}/*!sc*/
.eBjOxQ{z-index:1000;background-color:#20232a;position:-webkit-sticky;position:sticky;top:0;box-shadow:0 0 3px rgba(0,0,0,.03),0 3px 46px rgba(0,0,0,.07);}/*!sc*/
data-styled.g5[id="style__NavContainer-sc-jhe81k-0"]{content:"eBjOxQ,"}/*!sc*/
.hRmTxB{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;position:relative;}/*!sc*/
data-styled.g6[id="style__Nav-sc-jhe81k-1"]{content:"hRmTxB,"}/*!sc*/
.kkNwJo{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;height:70px;white-space:nowrap;}/*!sc*/
@media (max-width:576px){.kkNwJo{width:90%;}}/*!sc*/
data-styled.g7[id="style__NavWrapper-sc-jhe81k-2"]{content:"kkNwJo,"}/*!sc*/
.cPsfUr{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;list-style-type:none;margin:0;padding:0;}/*!sc*/
@media (max-width:576px){.cPsfUr{width:80%;overflow-x:auto;overflow-y:hidden;-webkit-mask-image:linear-gradient(to right,transparent,#000 25px,#000 90%,transparent);mask-image:linear-gradient(to right,transparent,#000 25px,#000 90%,transparent);}}/*!sc*/
.jPyOnZ{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;list-style-type:none;margin:0;padding:0;}/*!sc*/
data-styled.g8[id="style__NavMenu-sc-jhe81k-3"]{content:"cPsfUr,jPyOnZ,"}/*!sc*/
.fPrbPq{cursor:pointer;display:inline-block;border:0;background:transparent;outline:none;-webkit-text-decoration:none;text-decoration:none;}/*!sc*/
data-styled.g9[id="style__NavMenuItem-sc-jhe81k-4"]{content:"fPrbPq,"}/*!sc*/
.bdMJer{color:#fff;opacity:.8;padding:16px;-webkit-transition:opacity .5s;transition:opacity .5s;}/*!sc*/
.bdMJer:hover{opacity:1;}/*!sc*/
data-styled.g10[id="style__NavLink-sc-jhe81k-5"]{content:"bdMJer,"}/*!sc*/
.dSpRmA{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;position:relative;}/*!sc*/
data-styled.g11[id="style__SearchContainer-sc-jhe81k-6"]{content:"dSpRmA,"}/*!sc*/
.cbBsOC{cursor:pointer;color:#fff;opacity:.8;background:none;outline:none;border:0;-webkit-transition:opacity .5s;transition:opacity .5s;}/*!sc*/
.cbBsOC:hover{opacity:1;}/*!sc*/
data-styled.g12[id="style__ToggleSearchButton-sc-jhe81k-7"]{content:"cbBsOC,"}/*!sc*/
.jIujQe{max-height:30px;width:30px;margin-right:45px;}/*!sc*/
@media (max-width:576px){.jIujQe{margin-right:15px;}}/*!sc*/
data-styled.g20[id="logo__LogoImage-sc-1ta2zdq-0"]{content:"jIujQe,"}/*!sc*/
.dYGSok{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;height:30px;}/*!sc*/
data-styled.g21[id="logo__HomeLink-sc-1ta2zdq-1"]{content:"dYGSok,"}/*!sc*/
.hNmZFn{max-width:100%;padding:10px 0;z-index:700;position:relative;font-size:.9em;margin-top:50px;}/*!sc*/
data-styled.g27[id="style__StyledFooter-sc-1bbyksd-0"]{content:"hNmZFn,"}/*!sc*/
.kRFmqs{text-align:right;line-height:1.1em;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}/*!sc*/
data-styled.g28[id="style__FooterContainer-sc-1bbyksd-1"]{content:"kRFmqs,"}/*!sc*/
.eFaQjI{margin:0;}/*!sc*/
data-styled.g29[id="style__Copyright-sc-1bbyksd-2"]{content:"eFaQjI,"}/*!sc*/
.hFClol{margin:0;opacity:.8;font-size:.8em;}/*!sc*/
.hFClol a{font-weight:bold;-webkit-text-decoration:none;text-decoration:none;color:#000;}/*!sc*/
.hFClol a:hover{-webkit-text-decoration:underline;text-decoration:underline;}/*!sc*/
data-styled.g30[id="style__DesignBy-sc-1bbyksd-3"]{content:"hFClol,"}/*!sc*/
.hCiwIZ ul{list-style-type:none;margin:0;padding:0;}/*!sc*/
.hCiwIZ li{display:inline-block;margin-right:25px;}/*!sc*/
.hCiwIZ li:last-child{margin-right:0;}/*!sc*/
data-styled.g31[id="style__StyledNav-sc-1bbyksd-4"]{content:"hCiwIZ,"}/*!sc*/
.RdnGO{color:#000;-webkit-text-decoration:none;text-decoration:none;}/*!sc*/
data-styled.g33[id="style__FooterMenuLink-sc-1bbyksd-6"]{content:"RdnGO,"}/*!sc*/
.fmlDtj > ul{list-style-type:none;margin:0;padding:0;}/*!sc*/
.fmlDtj > ul li{line-height:1.2em;list-style-type:none;padding-top:0.3em;padding-bottom:0.3em;}/*!sc*/
.fmlDtj > ul li:last-child{padding-bottom:0;}/*!sc*/
.fmlDtj > ul ul,.fmlDtj > ul li,.fmlDtj > ul ol{margin-left:-0.7rem;}/*!sc*/
.fmlDtj a{color:#808080;-webkit-text-decoration:none;text-decoration:none;}/*!sc*/
.fmlDtj a:hover{cursor:pointer;}/*!sc*/
.fmlDtj .is-active{color:#404040;font-weight:700;}/*!sc*/
data-styled.g34[id="toc__StyledNav-sc-1rcn1mg-0"]{content:"fmlDtj,"}/*!sc*/
.bGzPfA{position:-webkit-sticky;position:sticky;height:5px;top:70px;background-color:#a4cbb8;z-index:500;}/*!sc*/
data-styled.g35[id="reading-progress__ReadingProgressBar-sc-1h92jbi-0"]{content:"bGzPfA,"}/*!sc*/
.eWZpEr{list-style-type:none;margin:0;padding:0;}/*!sc*/
data-styled.g36[id="social-channel-list__StyledSocialChannels-sc-hb4cd6-0"]{content:"eWZpEr,"}/*!sc*/
.dIYGZM{display:inline-block;margin:0 10px;font-size:1.6em;opacity:.7;-webkit-transition:opacity .5s;transition:opacity .5s;}/*!sc*/
.dIYGZM:hover{opacity:1;}/*!sc*/
data-styled.g37[id="social-channel-list__StyledSocialChannel-sc-hb4cd6-1"]{content:"dIYGZM,"}/*!sc*/
.iLbeUa{max-width:110px;border-radius:100%;}/*!sc*/
data-styled.g38[id="avatar__StyledAvatar-sc-1b55w7o-0"]{content:"iLbeUa,"}/*!sc*/
.buiIfq{margin:auto;text-align:center;width:100%;}/*!sc*/
data-styled.g39[id="bio__StyledBio-sc-cy4lz8-0"]{content:"buiIfq,"}/*!sc*/
.iEPaOA{margin:10px 0 13px;}/*!sc*/
.iEPaOA a{color:#000;-webkit-text-decoration:underline;text-decoration:underline;}/*!sc*/
data-styled.g40[id="bio__AuthorDescription-sc-cy4lz8-1"]{content:"iEPaOA,"}/*!sc*/
.HeSmV{margin:10px;}/*!sc*/
data-styled.g41[id="bio__AuthorName-sc-cy4lz8-2"]{content:"HeSmV,"}/*!sc*/
.cEXXiX{margin:2rem auto;max-width:95%;}/*!sc*/
@media (max-width:768px){.cEXXiX{max-width:95%;}}/*!sc*/
data-styled.g42[id="comments__PostComment-sc-188g6ow-0"]{content:"cEXXiX,"}/*!sc*/
.fwNAhO{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding:0 !important;}/*!sc*/
data-styled.g43[id="postStyle__PostContainer-sc-1q9n7ky-0"]{content:"fwNAhO,"}/*!sc*/
.hkHhPL{min-width:255px;max-width:225px;-webkit-transition:opacity 0.5s;transition:opacity 0.5s;}/*!sc*/
@media (max-width:1300px){.hkHhPL{position:fixed;display:none;z-index:1000;background-color:#fff;width:100% !important;max-width:100%;padding:0 20px;margin-top:-5px;height:calc(100vh - 70px);}}/*!sc*/
data-styled.g44[id="postStyle__LeftSidebar-sc-1q9n7ky-1"]{content:"hkHhPL,"}/*!sc*/
.izgFAQ{margin-top:-5px;border-right:1px #e5eff5 solid;border-left:1px #e5eff5 solid;background-color:#fff;box-shadow:0 0 3px rgba(0,0,0,0.03),0 3px 46px rgba(0,0,0,0.1);z-index:10;width:1035px;max-width:100%;}/*!sc*/
.izgFAQ li > a,.izgFAQ p > a{color:#0054aa;border-bottom:2px #0054aa solid;overflow-wrap:break-word;}/*!sc*/
.izgFAQ pre{margin:30px 0;}/*!sc*/
.izgFAQ blockquote{border-left:4px #a4cbb8 solid;background-color:#fafafa;margin:30px 0;padding:5px 20px;border-radius:0.3em;}/*!sc*/
.izgFAQ h1,.izgFAQ h2,.izgFAQ h3,.izgFAQ h4,.izgFAQ h5,.izgFAQ h6{-webkit-scroll-margin-top:4.7rem;-moz-scroll-margin-top:4.7rem;-ms-scroll-margin-top:4.7rem;scroll-margin-top:4.7rem;}/*!sc*/
.izgFAQ h3::before,.izgFAQ h4::before,.izgFAQ h5::before,.izgFAQ h6::before{display:block;content:" ";visibility:hidden;}/*!sc*/
.izgFAQ h2{border-top:1px solid #ececec;margin-top:44px;padding-top:15px;line-height:1.2;}/*!sc*/
.izgFAQ h2 .anchor.before{padding-top:10px;}/*!sc*/
.izgFAQ code[class*="language-text"]{padding:5px;}/*!sc*/
.izgFAQ p > img{max-width:100%;border-radius:0.3em;margin:30px 0;}/*!sc*/
.izgFAQ hr{border-top:1px solid #ececec;border-bottom:0;margin-top:44px;margin-bottom:40px;}/*!sc*/
.izgFAQ .gatsby-resp-image-link{margin:30px 0;max-width:100%;}/*!sc*/
.izgFAQ .gatsby-resp-image-link .gatsby-resp-image-image{border-radius:0.3em;}/*!sc*/
.izgFAQ .table-wrapper{max-width:100%;overflow-x:scroll;}/*!sc*/
.izgFAQ .table-wrapper table{width:100%;}/*!sc*/
.izgFAQ table{margin:0 auto;}/*!sc*/
.izgFAQ table{color:#333;background:white;border:1px solid grey;font-size:12pt;border-collapse:collapse;}/*!sc*/
.izgFAQ table thead th,.izgFAQ table tfoot th{color:#474747;background:rgb(102 102 102 / 10%);}/*!sc*/
.izgFAQ table caption{padding:0.5em;}/*!sc*/
.izgFAQ table th,.izgFAQ table td{padding:0.5em;border:1px solid lightgrey;}/*!sc*/
.izgFAQ [data-table-theme*="zebra"] tbody tr:nth-of-type(odd){background:rgba(0,0,0,0.05);}/*!sc*/
.izgFAQ [data-table-theme*="zebra"][data-table-theme*="dark"] tbody tr:nth-of-type(odd){background:rgba(255,255,255,0.05);}/*!sc*/
.izgFAQ [data-table-theme*="dark"]{color:#ddd;background:#333;font-size:12pt;border-collapse:collapse;}/*!sc*/
.izgFAQ [data-table-theme*="dark"] thead th,.izgFAQ [data-table-theme*="dark"] tfoot th{color:#aaa;background:rgba(0255,255,255,0.15);}/*!sc*/
.izgFAQ [data-table-theme*="dark"] caption{padding:0.5em;}/*!sc*/
.izgFAQ [data-table-theme*="dark"] th,.izgFAQ [data-table-theme*="dark"] td{padding:0.5em;border:1px solid grey;}/*!sc*/
.izgFAQ sup{-webkit-scroll-margin-top:5.5rem;-moz-scroll-margin-top:5.5rem;-ms-scroll-margin-top:5.5rem;scroll-margin-top:5.5rem;}/*!sc*/
data-styled.g45[id="postStyle__PostContent-sc-1q9n7ky-2"]{content:"izgFAQ,"}/*!sc*/
.chUzhL{position:-webkit-sticky;position:sticky;top:70px;padding:40px 30px 40px 0;}/*!sc*/
data-styled.g46[id="postStyle__TocWrapper-sc-1q9n7ky-3"]{content:"chUzhL,"}/*!sc*/
.emniPl{padding:40px;}/*!sc*/
@media (max-width:576px){.emniPl{padding:20px;}}/*!sc*/
data-styled.g47[id="postStyle__PostHeader-sc-1q9n7ky-4"]{content:"emniPl,"}/*!sc*/
.hPgZxr{border-radius:0;}/*!sc*/
@media (max-width:1300px){.hPgZxr{margin-left:-1px;margin-right:-1px;}}/*!sc*/
data-styled.g48[id="postStyle__FeaturedImage-sc-1q9n7ky-5"]{content:"hPgZxr,"}/*!sc*/
.fuGkXD{padding:40px;}/*!sc*/
@media (max-width:576px){.fuGkXD{padding:20px;}}/*!sc*/
data-styled.g49[id="postStyle__StyledPost-sc-1q9n7ky-6"]{content:"fuGkXD,"}/*!sc*/
.dvkpbj{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;opacity:0.8;font-size:0.9em;}/*!sc*/
data-styled.g50[id="postStyle__PostMeta-sc-1q9n7ky-7"]{content:"dvkpbj,"}/*!sc*/
.jXQCDR{margin:0;padding:0;line-height:1.2;}/*!sc*/
data-styled.g51[id="postStyle__PostTitle-sc-1q9n7ky-8"]{content:"jXQCDR,"}/*!sc*/
.kGeBkw{background-color:#fafafa;font-size:0.8em;color:#666;padding:40px;line-height:1em;}/*!sc*/
.kGeBkw p{margin:5px 0;}/*!sc*/
data-styled.g52[id="postStyle__PostFooter-sc-1q9n7ky-9"]{content:"kGeBkw,"}/*!sc*/
.bsOVgh{color:#000 !important;-webkit-text-decoration:none;text-decoration:none;border-bottom:0 !important;}/*!sc*/
data-styled.g53[id="postStyle__FooterTagLink-sc-1q9n7ky-10"]{content:"bsOVgh,"}/*!sc*/
.hnKtRH{background-color:#fff;border-top:1px #e5eff5 solid;border-bottom:1px #e5eff5 solid;z-index:700;position:relative;padding:40px;}/*!sc*/
data-styled.g54[id="postStyle__PostAddition-sc-1q9n7ky-11"]{content:"hnKtRH,"}/*!sc*/
.bIQtHU{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}/*!sc*/
data-styled.g55[id="postStyle__PostAdditionContent-sc-1q9n7ky-12"]{content:"bIQtHU,"}/*!sc*/
.cXvylF{width:50%;margin:auto;}/*!sc*/
@media (max-width:576px){.cXvylF{width:100%;}}/*!sc*/
data-styled.g56[id="postStyle__BioWrapper-sc-1q9n7ky-13"]{content:"cXvylF,"}/*!sc*/
.kxysTe{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding-top:1em;position:fixed;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;right:20px;bottom:20px;border-radius:100%;box-shadow:0 0 3px rgba(0,0,0,0.03),0 3px 46px rgba(0,0,0,0.1);border:0;z-index:5000;width:50px;height:50px;background-color:#20232a;color:#fff;outline:none;}/*!sc*/
@media (min-width:1300px){.kxysTe{display:none;}}/*!sc*/
data-styled.g57[id="postStyle__ToggleTocButton-sc-1q9n7ky-14"]{content:"kxysTe,"}/*!sc*/
.tpqNJ{margin-top:1rem;margin-bottom:1rem;padding-left:1rem;padding-right:1rem;overflow:auto;display:grid;grid-template-columns:repeat(2,1fr);gap:0.6rem;}/*!sc*/
@media (max-width:576px){.tpqNJ{display:block;}}/*!sc*/
data-styled.g58[id="style__LinkedPostWrapper-sc-cu5n11-0"]{content:"tpqNJ,"}/*!sc*/
.llMcQV{display:block;background-color:#ffff;border:1px solid #ddd;border-radius:3px;padding:5px 10px;font-size:16px;-webkit-text-decoration:none;text-decoration:none;color:#333;height:100%;border:1px solid #dadde1;}/*!sc*/
.llMcQV:hover{border:1px solid #009400;}/*!sc*/
.llMcQV .label{color:#067a5f;font-weight:600;}/*!sc*/
@media (max-width:576px){.llMcQV{margin-top:0.5rem;margin-bottom:0.5rem;}}/*!sc*/
data-styled.g59[id="style__LinkedPost-sc-cu5n11-1"]{content:"llMcQV,"}/*!sc*/
.jKVyMT{text-align:left;}/*!sc*/
.jKVyMT .label:before{content:"« ";}/*!sc*/
data-styled.g60[id="style__PrevPost-sc-cu5n11-2"]{content:"jKVyMT,"}/*!sc*/
.bnRGLe{text-align:right;grid-column:2/3;}/*!sc*/
.bnRGLe .label:after{content:" »";}/*!sc*/
data-styled.g61[id="style__NextPost-sc-cu5n11-3"]{content:"bnRGLe,"}/*!sc*/
</style><link rel="sitemap" type="application/xml" href="/sitemap/sitemap-index.xml"/><link rel="icon" href="/favicon-32x32.png?v=5e09b7dc046a8972547b7e2d01e32a28" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=5e09b7dc046a8972547b7e2d01e32a28"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=5e09b7dc046a8972547b7e2d01e32a28"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=5e09b7dc046a8972547b7e2d01e32a28"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=5e09b7dc046a8972547b7e2d01e32a28"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=5e09b7dc046a8972547b7e2d01e32a28"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=5e09b7dc046a8972547b7e2d01e32a28"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=5e09b7dc046a8972547b7e2d01e32a28"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=5e09b7dc046a8972547b7e2d01e32a28"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 100)
          }), 0)
        }
      }
    })
  </script><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/rss.xml"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="style__NavContainer-sc-jhe81k-0 eBjOxQ"><div class="common__Container-sc-yvdkhc-0 style__Nav-sc-jhe81k-1 hhzXsP hRmTxB"><a class="logo__HomeLink-sc-1ta2zdq-1 dYGSok" href="/"><div class="logo__LogoImage-sc-1ta2zdq-0 jIujQe gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:30px;height:30px"><img aria-hidden="true" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFlUlEQVQ4y2WSaVCTVxSGb6gz+kccq1QFlVo7tI7TqTp16lJFVGRRkAARWcWxuIKKYtWyBUWEqSgKHRFks0QWBQoKuGIBQVQIGMISwhISCCQioCxVvu+7b+cL2v7oj3vvzL3nfc57zrkk2VZMrtmEkyQbseDKphDCrwuWp02i1586GvnTLw/CVgdpT608yh5bEcAEfH9Is3/pgbu7Lfz2eS7abSwy30VcFvoIHEw9BY5mnsTB1JOQVPsIkmwrFqTYRZCr1mE80P/SxmB99LqTCFkWgGPf7MURi304uNgPuxf4YJe5L3Zb+MHr6z1q0UIfb+F8L7JuhjPZNs9DYD/XnZAU+whBxtazRLIt0ihxS/jNhC1hiFkVhHOrg5gbhxLZ8tTH9HF6CS1NKqTFCcVcjPtvjMdCH0Zk5oUdi3yx3cwrXjjfmyydYke2zvMgJM4qmCTZikmKXcTNJDsxYtecmPjj53iuV67G2Og7mn7tIvXfI6J73e1obEQQHdD3U/nTZgRanWQdZrsxwgXesJ/rHse7czD1NCI3tkXyyz9921nErzs1URwmoRzHAQCNOHGYrlhshmUWi2E+xwTGnxEEHvSj/NvYyDjCROeozUxXdqupJ6xN3ETWJm6EZDtFmUi2R+mTNoUi71Aix7GsATY8OARXG0usXWKODUu/hO/ab+G4/Cus+WE53gwMGGJGh0exd3Ugu3mmK7bM2alYY+w8lWQLzx/NdDyH6zbhjFamMgSyEwx/IjMhChHeG5F2RIhkfyekHhHi1wPeGBx+C3DU4PRpUQ02zXBhrL9ww4ZZop0k1yX6QfoWMYqD0nhrlHIcH4iJ8RFUSS7g9vn9yD/rh4wT7rgTE4DbIb4YVCkNCSnlKMuw1G/tcWb9dCGsZu/IJLdcY7QpViGQ3nhiyPixZDAfPqCx4DKeJgTgfvR+FAV74kmMH8pi/DE+qDfEsMxke+KOJXGrpzrAysStngey1zcEQ3FP+hHI8ZtBoGuXIl/shsxAF1z3s0VOkCM0supJdxz3L/DmxXz645StPHCUBzIGYGndf0BK+XIMwuf5l1AY7oE/gz2QH+6F8XdD/wNKYvM+Ad/yQE3qxhDUpj3iPgEnFZOHtCQJBWdFyDnthKzjdmguLzA88SP59L1iD19l10wzlPyS5DpH382wEaPoSDLzEWPo4/vxEcgaXqL61gXkhjoiN9QZt4O3o7rgGirLH4GdGAfHsXRs5G/qu/IwY2nszA8llf82+ySO55BsHc50VMjBcGN0dEiLfnUzqsqK0C6rQGnCMTy4sh+yhxlQyGrwtOwu3o/qKccO0WelVdT6cxG72cQNVrNETiTH6byxxClKnWgZjKrkQnZ0VIOBXgUd7G+n/d1ydDTVoLn2IaSPcyB/8QjdbbXoU7fQQb2KDg+ooNO0Mj4rDsByunNDliTPiKRuDCMZ9me80x0joaqXMnptC9V2ytCnklFdTwvV97RC3VYHZeMzaDpeoaeriT55UEgV8hd43avghvRKTuwTCQtiabOArCLkdX+7QFFRQ/IDfo/XqVrR1VLDttQ9Znkn/d1NVKduphqllL7WttE3ui56/04ubW2soT2dMqZPJef6VE34q6AkdEDbSli214g8Ty0SpAjjSJ7wEhnSq+I0bXWoLcuDUlbJC5i+bjmn7ZJTnaaVDr1WsT1dcv6e7eloQL+6BdrOptDkMwmk8t4dQc7lbEIq4m4RafZ9AQCi62kkGoV0R3VpVpuivhy9na/ACzVKKbSqRmhVct412hur0dXysqG/W2Gr0zSTJeQ7QdalLBIXGE9I65NqoqqTksaSCqLpeGmkUdSRrNiYaU01j9zl1aUSZX15fZf8xbhaUT+ibKisVb6qSmuoLHW6fDzKqK+7hWi7Gox6lArS29FKtJ3N5B8YTTI10y3oBAAAAABJRU5ErkJggg==" alt="Dev Giang Hồ - Blog for Devs" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source srcset="/static/5e09b7dc046a8972547b7e2d01e32a28/91664/logo.png 1x,
/static/5e09b7dc046a8972547b7e2d01e32a28/ad39b/logo.png 1.5x,
/static/5e09b7dc046a8972547b7e2d01e32a28/183c2/logo.png 2x" /><img loading="lazy" width="30" height="30" srcset="/static/5e09b7dc046a8972547b7e2d01e32a28/91664/logo.png 1x,
/static/5e09b7dc046a8972547b7e2d01e32a28/ad39b/logo.png 1.5x,
/static/5e09b7dc046a8972547b7e2d01e32a28/183c2/logo.png 2x" src="/static/5e09b7dc046a8972547b7e2d01e32a28/91664/logo.png" alt="Dev Giang Hồ - Blog for Devs" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div></a><div class="style__NavWrapper-sc-jhe81k-2 kkNwJo"><ul class="style__NavMenu-sc-jhe81k-3 cPsfUr"><li class="style__NavMenuItem-sc-jhe81k-4 fPrbPq"><a class="style__NavLink-sc-jhe81k-5 bdMJer" href="/">Home</a></li><li class="style__NavMenuItem-sc-jhe81k-4 fPrbPq"><a class="style__NavLink-sc-jhe81k-5 bdMJer" href="/about-me/">About me</a></li></ul><div class="style__SearchContainer-sc-jhe81k-6 dSpRmA"><ul class="style__NavMenu-sc-jhe81k-3 jPyOnZ"><li class="style__NavMenuItem-sc-jhe81k-4 fPrbPq"><button role="button" aria-label="Toggle search" class="style__ToggleSearchButton-sc-jhe81k-7 cbBsOC"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg></button></li></ul></div></div></div></div><main><div style="width:0%" class="reading-progress__ReadingProgressBar-sc-1h92jbi-0 bGzPfA"></div><div class="common__Container-sc-yvdkhc-0 postStyle__PostContainer-sc-1q9n7ky-0 hhzXsP fwNAhO"><div class="postStyle__LeftSidebar-sc-1q9n7ky-1 hkHhPL"><div class="postStyle__TocWrapper-sc-1q9n7ky-3 chUzhL"><nav class="toc__StyledNav-sc-1rcn1mg-0 fmlDtj toc-list"><ul><li><a class="non-active" href="/connection-pooling-tong-quan-va-implement-benchmark/#/">First thing first</a></li><li><a class="non-active" href="/connection-pooling-tong-quan-va-implement-benchmark/#/">Database connection</a><ul><li><a class="non-active" href="/connection-pooling-tong-quan-va-implement-benchmark/#/">Connection pool là gì?</a></li><li><a class="non-active" href="/connection-pooling-tong-quan-va-implement-benchmark/#/">Nửa phút quảng cáo</a></li><li><a class="non-active" href="/connection-pooling-tong-quan-va-implement-benchmark/#/">Connection pooling trong database</a></li><li><a class="non-active" href="/connection-pooling-tong-quan-va-implement-benchmark/#/">Cách implement connection pooling</a></li></ul></li><li><a class="non-active" href="/connection-pooling-tong-quan-va-implement-benchmark/#/">Benchmark connection pooling</a><ul><li><a class="non-active" href="/connection-pooling-tong-quan-va-implement-benchmark/#/">Một vài khái niệm</a></li><li><a class="non-active" href="/connection-pooling-tong-quan-va-implement-benchmark/#/">Dựng database postgres và data</a></li><li><a class="non-active" href="/connection-pooling-tong-quan-va-implement-benchmark/#/">Dựng API bằng Go</a></li><li><a class="non-active" href="/connection-pooling-tong-quan-va-implement-benchmark/#/">Kết quả test benchmark</a></li><li><a class="non-active" href="/connection-pooling-tong-quan-va-implement-benchmark/#/">Benchmark hardcore hơn</a></li><li><a class="non-active" href="/connection-pooling-tong-quan-va-implement-benchmark/#/">Config connection pool như thế nào cho hợp lý?</a></li></ul></li><li><a class="non-active" href="/connection-pooling-tong-quan-va-implement-benchmark/#/">Kết luận</a></li></ul></nav></div></div><button role="button" aria-label="Toggle table of contents" class="postStyle__ToggleTocButton-sc-1q9n7ky-14 kxysTe"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M432 416H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-128H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-128H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-128H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16z"></path></svg></button><div class="postStyle__PostContent-sc-1q9n7ky-2 izgFAQ"><article class="post"><header class="postStyle__PostHeader-sc-1q9n7ky-4 emniPl"><section class="postStyle__PostMeta-sc-1q9n7ky-7 dvkpbj"><a href="/tag/backend/">Backend</a><time dateTime="2023-03-29T15:06:30.504Z">29 March, 2023</time></section><h1 class="postStyle__PostTitle-sc-1q9n7ky-8 jXQCDR">Connection pooling: Tổng quan và implement benchmark</h1></header><div class="postStyle__FeaturedImage-sc-1q9n7ky-5 hPgZxr gatsby-image-wrapper" style="position:relative;overflow:hidden"><div aria-hidden="true" style="width:100%;padding-bottom:60%"></div><img aria-hidden="true" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACxElEQVQoz4XT+U/ScRzHcX9P12rrWKtW64dalh1kaa227rJzmZmyoH0jLTHUig5NQTrUwkoghThMjeycIKD5lUTxAEMT1My2/pdnG9U6VusfeOzzee/1TEh0ZzPLI2WeV84i3xmWdeazQiwgpbsIif8iaQE123qvsytYzv6BSo4M3eZ4qJqcYT3yyEMUIyYKPpgpjlpRjzeSEAfbpczzyVggnmKJKLBcPEdyTwHrgyrSA2q29l5nR/AG+wa0HBq8Reb/wNmeXOa2y0m2aUi/Z2LzHTOb9SZSm3Rs6rnM9r4y9vVrOTRwk2NDVWSH7v4bTHKdJMmXhaRFxwFVB+vlL1grf85G4TVHLnvY0FpOyYcGWif82GJeXk8FaJkUkYb0yCIPOfs3MLEjk42N1bS4Y2gtbRTWvKC49hWCrp1Um46McAUngtVk99egCNeR/95ETvjbC/8BHmeD4xaqOy85X+tEqHaiqGrioPIxKTYNipH7tEyIPJnopD7mpj7q4ulHMY4pRk0ox8wU/QmmNVeh0Dwjo9TOUY2TwvvPySxxsM5eyeGwlvwhI+dCRpTD9eSHjFwasXI6Uofs/QMUI0aKo7YfYA4zvMdIs9agt/rR1JnJrXQgaBvIKmpmpaGUwpgJy7iXxukuGiY9NE2LqMINNH56i3Paj/vLIHejLymJ2klIdJ1kpi+bpTYVZTYPbW4vJToLsmt29qhtJDcXkzdqoDzShHnKi2G8DftUJw+ib7B89GIcd+H8/A7DpItLMceP2UiZ45OysPUMEsdVtlrLkFivsKZNRXqfmvTAFbb0Xo3PZ2+/loODN8kK15A7rI9/WYgYuDBm+WXYHinzvXIWdgks7hZY5s9jVUCJpPciaT1qtvWVsjtYQcaAjqNDt79jtfEb5o0+onDM8vOGP9OTsahD+JZel5LVouq39HZ+T+/wf9L7Cp0ra1mXPMXRAAAAAElFTkSuQmCC" alt="" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><picture><source type="image/webp" srcSet="/static/5d70a032bfc7060682647360314a9e25/08dba/blog-database-connection-pooling.webp 200w,
/static/5d70a032bfc7060682647360314a9e25/9a2fa/blog-database-connection-pooling.webp 400w,
/static/5d70a032bfc7060682647360314a9e25/8761d/blog-database-connection-pooling.webp 800w,
/static/5d70a032bfc7060682647360314a9e25/bbbf2/blog-database-connection-pooling.webp 960w" sizes="(max-width: 800px) 100vw, 800px"/><source srcSet="/static/5d70a032bfc7060682647360314a9e25/4e5c3/blog-database-connection-pooling.png 200w,
/static/5d70a032bfc7060682647360314a9e25/5392f/blog-database-connection-pooling.png 400w,
/static/5d70a032bfc7060682647360314a9e25/5d1ed/blog-database-connection-pooling.png 800w,
/static/5d70a032bfc7060682647360314a9e25/134b9/blog-database-connection-pooling.png 960w" sizes="(max-width: 800px) 100vw, 800px"/><img sizes="(max-width: 800px) 100vw, 800px" srcSet="/static/5d70a032bfc7060682647360314a9e25/4e5c3/blog-database-connection-pooling.png 200w,
/static/5d70a032bfc7060682647360314a9e25/5392f/blog-database-connection-pooling.png 400w,
/static/5d70a032bfc7060682647360314a9e25/5d1ed/blog-database-connection-pooling.png 800w,
/static/5d70a032bfc7060682647360314a9e25/134b9/blog-database-connection-pooling.png 960w" src="/static/5d70a032bfc7060682647360314a9e25/5d1ed/blog-database-connection-pooling.png" alt="" loading="eager" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:0;transition:opacity 500ms"/></picture><noscript><picture><source type='image/webp' srcset="/static/5d70a032bfc7060682647360314a9e25/08dba/blog-database-connection-pooling.webp 200w,
/static/5d70a032bfc7060682647360314a9e25/9a2fa/blog-database-connection-pooling.webp 400w,
/static/5d70a032bfc7060682647360314a9e25/8761d/blog-database-connection-pooling.webp 800w,
/static/5d70a032bfc7060682647360314a9e25/bbbf2/blog-database-connection-pooling.webp 960w" sizes="(max-width: 800px) 100vw, 800px" /><source srcset="/static/5d70a032bfc7060682647360314a9e25/4e5c3/blog-database-connection-pooling.png 200w,
/static/5d70a032bfc7060682647360314a9e25/5392f/blog-database-connection-pooling.png 400w,
/static/5d70a032bfc7060682647360314a9e25/5d1ed/blog-database-connection-pooling.png 800w,
/static/5d70a032bfc7060682647360314a9e25/134b9/blog-database-connection-pooling.png 960w" sizes="(max-width: 800px) 100vw, 800px" /><img loading="eager" sizes="(max-width: 800px) 100vw, 800px" srcset="/static/5d70a032bfc7060682647360314a9e25/4e5c3/blog-database-connection-pooling.png 200w,
/static/5d70a032bfc7060682647360314a9e25/5392f/blog-database-connection-pooling.png 400w,
/static/5d70a032bfc7060682647360314a9e25/5d1ed/blog-database-connection-pooling.png 800w,
/static/5d70a032bfc7060682647360314a9e25/134b9/blog-database-connection-pooling.png 960w" src="/static/5d70a032bfc7060682647360314a9e25/5d1ed/blog-database-connection-pooling.png" alt="" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><section class="postStyle__StyledPost-sc-1q9n7ky-6 fuGkXD post"><p>Một nhà thông thái nào đó đã nói: “Muốn lên trình backend, thì database là một phần không thể bỏ qua”.</p>
<p>Vâng, trong series backend nâng cao này, mình muốn tiếp tục bằng tối ưu hiệu năng database, phần đầu tiên sẽ là connection pooling. Vậy connection pooling là gì? Sử dụng connection pool như thế nào? Hãy tham khảo bài viết này nha.</p>
<h2 id="first-thing-first" style="position:relative;"><a href="#first-thing-first" aria-label="first thing first permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>First thing first</h2>
<p>Again, mình là Kiên, một anh dev với tay nghề khá thập cẩm, series backend nâng cao này chính là một trong những nỗ lực của mình để đào sâu kĩ năng backend. Hi vọng sẽ có ích với các bạn, và cả mình nữa 🤗.</p>
<h2 id="database-connection" style="position:relative;"><a href="#database-connection" aria-label="database connection permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Database connection</h2>
<p>Nếu theo dõi series này từ đầu, bạn sẽ biết về <a href="https://devgiangho.github.io/so-sanh-chi-tiet-tcp-va-udp-tai-sao-udp-nhanh-hon-udp/#three-way-handshake">TCP handshake</a>, mà chưa thì bạn có thể đọc lại để nắm về nó. Và hiển nhiên, các database dạng RDBMS như MSSQL, MySQL, Postgresql đều support protocol giao tiếp qua TCP/IP như một tiêu chuẩn, đặc biệt nếu bạn kết nối tới các database từ xa, và phải thêm SSL/TLS để bảo mật connection.</p>
<p>Nhìn xem hình sau để biết lifecycle của một kết nối tới postgres DB <sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup>:
<span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1106px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/904ee74a9af7cb8e733b0be50215ab97/8740f/connection-phase-db.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 60%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABeUlEQVQoz41TS07DMBDtGbkDQkLiEtwB1nAKlqzYIMG2gFqQCmlTN07ifJz4l4dm2lRtSitGepnxZPz8xp8RyLoOHdam62aT6jOH1v+rKR7MH9EnhMCD8fQTZ+dXWMiUx+EP0j4XZzWuHyd4+Mh47EN3SPgy+8bFzS3ehUCfJzW7CJuJb1GGy/tX3D2LQ8K+BW0tJtEcrff4jz2NI4hif4v2CGl1mWukUmKVJJBpingpsEok4ngJmWZwPoDEUOvGON6/o4RUHKcaunWMurEotUHVWNStwzxOEC0E5ssEK5khUQbWh+OE3ncQWQPrApwLMNZzrIoKMs0ZS5Gw4qrWkIVhEccJw5qwMY5BCklppiokqcLsZ4Hp14w9kRIhiTi5h0RYastQlYGqWhS1QakdhCwgpILMS+S0iGq3p3tUoartul3nuWXnO4b1HR8GdUh1FFPtScL+rm0vcQhQKmcURcG+v7P0Rnbr9wiHT223SGvNaJqGfRgQDONfRHanBSLVb5gAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/904ee74a9af7cb8e733b0be50215ab97/c85cb/connection-phase-db.webp 300w,
/static/904ee74a9af7cb8e733b0be50215ab97/e88ff/connection-phase-db.webp 600w,
/static/904ee74a9af7cb8e733b0be50215ab97/3fe5f/connection-phase-db.webp 1106w"
              sizes="(max-width: 1106px) 100vw, 1106px"
              type="image/webp"
            />
          <source
            srcset="/static/904ee74a9af7cb8e733b0be50215ab97/5a46d/connection-phase-db.png 300w,
/static/904ee74a9af7cb8e733b0be50215ab97/0a47e/connection-phase-db.png 600w,
/static/904ee74a9af7cb8e733b0be50215ab97/8740f/connection-phase-db.png 1106w"
            sizes="(max-width: 1106px) 100vw, 1106px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/904ee74a9af7cb8e733b0be50215ab97/8740f/connection-phase-db.png"
            alt="Postgres DB Connection phase"
            title="Postgres DB Connection phase"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>Do đó, nếu mỗi lần có request, thì nếu application tạo mới 1 connection tới DB, thì sẽ phải thực hiện handshake lại, lúc đó sẽ rất tốn resource và làm chậm app đi. Vì vậy connection pooling ra đời.</p>
<h3 id="connection-pool-la-gi" style="position:relative;"><a href="#connection-pool-la-gi" aria-label="connection pool la gi permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Connection pool là gì?</h3>
<p>Thực chất, connection pool là một implementation của design pattern <a href="https://sourcemaking.com/design_patterns/object_pool">Object Pool</a>. Khá giống với singleton, đây là một pattern được tạo ra với mục đích để có thể sử dụng lại được các object mà chúng ta mong muốn.</p>
<p>Dĩ nhiên với những thao tác đắt đỏ như thiết lập 1 kết nối mới tới DB thì pattern này lại quá ư là hợp lý.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 822px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/374171f1d48fb5fa39f64a74120885b2/f73a1/connection-pooling.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 64%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABz0lEQVQ4y42Ty2rbQBSG/QR9jb5EH6Bv0U3JO4Rusyh0212XLYRQCBSyyCKrFlqaBJyb7dhOYxErqWPZ8U3WZS76ysxYiiVCqOBw5pz5+ec/F9UAsiwj/8w5t/W4dOeCMnaVr+Xg5s2A/mia0/LfD1XyNb06fG/8odW/R8iM+TJFaW3zWmcl4upD1XxB+KN5XRCGscDkU6kJY0UiVEFuHwBEKvh6HfD2+JZP3RFRIsoKf156tG+HSOUUSqVZRNLaPJI2jhLJwzy2+BNvzOsPB7z71uLVxwv2Ww8VwlaPtj9ECEOUopRmGqbUOwO8wcKqXcaCYBpZ/O+rgM3tQ+7HM9586bB7Ni4T5iUbhYtI2B6GsSQWWJWpUCxjyWjmFDb8CS82dtj4fMrL9+fsNcbVkp3COFFM5oklFNKVnffwcbrYHu8e3bC132O7PiFaYQrCX5cenbvAbowpTcrHKVd37vkpa3d5cNrh3LtDKTflp9cjWzOQpgqlkWurVSz2Ik6Z2elmGHHG5+UZr3SGULlh4+qfVCLsD0NOukPOrgKOGj7N3siSurKh6884bvrU2385vOjjDcLnCc2epUIipCJJhfXuyi2y6anJG4zxBv8U4T/Nc+kpDqzdhgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/374171f1d48fb5fa39f64a74120885b2/c85cb/connection-pooling.webp 300w,
/static/374171f1d48fb5fa39f64a74120885b2/e88ff/connection-pooling.webp 600w,
/static/374171f1d48fb5fa39f64a74120885b2/355f1/connection-pooling.webp 822w"
              sizes="(max-width: 822px) 100vw, 822px"
              type="image/webp"
            />
          <source
            srcset="/static/374171f1d48fb5fa39f64a74120885b2/5a46d/connection-pooling.png 300w,
/static/374171f1d48fb5fa39f64a74120885b2/0a47e/connection-pooling.png 600w,
/static/374171f1d48fb5fa39f64a74120885b2/f73a1/connection-pooling.png 822w"
            sizes="(max-width: 822px) 100vw, 822px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/374171f1d48fb5fa39f64a74120885b2/f73a1/connection-pooling.png"
            alt="connection-pooling.png"
            title="connection-pooling.png"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>Giống như việc chở khách qua sông ở bến đò, có rất nhiều thuyền, nhưng để mặc con thuyền quá lâu dưới nước sẽ làm mục gỗ nhanh hơn. Nên thuyền được cất vào kho.</p>
<p>Mỗi lần chở người qua là phải: Bê 1 chiếc thuyền từ kho bên bờ sông xuống, chở người qua bên kia bờ, rồi chạy về, đưa thuyền đi cất => tốn thời gian.</p>
<p>Trong khi đó chúng ta sẽ đặt tối đa khoảng 100 chiếc thuyền neo đậu bên cạnh sông khi không có khách, mỗi thuyền sẽ được dừng nghỉ 1 buổi, hết buổi không có khách ngồi thuyền đó thì mới đưa cất đi.</p>
<h3 id="nửa-phut-quảng-cao" style="position:relative;"><a href="#n%E1%BB%ADa-phut-qu%E1%BA%A3ng-cao" aria-label="nửa phut quảng cao permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Nửa phút quảng cáo</h3>
<p>Gần đây mình mới mua 1 cuốn sách mang tên “Làm chủ các mẫu thiết kế kinh điển trong lập trình” của anh <a href="https://www.facebook.com/dung.tavan">Tạ Văn Dũng</a>, một người anh senior rất tâm huyết với nghề, cũng như rất nhiệt tình trong việc giúp đỡ và giải đáp thắc mắc cho junior đi sau (trong đó có mình).</p>
<p>Anh là founder của tổ chức mã nguồn mở <a href="https://github.com/youngmonkeys">YoungMonkeys</a> - github, có khá là nhiều thư viện và framework đã được team implement sẵn, đặc biệt đối với các startup làm về game.</p>
<p>Các bạn có thể tìm thấy pattern Object Pool này ở trang số 86:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/34703e229ed72bc6defb78acaa572097/9568a/sach-lamchu-design-pattern.jpg"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 98.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAQCAQP/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB3bJTG2hP7BwS/wD/xAAcEAABAwUAAAAAAAAAAAAAAAABABARAgMEIUH/2gAIAQEAAQUCxxADWtUS/F//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAXEAEAAwAAAAAAAAAAAAAAAAABECBR/9oACAEBAAY/Al2S3//EABoQAQACAwEAAAAAAAAAAAAAAAEAMRARIUH/2gAIAQEAAT8hEO1NiN3A1dvWC15CoccCp//aAAwDAQACAAMAAAAQXB9+/8QAFREBAQAAAAAAAAAAAAAAAAAAASD/2gAIAQMBAT8QY//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8QH//EAB0QAQACAgIDAAAAAAAAAAAAAAEAESExUXFBgeH/2gAIAQEAAT8QDjWXqKx8d7j5CXsA9Wl+Qju3pJRDRk5mIGgqXeYRYT//2Q=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/34703e229ed72bc6defb78acaa572097/c85cb/sach-lamchu-design-pattern.webp 300w,
/static/34703e229ed72bc6defb78acaa572097/e88ff/sach-lamchu-design-pattern.webp 600w,
/static/34703e229ed72bc6defb78acaa572097/92f8c/sach-lamchu-design-pattern.webp 1200w,
/static/34703e229ed72bc6defb78acaa572097/62ed8/sach-lamchu-design-pattern.webp 1800w,
/static/34703e229ed72bc6defb78acaa572097/46261/sach-lamchu-design-pattern.webp 2400w,
/static/34703e229ed72bc6defb78acaa572097/e51ec/sach-lamchu-design-pattern.webp 3024w"
              sizes="(max-width: 1200px) 100vw, 1200px"
              type="image/webp"
            />
          <source
            srcset="/static/34703e229ed72bc6defb78acaa572097/f93b5/sach-lamchu-design-pattern.jpg 300w,
/static/34703e229ed72bc6defb78acaa572097/b4294/sach-lamchu-design-pattern.jpg 600w,
/static/34703e229ed72bc6defb78acaa572097/e5166/sach-lamchu-design-pattern.jpg 1200w,
/static/34703e229ed72bc6defb78acaa572097/d9c39/sach-lamchu-design-pattern.jpg 1800w,
/static/34703e229ed72bc6defb78acaa572097/df51d/sach-lamchu-design-pattern.jpg 2400w,
/static/34703e229ed72bc6defb78acaa572097/9568a/sach-lamchu-design-pattern.jpg 3024w"
            sizes="(max-width: 1200px) 100vw, 1200px"
            type="image/jpeg"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/34703e229ed72bc6defb78acaa572097/e5166/sach-lamchu-design-pattern.jpg"
            alt="338E3B68-731B-43B2-A0D6-22163A59AE46.jpeg"
            title="338E3B68-731B-43B2-A0D6-22163A59AE46.jpeg"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>Các bạn có thể tham khảo mua sách <a href="https://www.trithuctrebooks.com/products/lam-chu-cac-mau-thiet-ke-kinh-dien-trong-lap-trinh-mastering-design-patterns">ở đây</a>, mình không nhận đồng PR nào cả, mình chỉ muốn ủng hộ anh Dũng thôi, vì phần lớn lợi nhuận của sách này đều được tác giả gửi tặng chương trình cặp lá yêu thương, peace!</p>
<h3 id="connection-pooling-trong-database" style="position:relative;"><a href="#connection-pooling-trong-database" aria-label="connection pooling trong database permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Connection pooling trong database</h3>
<p>Ahh hhh hmmm, chúng ta quay lại bài giảng.</p>
<p>Database - cơ sở dữ liệu cũng là một phần mềm, cũng nằm trên máy chủ vật lý, mà đã thế thì nó cũng sẽ có giới hạn về số lượng kết nối trong cùng 1 thời điểm.</p>
<p>Con số <strong>mặc định</strong> cho số lượng connection tối đa của MySQL là 151.</p>
<p>Với Postgresql thì sẽ là 100.</p>
<p>MSSQL thì kinh dị hơn với con số …. <strong>32.767.</strong> (Chắc do tốn tiền nên vậy  😂)</p>
<p>Trong khuôn khổ bài này mình sẽ chỉ tập trung đào sâu với Postgresql.</p>
<h3 id="cach-implement-connection-pooling" style="position:relative;"><a href="#cach-implement-connection-pooling" aria-label="cach implement connection pooling permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cách implement connection pooling</h3>
<p>Về cơ bản chúng ta có 2 cách để implement connection pooling.</p>
<ul>
<li>Cách đầu tiên là cài các phần mềm, extension thêm vào, chẳng hạn như <strong>pgbouncer.</strong></li>
<li>Cách thứ 2, chính là implement connection pooling phía layer backend.</li>
</ul>
<p>Chúng ta có thể implement 1 pooler cách đơn giản bằng cách sử dụng <em>1 Queue/ Stack</em> và <em>1 mutex Lock</em>, vì nó là design pattern mà, dĩ nhiên. Tham khảo tutorial của Microsoft <a href="https://learn.microsoft.com/en-us/azure/mysql/single-server/sample-scripts-java-connection-pooling">Java sample to illustrate connection pooling</a>.</p>
<p>Trên thực tế thì chúng ta chẳng đi <strong>re-invent the wheel</strong> làm gì, các thư viện hiện tại đã hỗ trợ sẵn rồi, chỉ việc dùng thôi. Xem phần tiếp dưới đây:</p>
<h2 id="benchmark-connection-pooling" style="position:relative;"><a href="#benchmark-connection-pooling" aria-label="benchmark connection pooling permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Benchmark connection pooling</h2>
<p>Tiết học lí thuyết đã xong, chúng ta chuyển qua tiết thực hành nhé.</p>
<p>Đầu tiên để minh chứng rằng <strong>connection pooling thực sự boost performance,</strong> mình có ý tưởng như sau:</p>
<p>Tạo một API đơn giản với 3 endpoint, với 3 phương pháp sử dụng database connection khác nhau:</p>
<ul>
<li>Khởi tạo 1 connection mới cho mọi request.</li>
<li>Khởi tạo 1 connection từ đầu và dùng nó cho mọi request (singleton).</li>
<li>Khởi tạo 1 connection pool với số lượng idle connection cao.</li>
</ul>
<p>Sau đó sẽ test 3 endpoint này bằng cả browser và tool benchmark tấn công dồn dập 👻.</p>
<p>Đầu tiên là cấu hình máy mình:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">➜  ~ neofetch
Máy Kiên Đẹp Trai
-----------------
OS: Ubuntu <span class="token number">22.10</span> x86_64
Host: Latitude <span class="token number">5420</span>
Kernel: <span class="token number">5.19</span>.0-38-generic
CPU: 11th Gen Intel i7-1185G7 <span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> @ <span class="token number">4</span>.800GHz
GPU: Intel TigerLake-LP GT2 <span class="token punctuation">[</span>Iris Xe Graphics<span class="token punctuation">]</span>
Memory: 8862MiB / 31491MiB</code></pre></div>
<h3 id="một-vai-khai-niệm" style="position:relative;"><a href="#m%E1%BB%99t-vai-khai-ni%E1%BB%87m" aria-label="một vai khai niệm permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Một vài khái niệm</h3>
<p>Chúng ta làm quen trước vài khái niệm của connection pooling:</p>
<ul>
<li><strong>Pool size</strong>: Kích thước của connection pool, dĩ nhiên không được vượt quá số lượng kết nối tối đa của DB rồi.</li>
<li><strong>Idle connection</strong>: Các connection “tạm nghỉ”, khi được sử dụng xong thì các idle connection không được release luôn, mà được ở lại trạng thái này.</li>
<li><strong>Connection lifetime</strong>: Đại loại là thời gian mà các connection "live", đạt ngưỡng này thì force close connection.</li>
</ul>
<blockquote>
<p>💡 Không có gì chắc chắn rằng các “idle connection” sẽ luôn luôn sống và không cần phải handshake lại với DB vì các lí do như timeout (thời gian đã set) hoặc do phía DB.
Do đó có thể vài thư viện thực hiện cơ chế ping liên tục bằng các idle connection để giữ tụi nó luôn luôn không bị close.
Dĩ nhiên thì làm vậy sẽ tốn resource hơn để quản lý.</p>
</blockquote>
<h3 id="dựng-database-postgres-va-data" style="position:relative;"><a href="#d%E1%BB%B1ng-database-postgres-va-data" aria-label="dựng database postgres va data permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dựng database postgres và data</h3>
<p>Tí nữa mình sẽ để repo benchmark ở cuối bài viết<sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup> cho nên code mẫu mình trình bày sẽ đại khái dưới dạng pseudo.</p>
<p>Bạn nào tò mò muốn thử có thể clone về thử, nhưng mình vẫn sẽ hướng dẫn từng bước mình làm cái benchmark này nhé.</p>
<p>Để chuẩn bị data cho bài test thì mình tạo 1 table <strong>products</strong> như sau:</p>
<div class="gatsby-highlight" data-language="sql"><pre class="language-sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> products <span class="token punctuation">(</span>
    id <span class="token keyword">SERIAL</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    price <span class="token keyword">NUMERIC</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    description <span class="token keyword">TEXT</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Sau đó lên <a href="https://mockaroo.com/">mockaroo</a> để tạo 1000 dòng data:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/418d5a0de17d85ba489bb2357503d3e2/d4377/mockaroo-mock-data.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 37.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAyklEQVQoz4WRyQ6EMAxD+f8fBQlKWbqwHDJ6kVzNMAcOVuI2cZy2u67LzvM04n3fLQpP/obuOA5b19VSSt5MzDl7Xmuxbdus1mrUMfgN3b7v3kQDiDHa0Pe2p+TnYJ5nW5blZwvhyTscTdPUXMwh2DiOxqBvaChRWwDxJphzcgesLYdw7EuslOIOqYGTu/MYXZS+JggJIdgwDF6EEG6fb6MN9Ik6k1B7Q4qYim25EZiunGKi6iT29ykIUgRBgBzQrE9BQPc605Cn4AccJm0dv5oUqQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/418d5a0de17d85ba489bb2357503d3e2/c85cb/mockaroo-mock-data.webp 300w,
/static/418d5a0de17d85ba489bb2357503d3e2/e88ff/mockaroo-mock-data.webp 600w,
/static/418d5a0de17d85ba489bb2357503d3e2/92f8c/mockaroo-mock-data.webp 1200w,
/static/418d5a0de17d85ba489bb2357503d3e2/9447f/mockaroo-mock-data.webp 1294w"
              sizes="(max-width: 1200px) 100vw, 1200px"
              type="image/webp"
            />
          <source
            srcset="/static/418d5a0de17d85ba489bb2357503d3e2/5a46d/mockaroo-mock-data.png 300w,
/static/418d5a0de17d85ba489bb2357503d3e2/0a47e/mockaroo-mock-data.png 600w,
/static/418d5a0de17d85ba489bb2357503d3e2/c1b63/mockaroo-mock-data.png 1200w,
/static/418d5a0de17d85ba489bb2357503d3e2/d4377/mockaroo-mock-data.png 1294w"
            sizes="(max-width: 1200px) 100vw, 1200px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/418d5a0de17d85ba489bb2357503d3e2/c1b63/mockaroo-mock-data.png"
            alt="Mock product mockaroo"
            title="Mock product mockaroo"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>Sau khi download về, mình có copy paste lại 1000 dòng thành hơn mấy chục nghìn dòng dữ liệu.</p>
<p>Để tạo 1 database postgres trên máy, cách nhanh nhất là mình dùng docker:</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3.9"</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">postgres</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> postgres<span class="token punctuation">:</span>13.1<span class="token punctuation">-</span>alpine
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> postgres_container
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./seed.sql<span class="token punctuation">:</span>/docker<span class="token punctuation">-</span>entrypoint<span class="token punctuation">-</span>initdb.d/seed.sql
      <span class="token punctuation">-</span> ./data/postgres<span class="token punctuation">:</span>/var/lib/postgresql/data
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> POSTGRES_DB=$<span class="token punctuation">{</span>POSTGRES_DB<span class="token punctuation">:</span><span class="token punctuation">-</span>postgres<span class="token punctuation">}</span>
      <span class="token punctuation">-</span> POSTGRES_USER=$<span class="token punctuation">{</span>POSTGRES_USER<span class="token punctuation">:</span><span class="token punctuation">-</span>postgres<span class="token punctuation">}</span>
      <span class="token punctuation">-</span> POSTGRES_PASSWORD=$<span class="token punctuation">{</span>POSTGRES_PASSWORD<span class="token punctuation">:</span><span class="token punctuation">-</span>password1<span class="token punctuation">}</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"5433:5432"</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</code></pre></div>
<p>Theo kế hoạch thì những bài tiếp theo của series này, mình sẽ nói về docker, nếu bạn chưa hiểu docker là gì, thì đón đọc những bài tiếp theo nhé. Phần hiện tại bạn chỉ cần biết nó là công cụ để mình tạo 1 database postgres là được.</p>
<p>Okay, chạy dòng lệnh <code class="language-text">docker compose up -d</code> để có 1 database có sẵn data. DB này có port 5433, username và password như file yaml. (Chọn port 5433 tại vì sợ nó conflict với DB có sẵn trên máy mình thôi)</p>
<p>Chuyển qua phần tiếp theo</p>
<h3 id="dựng-api-bằng-go" style="position:relative;"><a href="#d%E1%BB%B1ng-api-b%E1%BA%B1ng-go" aria-label="dựng api bằng go permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dựng API bằng Go</h3>
<p>Mình đang code Go, cho nên mình sẽ chọn Go để làm API cho ví dụ benchmark (sử dụng Gin framework, 1 framework nhẹ và mạnh mẽ).</p>
<p>Tương tự với DDL products bên trên, mình có model Product:</p>
<div class="gatsby-highlight" data-language="go"><pre class="language-go"><code class="language-go"><span class="token keyword">type</span> Product <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	ID          <span class="token builtin">int</span>     <span class="token string">`json:"id"`</span>
	Name        <span class="token builtin">string</span>  <span class="token string">`json:"name"`</span>
	Price       <span class="token builtin">float64</span> <span class="token string">`json:"price"`</span>
	Description <span class="token builtin">string</span>  <span class="token string">`json:"description"`</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Tương tự tạo 1 model response của API, có chứa thêm 2 field để mình estimate thời gian của request:</p>
<div class="gatsby-highlight" data-language="go"><pre class="language-go"><code class="language-go"><span class="token keyword">type</span> Response <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Elapsed  <span class="token builtin">int64</span>      <span class="token string">`json:"elapsed"`</span>
	Average  <span class="token builtin">float64</span>    <span class="token string">`json:"average"`</span>
	Products <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Product <span class="token string">`json:"products"`</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Kế tiếp, khai báo query để select 1000 product từ DB cũng như connection string cho DB.</p>
<p>Sau đó nữa, tạo 1 connection Pool, 1 singleton connection để dùng cho 3 endpoint như idea mình đã nêu phía trên:</p>
<div class="gatsby-highlight" data-language="go"><pre class="language-go"><code class="language-go"><span class="token keyword">var</span> dsn <span class="token operator">=</span> <span class="token string">"postgres://postgres:password1@localhost:5433/postgres?sslmode=disable"</span>
<span class="token keyword">var</span> query <span class="token operator">=</span> <span class="token string">"SELECT id, name, price, description FROM products limit 1000"</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// Postgres allows 100 connections in default</span>
	<span class="token comment">// Set the maximum number of idle connections in the pool</span>
	idleConn <span class="token operator">:=</span> <span class="token number">50</span>
	<span class="token comment">// Set the maximum number of connections in the pool</span>
	maxConnections <span class="token operator">:=</span> <span class="token number">90</span>
	<span class="token comment">// Set the maximum amount of time a connection can be reused</span>
	maxConnLifetime <span class="token operator">:=</span> <span class="token number">2</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Minute
	poolConn<span class="token punctuation">,</span> err <span class="token operator">:=</span> sqlx<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">"postgres"</span><span class="token punctuation">,</span> dsn<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"Unable to connect to database: %v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> poolConn<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	poolConn<span class="token punctuation">.</span><span class="token function">SetMaxOpenConns</span><span class="token punctuation">(</span>maxConnections<span class="token punctuation">)</span>
	poolConn<span class="token punctuation">.</span><span class="token function">SetMaxIdleConns</span><span class="token punctuation">(</span>idleConn<span class="token punctuation">)</span>
	poolConn<span class="token punctuation">.</span><span class="token function">SetConnMaxLifetime</span><span class="token punctuation">(</span>maxConnLifetime<span class="token punctuation">)</span>

	<span class="token comment">// normal connection</span>
	conn<span class="token punctuation">,</span> err <span class="token operator">:=</span> sqlx<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">"postgres"</span><span class="token punctuation">,</span> dsn<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"Unable to connect to database: %v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// default will be 2 idle connections</span>
	<span class="token comment">// so set it to 1 to simulate</span>
	conn<span class="token punctuation">.</span><span class="token function">SetMaxIdleConns</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

	<span class="token comment">// Initialize the HTTP router</span>
	router <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	router<span class="token punctuation">.</span><span class="token function">StaticFile</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token string">"./index.html"</span><span class="token punctuation">)</span>

	<span class="token comment">// Handlers...</span>

	<span class="token comment">// Start the HTTP server</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> router<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">":8080"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"Unable to start HTTP server: %v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Ở đây mình chọn thư viện <code class="language-text">sqlx</code>, thư viện này nếu chúng ta tạo 1 connection singleton, thì mặc định nó đã bật chế độ connection pool rồi, do đó mình set số lượng về 1 để giả lập tình trạng không có pool ở các ngôn ngữ và thư viện khác.</p>
<p>Về phần pool, mình cài đặt pool size là 90, và số lượng idle connection là 50, một con số khá lớn, và lifetime là 2 phút.</p>
<p>Rồi, chúng ta thêm 3 endpoint với method <code class="language-text">GET</code>:</p>
<ul>
<li><code class="language-text">products/pooled</code> : Sử dụng <strong>connection pool</strong>.</li>
<li><code class="language-text">products/normal</code> : Sử dụng một <strong>singleton connection</strong> cho toàn bộ request.</li>
<li><code class="language-text">products/new</code>: Thành lập <strong>1 kết nối mới</strong> cho mọi request.</li>
</ul>
<p>Bạn có thể thấy, behavior của 3 endpoint này giống nhau hoàn toàn, trừ việc sử dụng connection tới database thôi.</p>
<div class="gatsby-highlight" data-language="go"><pre class="language-go"><code class="language-go">router<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/products/normal"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		startTime <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

		<span class="token comment">// Query the database for all products</span>
		rows<span class="token punctuation">,</span> err <span class="token operator">:=</span> conn<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span><span class="token string">"error"</span><span class="token punctuation">:</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>
		products<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">scanProducts</span><span class="token punctuation">(</span>rows<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span><span class="token string">"error"</span><span class="token punctuation">:</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>
		elapsed <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>startTime<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Microseconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		allCount<span class="token operator">++</span>
		allTime <span class="token operator">+=</span> elapsed
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> model<span class="token punctuation">.</span>Response<span class="token punctuation">{</span>Elapsed<span class="token punctuation">:</span> elapsed<span class="token punctuation">,</span> Average<span class="token punctuation">:</span> <span class="token function">float64</span><span class="token punctuation">(</span>allTime <span class="token operator">/</span> allCount<span class="token punctuation">)</span><span class="token punctuation">,</span> Products<span class="token punctuation">:</span> products<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/products/pooled"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		startTime <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token comment">// Query the database for all products</span>
		rows<span class="token punctuation">,</span> err <span class="token operator">:=</span> poolConn<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span><span class="token string">"error"</span><span class="token punctuation">:</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>
		products<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">scanProducts</span><span class="token punctuation">(</span>rows<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span><span class="token string">"error"</span><span class="token punctuation">:</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>
		elapsed <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>startTime<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Microseconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		poolCount<span class="token operator">++</span>
		poolTime <span class="token operator">+=</span> elapsed
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> model<span class="token punctuation">.</span>Response<span class="token punctuation">{</span>Elapsed<span class="token punctuation">:</span> elapsed<span class="token punctuation">,</span> Average<span class="token punctuation">:</span> <span class="token function">float64</span><span class="token punctuation">(</span>poolTime <span class="token operator">/</span> poolCount<span class="token punctuation">)</span><span class="token punctuation">,</span> Products<span class="token punctuation">:</span> products<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/products/new"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		startTime <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		conn<span class="token punctuation">,</span> err <span class="token operator">:=</span> sqlx<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">"postgres"</span><span class="token punctuation">,</span> dsn<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"Unable to connect to database: %v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

		rows<span class="token punctuation">,</span> err <span class="token operator">:=</span> conn<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span><span class="token string">"error"</span><span class="token punctuation">:</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>
		products<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">scanProducts</span><span class="token punctuation">(</span>rows<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span><span class="token string">"error"</span><span class="token punctuation">:</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>
		elapsed <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>startTime<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Microseconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		newCount<span class="token operator">++</span>
		newTime <span class="token operator">+=</span> elapsed
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> model<span class="token punctuation">.</span>Response<span class="token punctuation">{</span>Elapsed<span class="token punctuation">:</span> elapsed<span class="token punctuation">,</span> Average<span class="token punctuation">:</span> <span class="token function">float64</span><span class="token punctuation">(</span>newTime <span class="token operator">/</span> newCount<span class="token punctuation">)</span><span class="token punctuation">,</span> Products<span class="token punctuation">:</span> products<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>Xong phía backend, qua code chút HTML để test phía browser nào:</p>
<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>getProducts('normal')<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Get Products<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>getProducts('new')<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Get Products | New<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>getProducts('pooled')<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    Get Products | Connection Pool
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">function</span> <span class="token function">getProducts</span><span class="token punctuation">(</span><span class="token parameter">mode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> lastResult <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> promises <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">200</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        promises<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
          <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/products/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>mode<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=></span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> elapsed<span class="token punctuation">,</span> average<span class="token punctuation">,</span> products <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
              lastResult <span class="token operator">=</span> <span class="token punctuation">{</span> elapsed<span class="token punctuation">,</span> average <span class="token punctuation">}</span><span class="token punctuation">;</span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> elapsed<span class="token punctuation">,</span> average <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Last result for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>mode<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> lastResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre></div>
<p>Code này rất đơn giản, với mỗi lần nhấn button, thì mình sẽ dùng promise chạy bất đồng bộ 200 request tới endpoint tương ứng.</p>
<h3 id="kết-quả-test-benchmark" style="position:relative;"><a href="#k%E1%BA%BFt-qu%E1%BA%A3-test-benchmark" aria-label="kết quả test benchmark permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Kết quả test benchmark</h3>
<p>Bấm chạy chương trình, và chúng ta có 3 button với response của mỗi request có 1000 product, response nặng khoảng <strong>86.53</strong> KB.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1066px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/68d364d0b3c080e5d0f3aaa6b793bfd2/2e367/browser-test-1.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 87.33333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAADz0lEQVQ4y5WT3WsdRRjG948QtGg1WAt6p6AognRvilB762VvvFL0xlv/A6lbogSLhhZEUNIkFdukmMSkTRObk5ycNjn9SDXfabPn7J7d2Z2d3ZnZmd15ZDfB1gsvHPjxzrzM+/DO8LzWuy+eGXjnpc/wVt/HeP3oR3iz71O88fIZvHLkFPqeef8/Of7saRx/7hReff4DvHbkQ7z9wud47+gnA9b01PzZZuMuGrdWRGNhRbdaa3p1ZV3faa3r5uKabi4+PGTtX3G5+VAvLtzVzcYD3VhYEUuLbUxOzJ+1uMgcHCwFwOD/L3NYCyEyx+r5PceUBlprhRKgguFie7Tmx/tXMLg6gsHVYfz0YAyDq5fq/YX2CM7f+Rlu4tdyVW2lUWlZhJCnO4SBQSAihDIGkRGIJAjrSP/JhyJGTxBoU+DpWkJCx3LdjiOlBOdcZVkGzgWUVMi5RMoByoFc6PqsZRVz6FzXd6SQUEpXqDzP4XmeY7Xb95xeGKHrB4pEFBURTUAIQZgIhEyBZRyMMfAsRRgGCIIA3a4H3++BsRSERCqOY2xsbDiWu7vh6CwCJFUwElAMmicIQoIwDBGREEnC6s6DtARheS1e5WJKkSsFmeeqKEp0ul3H+uKXSeeb6x30T/dU/2yCL6dCjLZCZJSAJQz1N2QZsjQFyxQyntdnzg/yWmsUWiutFLxKcGD6mjP9wMON+6Fa2Ba4+VeC1ibBlsfgUgqRF+CqBNclhC4gVIUBz8uaLC+QCq0ixrGz5zrW/Nq0w5IeVFo9WQM6w67P8PUcx1ezAb5vZLgwl+LCHMPFmwyDf2Ton4vx7a0M55+gvluUcCb2Heu3lQnH9TvwvJ4SUiGKE1BK4ScKa12FPwOBcDMFX6Ng9xKsuwm2Ix9SAVIbiApVqrwAXC9wrCutX519z61MqWSuENMELKEIUo3NQGGXCrBHHHqTQW6mCPZTuDQClRmMOfCtMab2YRCGjjV2+6qz7+3D9/xK0MQxNZTGxmfabATK7MTSxI+4ETupEVupCR8Ls02ICTgzeQGTF8bIwihlgE4vcKzJ9oTTIz1EJFZKFybNuOFZaigvzV6kjcuk4R1pyj1uWJebKGKG59qoUpvDOTZPJoU41uzt2XP7HRfdTreMY4qu54OEAbxYYMMT2AopensJ8vUI4Q7D444HQlMkIq38B6VU5cVS66KalHPW5aHLx65eGTs5NHTpxPj4NXtoaNgeuzpmT84u2CMTDXt46ro9MTZnN4ev27+Pzts/3Bi3byzM2Kuttt1sLtlLSzUnlpeXT87MzBz7G3CUo1GzzSFSAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/68d364d0b3c080e5d0f3aaa6b793bfd2/c85cb/browser-test-1.webp 300w,
/static/68d364d0b3c080e5d0f3aaa6b793bfd2/e88ff/browser-test-1.webp 600w,
/static/68d364d0b3c080e5d0f3aaa6b793bfd2/fbb05/browser-test-1.webp 1066w"
              sizes="(max-width: 1066px) 100vw, 1066px"
              type="image/webp"
            />
          <source
            srcset="/static/68d364d0b3c080e5d0f3aaa6b793bfd2/5a46d/browser-test-1.png 300w,
/static/68d364d0b3c080e5d0f3aaa6b793bfd2/0a47e/browser-test-1.png 600w,
/static/68d364d0b3c080e5d0f3aaa6b793bfd2/2e367/browser-test-1.png 1066w"
            sizes="(max-width: 1066px) 100vw, 1066px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/68d364d0b3c080e5d0f3aaa6b793bfd2/2e367/browser-test-1.png"
            alt="Trang chu api"
            title="Trang chu api"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>Để duy trì tính ổn định cho bài test, mỗi lần chạy benchmark 1 endpoint, mình sẽ restart app để app reset lại connection pool.</p>
<p>Đầu tiên chúng ta thử với endpoint <code class="language-text">/products/new</code> , nơi mà connection sẽ được tạo mới lại 200 lần, sau khi bấm nút, thì sau chưa tới 100 request đã bị lỗi:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1066px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/d2434b81f25fb3fde41924f4a481ed99/2e367/browser-2-new.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 87.33333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAADaklEQVQ4y5XRTY/bRBgHcH8IJKigsKJUghtIIBAS6l4qpMKVYy+cQHDhc1TuqRKHAicEEoUL4kBB7VJU2N0m2Zdkk+zmZWPHsWPH8cTvM57xzB/FWUpW0AMj/TSPNPP8NS/a289fv/XWC5/ijY2P8OrFD/H6xid47cXreOnCNWw89e4TXX76fVx+5hpefvY9vHLhA7z53Gd45+LHt7R7vz68UdtpYefPA7qzfSAaja44POiL/UZf1Ha7orZ7fKZ7bq7XjsXudkvUdjpiZ/uAPtpt4pe7D29oOc10rAYHoPD/hzrrBaWZrvkzX1dSQQjBlQQimuCr5g+Vr9s/4ovDO5VvOj/h9uF3uH14B182v8fn+9/CiWdV3KpXYZmlEULWTwhAIqALBCz8Bw1BWASfEsyXazSsaiFLrPcGQaBrjjPVKWPI84yTVICkEgXlKHIGTvkKW1FCQjAOyUsIJlAUHCzNwPKcc87heZ6uHR219cUihO/7PIgYSFoiSlIQQhDHCaI4RpplcF0PljXByDAwsW0Yhomp6yLyA/jejAdkgZOTnq55rquTTMCLS+7FDCRfYJYo+NnySvLxy0spURRFRXCB5YlKIUCSAuY05k7A0Bu7ukaCue6nJexIcXNB4SQ+rIWEFXkoSgEoBbX0hC8OogJDO+FWwDGwg+Uvz/R5XMANBbdJDjf2YRMON5qBi7NAKc+RZVm9o+IlSEhhOjGfBgxDa6ZrtmHqljnF3A743AkQTiYIxh4C20M2J+AphaIF5BoehSgMgmJEELo+PHPGA4fAHJi6Njru6cOjLqKByZPRBEnvFFF3gKhvgDoeRJxBnpODTh1ku2OkfxhITBPx6YRnpgO7faJrg1ZHP6nvIen2edYfIen0EDW71cwmbhVShsljMkyRWSaSewPEP/eQng6RDQxOT8dwmm1dGxwtA/cRrwJV3O6pqNlVcaen2MRVMs5UGSZrUpVZY5XcH6j4bk8lw6FK+wbP/w4cdU70/n4TaX/E6chSy9D0eKCyvqGKqV8Fyihdkynq2Cr9faTS+6cqH48VNSacjR3Yra6uWeb4ZhonKHIqC8qwQlGwtfo/sCgDi/JqH6dMspziqN29qW09eHCp2WpdrTUaV2qN+uZKY/N8/W/15l6lVq9vPmrUrzT29q5u/bZ16S/Rqa0pN4iUDQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/d2434b81f25fb3fde41924f4a481ed99/c85cb/browser-2-new.webp 300w,
/static/d2434b81f25fb3fde41924f4a481ed99/e88ff/browser-2-new.webp 600w,
/static/d2434b81f25fb3fde41924f4a481ed99/fbb05/browser-2-new.webp 1066w"
              sizes="(max-width: 1066px) 100vw, 1066px"
              type="image/webp"
            />
          <source
            srcset="/static/d2434b81f25fb3fde41924f4a481ed99/5a46d/browser-2-new.png 300w,
/static/d2434b81f25fb3fde41924f4a481ed99/0a47e/browser-2-new.png 600w,
/static/d2434b81f25fb3fde41924f4a481ed99/2e367/browser-2-new.png 1066w"
            sizes="(max-width: 1066px) 100vw, 1066px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/d2434b81f25fb3fde41924f4a481ed99/2e367/browser-2-new.png"
            alt="API NEW"
            title="API NEW"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>Đây chính là error message:</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json">error	<span class="token string">"pq: sorry, too many clients already"</span></code></pre></div>
<p>Đấy, chưa gì mới vậy thôi mà DB đã chửi rồi.</p>
<p>Thời gian trung bình của request ở endpoint này là khoảng: <strong>6380</strong> micro seconds ~ <strong>6.3ms</strong></p>
<p>Tiếp tục với nút normal, nơi mà sử dụng singleton connection cho mọi request, <code class="language-text">/products/normal</code>:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1066px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/a912421d941e99588b708218ad22d071/2e367/browser-3-normal.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 87.33333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAADAUlEQVQ4y52ST4scRRiH+0MENGh0MQb0pqAYBElfghBz9ZiLJyW5+DlC5xTwEPUkCkYv4kUlLITgzk7vzPTsJrvZBJNZd6b/bHdXT1dXd3VVddVPumfc7ErExBceuujq9+H3VrX1/iuXrp999QreXfkUb536BO+sXMbbr13C6ycvYOXEh//KmRcu4syLF/DGSx/hzZMf472XP8cHpz67bt367c5Vt7eF3u8e7615ajDYUWPvoRoNHip3fUe56/eX7Bx7brj31fralnJ726q35vH++iZ+/eXOVavipYNFSQAGz19m2QvOS8eKD2LHaAOllDQayHmBrzd/7Pjm3k/4cnyz49vtn3Fj/D1ujG/iq80f8MXoO/j0oNMteg1al0UIOZoQgEbKM6T1/Al8DlLniDlB0u7xebdWpvk7Ytebpqlj+X7g1HWNqiolYQqEaQguIaoakssF9QKjNFQtoWWDRiiIWkBK1SWUUiKKIse6e/eek2XzNq5Mco5WmlMGQggoLZBTClaWCMMI+/tTPJ5MMJ3NMNnbQxAEoEX7bSbTlGB394FjRWHokLJBRLWMaA3CM0SFQVxlaNpDXZbWGkKIDqUU2kRNo0BojYlPpU9qPPgzdCySJk5aNgiplrN5jYilmM0bhEUM2TSAMTBLnlYZFdgLmfQziUd+6lhJEh8K/bzGASMI8laYLIU4FP6TdpMcEf4xS44L24QhixHkGj5NIJR8NmHApE+WwjSJuzPshPliZD9vEP3fhEeFi5HTbmSfxhCN+k9h9jRhWmqE1MhZLkzIDkxItfFpbGSjFl3dzbSO49W+J1SYVhi0l7IQJg4pBMK5kH5WmpDGJqTGzPLcMMmN0o2plTaykUv5cVrhJGBySiR29xPHmk6n16qyBGNMs6IAKyswLlBUEkVVdeRljZKXEEJ2/99RyqoGLbjOGYe3vXvNWl1dPe2Nx+eHo9E5z/Ps0WhoewPX9oZ92xsMO8bDDXs0GNmu27dd1z2k33ft4WDDHnuDc1ve8Pzt1Vun/wIHDL1fwZ8mbwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/a912421d941e99588b708218ad22d071/c85cb/browser-3-normal.webp 300w,
/static/a912421d941e99588b708218ad22d071/e88ff/browser-3-normal.webp 600w,
/static/a912421d941e99588b708218ad22d071/fbb05/browser-3-normal.webp 1066w"
              sizes="(max-width: 1066px) 100vw, 1066px"
              type="image/webp"
            />
          <source
            srcset="/static/a912421d941e99588b708218ad22d071/5a46d/browser-3-normal.png 300w,
/static/a912421d941e99588b708218ad22d071/0a47e/browser-3-normal.png 600w,
/static/a912421d941e99588b708218ad22d071/2e367/browser-3-normal.png 1066w"
            sizes="(max-width: 1066px) 100vw, 1066px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/a912421d941e99588b708218ad22d071/2e367/browser-3-normal.png"
            alt="API normal"
            title="API normal"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>Okay, ngon nghẻ không bị lỗi request nào hết.</p>
<p>Thời gian request trung bình là: 5704 micro seconds ~ 5.7ms</p>
<p>Chúng ta tới với trùm cuối <code class="language-text">/products/pooled</code>:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1066px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/afb480db3839bd5243569e986a48e468/2e367/browser-4-pooling.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 87.33333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAAC/0lEQVQ4y52S0YvcRBzH80cIWrR6WAv1TUFRBGleilB99bEvPin64t9R0qeCD1WfRMHqi/iiUg5K8fY23d3krr3rtah73m42u0kmyWQmk8xk5ivJrtdbrVT9wYcZZvh95svMWG88e+nq6899hFc33sdLp9/DKxsf4uXnL+GFUxex8cRb/8jZJ9/B2acu4tzTb+PFU+/itWc+xpunP7hq3fjp1mW3t4vez57obXlqMNhXvvdAjQYPlLu9r9zteyv218bb7j21vbWr3N6e6m15or+9gx9/uHXZKgV3sCwJwOC/l1n1QgjuWNEicow2UEpJo4FcFPh859uOL+5+h0/96x1f7n2Pa/7XuOZfx2c73+CT0VcI6KLTLXsNWpdFCDmZEIBGIlIkVfYQkYFUOSJBELd7IuvmyjR/Rux6kyRxrCCYOVVVoSy5JEyBMI1aSNRlBSnkkmqJURqqktCyQVMr1FUNKVWXUEqJ+XzuWHfu3HXSNGvjyjgXaKU5ZUgIAaUFckrBOEcYznF0NMFv4zEm0ynGh4eYzWagBQMhqUwSgoOD+441D0OH8AZzquWcVshEgZA2ICKFPvFEWmvUdd2hlEKbqGkUCK0wDqgMSIX7v4eORZLYSXiDkGo5yQQWLMckk4hYBNUYGPOQR1VKaxyGTAapxK9B4lhxHB0Lg7xCzDMEeYM5iyEbDZh16foBBuSE8Jdp/HdhxNOlsIggm+bfCWdMBmQlTOKou8NWOM0rLFh6nFD9n4Rrwkwg4jmmmUK0EprHCNNHCROuEVIjp3ltFjw1QdaYBYuM0nrZ1cVsHevVrhNam1Y4ax9lKYwdUtQIs1pOCTOLIjVBbsysyEwpayMbbSqljdRqJV+nFY5nTE6IxMFR7FiTyeRKyTkYY7poPzHjYKJGUUoUZYmiFKBcgAve/b2/wssKtBA6ZwLe3sEVa3Nz84zn+xeGo9F5z/ft0WhoewPX9oZ92xu284HtDwf2aDC0+27fdl33mH7ftYeD27bvDc7vesMLNzdvnPkDiHy9pCkmfWgAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/afb480db3839bd5243569e986a48e468/c85cb/browser-4-pooling.webp 300w,
/static/afb480db3839bd5243569e986a48e468/e88ff/browser-4-pooling.webp 600w,
/static/afb480db3839bd5243569e986a48e468/fbb05/browser-4-pooling.webp 1066w"
              sizes="(max-width: 1066px) 100vw, 1066px"
              type="image/webp"
            />
          <source
            srcset="/static/afb480db3839bd5243569e986a48e468/5a46d/browser-4-pooling.png 300w,
/static/afb480db3839bd5243569e986a48e468/0a47e/browser-4-pooling.png 600w,
/static/afb480db3839bd5243569e986a48e468/2e367/browser-4-pooling.png 1066w"
            sizes="(max-width: 1066px) 100vw, 1066px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/afb480db3839bd5243569e986a48e468/2e367/browser-4-pooling.png"
            alt="API Pooling"
            title="API Pooling"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>Kinh chưa? Không fail lần nào.</p>
<p>Con số ấn tượng: 1034 microseconds ~ <strong>1.03ms</strong></p>
<h3 id="benchmark-hardcore-hơn" style="position:relative;"><a href="#benchmark-hardcore-h%C6%A1n" aria-label="benchmark hardcore hơn permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Benchmark hardcore hơn</h3>
<p>Bạn có thể thấy con số khá ấn tượng của connection pool khi chúng ta chạy dồn dập 200 request bằng javascript. Tuy nhiên để giả lập tình huống thực tế lúc server nhận hàng ngàn concurrent request, mình sẽ sử dụng 1 công cụ khác để benchmark: go-wrk.</p>
<p>Công cụ này giúp benchmark / stress test mạnh mẽ hơn, hỗ trợ config thời gian chạy bench, số goroutine chạy đồng thời, con số này tỉ lệ thuận với số lượng request cùng gửi đi trong 1 thời điểm.</p>
<p>Cài đặt:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">go <span class="token function">install</span> github.com/tsliwowicz/go-wrk@latest</code></pre></div>
<p>Command benchmark có dạng: <code class="language-text">go-wrk -c &lt;số goroutine&gt; -d &lt;số giây&gt; &lt;url&gt;</code> . Mặc định sẽ chạy 10 giây.</p>
<p>Config đầu tiên của mình: Chạy trong vòng <strong>10 giây</strong>, với <strong>20 goroutine</strong> (bạn có thể tạm hiểu goroutine là 1 thread).</p>
<p><strong>Test endpoint <code class="language-text">/products/new</code></strong></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token number">100</span> requests <span class="token keyword">in</span> <span class="token number">185</span>.685138ms, <span class="token number">8</span>.46MB <span class="token builtin class-name">read</span>
Requests/sec:           <span class="token number">538.55</span>
Transfer/sec:           <span class="token number">45</span>.56MB
Avg Req Time:           <span class="token number">37</span>.137027ms
Fastest Request:        <span class="token number">12</span>.724131ms
Slowest Request:        <span class="token number">58</span>.512859ms
Number of Errors:       <span class="token number">29433</span></code></pre></div>
<p>Theo kết quả bạn có thể thấy ngoài tốc độ phản hồi bị tăng đáng kể tới mức 37ms, và số lượng request bị fail do hết connection cũng tới gần 30k. Hầu như chỉ có thể xử lý được 100 request, ngang bằng số lượng connection tối đa mặc định của DB.</p>
<p>Okay, reset lại app và test endpoint tiếp theo.</p>
<p><strong>Test endpoint <code class="language-text">/products/normal</code></strong></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">Running 10s <span class="token builtin class-name">test</span> @ http://localhost:8080/products/normal
  <span class="token number">20</span> goroutine<span class="token punctuation">(</span>s<span class="token punctuation">)</span> running concurrently
<span class="token number">9358</span> requests <span class="token keyword">in</span> <span class="token number">10</span>.00261655s, <span class="token number">791</span>.59MB <span class="token builtin class-name">read</span>
Requests/sec:           <span class="token number">935.56</span>
Transfer/sec:           <span class="token number">79</span>.14MB
Avg Req Time:           <span class="token number">21</span>.37768ms
Fastest Request:        <span class="token number">2</span>.44047ms
Slowest Request:        <span class="token number">102</span>.748343ms
Number of Errors:       <span class="token number">0</span></code></pre></div>
<p>Nếu chúng ta sử dụng phương pháp singleton connection, chỉ cho phép 1 idle connection thì không hề có 1 request nào bị lỗi, trong 10 giây thu được 9358 request, phản hồi với thời gian 21ms.</p>
<p><strong>Test endpoint <code class="language-text">/products/pooled</code></strong></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token number">20</span> goroutine<span class="token punctuation">(</span>s<span class="token punctuation">)</span> running concurrently
<span class="token number">17010</span> requests <span class="token keyword">in</span> <span class="token number">9</span>.98895932s, <span class="token number">1</span>.41GB <span class="token builtin class-name">read</span>
Requests/sec:           <span class="token number">1702.88</span>
Transfer/sec:           <span class="token number">144</span>.04MB
Avg Req Time:           <span class="token number">11</span>.744808ms
Fastest Request:        <span class="token number">1</span>.576952ms
Slowest Request:        <span class="token number">84</span>.103652ms
Number of Errors:       <span class="token number">0</span></code></pre></div>
<p>Đỉnh chứ, thời gian phản hồi nhanh gấp đôi phương pháp singleton, và cũng xử lý được tới 17k request trong vòng 10 giây.</p>
<p>Tuy nhiên mình vẫn muốn hà hiếp cái API này thêm chút nữa, hãy tăng độ khó cho game bằng việc tăng số lượng goroutine lúc bench lên 200!</p>
<p>Bạn có thể đoán được kết quả rồi đấy!</p>
<p><strong>Test endpoint <code class="language-text">/products/new</code></strong></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token number">100</span> requests <span class="token keyword">in</span> <span class="token number">51</span>.987238ms, <span class="token number">8</span>.46MB <span class="token builtin class-name">read</span>
Requests/sec:           <span class="token number">1923.55</span>
Transfer/sec:           <span class="token number">162</span>.71MB
Avg Req Time:           <span class="token number">103</span>.974476ms
Fastest Request:        <span class="token number">48</span>.576556ms
Slowest Request:        <span class="token number">126</span>.737139ms
Number of Errors:       <span class="token number">24624</span></code></pre></div>
<p>Thời gian phản hồi tăng đáng kể!</p>
<p><strong>Test endpoint <code class="language-text">/products/normal</code></strong></p>
<p>Em này có vẻ cũng không kham nổi số lượng request đồng thời đó!</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token number">8206</span> requests <span class="token keyword">in</span> <span class="token number">7</span>.75374229s, <span class="token number">694</span>.15MB <span class="token builtin class-name">read</span>
Requests/sec:           <span class="token number">1058.33</span>
Transfer/sec:           <span class="token number">89</span>.53MB
Avg Req Time:           <span class="token number">188</span>.977389ms
Fastest Request:        <span class="token number">2</span>.688429ms
Slowest Request:        <span class="token number">965</span>.145213ms
Number of Errors:       <span class="token number">3171</span></code></pre></div>
<p><strong>Test endpoint <code class="language-text">/products/pooled</code></strong></p>
<p>Cuối cùng vẫn phải để chụy gánh, với connection pool, chỉ có 15 request bị fail</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token number">16792</span> requests <span class="token keyword">in</span> <span class="token number">10</span>.005117575s, <span class="token number">1</span>.39GB <span class="token builtin class-name">read</span>
Requests/sec:           <span class="token number">1678.34</span>
Transfer/sec:           <span class="token number">141</span>.97MB
Avg Req Time:           <span class="token number">119</span>.165287ms
Fastest Request:        <span class="token number">2</span>.598255ms
Slowest Request:        <span class="token number">1</span>.004313542s
Number of Errors:       <span class="token number">15</span></code></pre></div>
<p>Thống kê lại một chút cho các bạn dễ hình dung:</p>
<div class="table-wrapper">
<table>
<thead>
<tr>
<th><strong>Concurent req</strong></th>
<th><strong>/products/new</strong></th>
<th><strong>/products/normal</strong></th>
<th><strong>/products/pooled</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>20 gouroutine</strong></td>
<td>37ms<br />100 req</td>
<td>21ms<br />9k req</td>
<td>11ms<br />17k req</td>
</tr>
<tr>
<td><strong>200 goroutine</strong></td>
<td>103ms<br />100 req<br />24k failed</td>
<td>188ms<br />8k req<br />3k failed</td>
<td>119ms<br />16k req<br />15 failed</td>
</tr>
</tbody>
</table>
</div>
<p>Các bạn có thể thấy, hiệu năng khi sử dụng connection pooling thể hiện rõ ràng nhất khi mình tăng số lượng request đồng thời. Bên cạnh đó số lượng request bị lỗi cũng sẽ giảm đi.</p>
<p>Tuy nhiên đánh đổi điều đó là các request sẽ phải wait lâu hơn 1 chút xíu để đợi connection từ pool.</p>
<h3 id="config-connection-pool-như-thế-nao-cho-hợp-ly" style="position:relative;"><a href="#config-connection-pool-nh%C6%B0-th%E1%BA%BF-nao-cho-h%E1%BB%A3p-ly" aria-label="config connection pool như thế nao cho hợp ly permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Config connection pool như thế nào cho hợp lý?</h3>
<p>Khi chúng ta cài đặt các thông số như số lượng kết nối nghỉ, thời gian timeout, số lượng kết nối tối đa (pool size) bla bla, thì chúng ta cũng phải thiết lập sao cho:</p>
<ul>
<li>Không lãng phí tài nguyên</li>
<li>Không cài quá thấp, dẫn đến không tăng hiệu năng được bao nhiêu.</li>
</ul>
<p>Mình cũng có tìm hiểu về vấn đề này, thực chất con số tối đa connection là 90 mình thiết đặt ở phần code phía trên có vẻ là quá mức cần thiết.
Bạn có thể thấy, chỉ với 1 connection duy nhất mà option <code class="language-text">/normal</code> cũng đã xử lý được 8k req, bằng 1 nửa so với 90 connection của mình.</p>
<p>Mình đã kiểm tra lại với số lượng tối đa idle connection và max connection là 4, ngang bằng với số core vật lý của máy mình.</p>
<p>Kết quả đúng như mình nghĩ, không khác nhiều so với con số 50 và 90.</p>
<p>Nếu deploy lên server, thì nên thiết đặt số kết nối tối đa bé hơn hoặc bằng số lượng core/ thread của server nhé.</p>
<h2 id="kết-luận" style="position:relative;"><a href="#k%E1%BA%BFt-lu%E1%BA%ADn" aria-label="kết luận permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Kết luận</h2>
<p>Túm cái váy lại thì connection pooling là một kỹ thuật giúp tăng hiệu suất, giảm tỉ lệ request bị lỗi.
Kĩ thuật này rất hữu ích với các hệ thống backend có lượng request đồng thời lớn, do đó sẽ rất tốt nếu anh em hiểu rõ và nắm vứng nó.</p>
<p>Happy coding!</p>

      <div class="footnotes">
        <hr/><strong>References:</strong>
        <ol >
    
    <li class="footnote-list-item" id="fn-1" >
          
        
      <a href="#fnref-1" class="footnote-backref" style="display:inline;text-decoration: none;">
        ↩
      </a>
    <p class="footnote-paragraph" style="display:inline; margin-left: 5px;"><a href="https://www.postgresql.org/docs/current/protocol-flow.html">Wire protocol Postgresdb</a></p>
      </li>
      
    

    <li class="footnote-list-item" id="fn-2" >
          
        
      <a href="#fnref-2" class="footnote-backref" style="display:inline;text-decoration: none;">
        ↩
      </a>
    <p class="footnote-paragraph" style="display:inline; margin-left: 5px;">Github Repo: <a href="https://github.com/kienmatu/go-connection-pooling-test">go-connection-pooling-test</a></p>
      </li>
      
    </ol></div></section><footer class="postStyle__PostFooter-sc-1q9n7ky-9 kGeBkw"><p>Published under <span><a class="postStyle__FooterTagLink-sc-1q9n7ky-10 bsOVgh" href="/tag/backend/">Backend</a>, </span><span><a class="postStyle__FooterTagLink-sc-1q9n7ky-10 bsOVgh" href="/tag/web/">Web</a>, </span><span><a class="postStyle__FooterTagLink-sc-1q9n7ky-10 bsOVgh" href="/tag/go/">Go</a></span> on<!-- --> <time dateTime="2023-03-29T15:06:30.504Z">29 March, 2023</time>.</p><p>Last updated on<!-- --> <time dateTime="2023-04-09T10:06:30.504Z">29 March, 2023</time>.</p></footer><div class="style__LinkedPostWrapper-sc-cu5n11-0 tpqNJ"><div class="style__PrevPost-sc-cu5n11-2 jKVyMT"><a class="style__LinkedPost-sc-cu5n11-1 llMcQV" href="/fake-data-trong-lap-trinh-va-testing/"><div class="sublabel">Previous</div><div class="label">Fake data trong lập trình và testing</div></a></div><div class="style__NextPost-sc-cu5n11-3 bnRGLe"><a class="style__LinkedPost-sc-cu5n11-1 llMcQV" href="/golang-slice-tat-tan-tat-va-nhung-dieu-co-the-ban-chua-biet/"><div class="sublabel">Next</div><div class="label">Slice trong Go: Tất tần tật, và những điều có thể bạn chưa biết</div></a></div></div><div class="comments__PostComment-sc-188g6ow-0 cEXXiX"><div></div></div></article></div></div><section class="postStyle__PostAddition-sc-1q9n7ky-11 hnKtRH"><div class="common__Container-sc-yvdkhc-0 postStyle__PostAdditionContent-sc-1q9n7ky-12 hhzXsP bIQtHU"><div class="postStyle__BioWrapper-sc-1q9n7ky-13 cXvylF"><section class="bio__StyledBio-sc-cy4lz8-0 buiIfq"><div class="avatar__StyledAvatar-sc-1b55w7o-0 iLbeUa gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:110px;height:110px"><img aria-hidden="true" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFlUlEQVQ4y2WSaVCTVxSGb6gz+kccq1QFlVo7tI7TqTp16lJFVGRRkAARWcWxuIKKYtWyBUWEqSgKHRFks0QWBQoKuGIBQVQIGMISwhISCCQioCxVvu+7b+cL2v7oj3vvzL3nfc57zrkk2VZMrtmEkyQbseDKphDCrwuWp02i1586GvnTLw/CVgdpT608yh5bEcAEfH9Is3/pgbu7Lfz2eS7abSwy30VcFvoIHEw9BY5mnsTB1JOQVPsIkmwrFqTYRZCr1mE80P/SxmB99LqTCFkWgGPf7MURi304uNgPuxf4YJe5L3Zb+MHr6z1q0UIfb+F8L7JuhjPZNs9DYD/XnZAU+whBxtazRLIt0ihxS/jNhC1hiFkVhHOrg5gbhxLZ8tTH9HF6CS1NKqTFCcVcjPtvjMdCH0Zk5oUdi3yx3cwrXjjfmyydYke2zvMgJM4qmCTZikmKXcTNJDsxYtecmPjj53iuV67G2Og7mn7tIvXfI6J73e1obEQQHdD3U/nTZgRanWQdZrsxwgXesJ/rHse7czD1NCI3tkXyyz9921nErzs1URwmoRzHAQCNOHGYrlhshmUWi2E+xwTGnxEEHvSj/NvYyDjCROeozUxXdqupJ6xN3ETWJm6EZDtFmUi2R+mTNoUi71Aix7GsATY8OARXG0usXWKODUu/hO/ab+G4/Cus+WE53gwMGGJGh0exd3Ugu3mmK7bM2alYY+w8lWQLzx/NdDyH6zbhjFamMgSyEwx/IjMhChHeG5F2RIhkfyekHhHi1wPeGBx+C3DU4PRpUQ02zXBhrL9ww4ZZop0k1yX6QfoWMYqD0nhrlHIcH4iJ8RFUSS7g9vn9yD/rh4wT7rgTE4DbIb4YVCkNCSnlKMuw1G/tcWb9dCGsZu/IJLdcY7QpViGQ3nhiyPixZDAfPqCx4DKeJgTgfvR+FAV74kmMH8pi/DE+qDfEsMxke+KOJXGrpzrAysStngey1zcEQ3FP+hHI8ZtBoGuXIl/shsxAF1z3s0VOkCM0supJdxz3L/DmxXz645StPHCUBzIGYGndf0BK+XIMwuf5l1AY7oE/gz2QH+6F8XdD/wNKYvM+Ad/yQE3qxhDUpj3iPgEnFZOHtCQJBWdFyDnthKzjdmguLzA88SP59L1iD19l10wzlPyS5DpH382wEaPoSDLzEWPo4/vxEcgaXqL61gXkhjoiN9QZt4O3o7rgGirLH4GdGAfHsXRs5G/qu/IwY2nszA8llf82+ySO55BsHc50VMjBcGN0dEiLfnUzqsqK0C6rQGnCMTy4sh+yhxlQyGrwtOwu3o/qKccO0WelVdT6cxG72cQNVrNETiTH6byxxClKnWgZjKrkQnZ0VIOBXgUd7G+n/d1ydDTVoLn2IaSPcyB/8QjdbbXoU7fQQb2KDg+ooNO0Mj4rDsByunNDliTPiKRuDCMZ9me80x0joaqXMnptC9V2ytCnklFdTwvV97RC3VYHZeMzaDpeoaeriT55UEgV8hd43avghvRKTuwTCQtiabOArCLkdX+7QFFRQ/IDfo/XqVrR1VLDttQ9Znkn/d1NVKduphqllL7WttE3ui56/04ubW2soT2dMqZPJef6VE34q6AkdEDbSli214g8Ty0SpAjjSJ7wEhnSq+I0bXWoLcuDUlbJC5i+bjmn7ZJTnaaVDr1WsT1dcv6e7eloQL+6BdrOptDkMwmk8t4dQc7lbEIq4m4RafZ9AQCi62kkGoV0R3VpVpuivhy9na/ACzVKKbSqRmhVct412hur0dXysqG/W2Gr0zSTJeQ7QdalLBIXGE9I65NqoqqTksaSCqLpeGmkUdSRrNiYaU01j9zl1aUSZX15fZf8xbhaUT+ibKisVb6qSmuoLHW6fDzKqK+7hWi7Gox6lArS29FKtJ3N5B8YTTI10y3oBAAAAABJRU5ErkJggg==" alt="Kiên Đinh" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source srcset="/static/5e09b7dc046a8972547b7e2d01e32a28/3b7ca/logo.png 1x,
/static/5e09b7dc046a8972547b7e2d01e32a28/085e0/logo.png 1.5x,
/static/5e09b7dc046a8972547b7e2d01e32a28/1efc4/logo.png 2x" /><img loading="lazy" width="110" height="110" srcset="/static/5e09b7dc046a8972547b7e2d01e32a28/3b7ca/logo.png 1x,
/static/5e09b7dc046a8972547b7e2d01e32a28/085e0/logo.png 1.5x,
/static/5e09b7dc046a8972547b7e2d01e32a28/1efc4/logo.png 2x" src="/static/5e09b7dc046a8972547b7e2d01e32a28/3b7ca/logo.png" alt="Kiên Đinh" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><h3 class="bio__AuthorName-sc-cy4lz8-2 HeSmV">Kiên Đinh</h3><p class="bio__AuthorDescription-sc-cy4lz8-1 iEPaOA">Bần đạo là <strong>Kiên Đinh</strong>, một Developer. 
            Ta viết blog này với mục đích chia sẻ những kinh nghiệm của bản thân đối với <b>coding chi đạo</b>. </p><ul class="social-channel-list__StyledSocialChannels-sc-hb4cd6-0 eWZpEr"><li class="social-channel-list__StyledSocialChannel-sc-hb4cd6-1 dIYGZM"><a href="https://www.facebook.com/kien.matu.7" target="_blank" rel="noopener" aria-label="facebook"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" color="#4267b2" style="color:#4267b2" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"></path></svg></a></li><li class="social-channel-list__StyledSocialChannel-sc-hb4cd6-1 dIYGZM"><a href="https://www.linkedin.com/in/kiendinh-dev/" target="_blank" rel="noopener" aria-label="linkedin"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" color="#0077b5" style="color:#0077b5" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a></li><li class="social-channel-list__StyledSocialChannel-sc-hb4cd6-1 dIYGZM"><a href="https://viblo.asia/u/kiendev" target="_blank" rel="noopener" aria-label="viblo"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M136.6 138.79a64.003 64.003 0 0 0-43.31 41.35L0 460l14.69 14.69L164.8 324.58c-2.99-6.26-4.8-13.18-4.8-20.58 0-26.51 21.49-48 48-48s48 21.49 48 48-21.49 48-48 48c-7.4 0-14.32-1.81-20.58-4.8L37.31 497.31 52 512l279.86-93.29a64.003 64.003 0 0 0 41.35-43.31L416 224 288 96l-151.4 42.79zm361.34-64.62l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.75 18.75-49.15 0-67.91z"></path></svg></a></li><li class="social-channel-list__StyledSocialChannel-sc-hb4cd6-1 dIYGZM"><a href="https://www.youtube.com/channel/UCnq0iZ1X0udszc7ODV9uK4g" target="_blank" rel="noopener" aria-label="youtube"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" color="#ff0000" style="color:#ff0000" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path></svg></a></li><li class="social-channel-list__StyledSocialChannel-sc-hb4cd6-1 dIYGZM"><a href="https://github.com/kienmatu" target="_blank" rel="noopener" aria-label="github"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></li></ul></section></div></div></section></main><footer class="style__StyledFooter-sc-1bbyksd-0 hNmZFn"><div class="common__Container-sc-yvdkhc-0 style__FooterContainer-sc-1bbyksd-1 hhzXsP kRFmqs"><nav class="style__StyledNav-sc-1bbyksd-4 hCiwIZ"><ul><li><a class="style__FooterMenuLink-sc-1bbyksd-6 RdnGO" href="/about-me/">About me</a></li></ul></nav><div><p class="style__Copyright-sc-1bbyksd-2 eFaQjI"><strong>Dev Giang Hồ - Blog for Devs</strong> © <!-- -->2023</p><p class="style__DesignBy-sc-1bbyksd-3 hFClol"><a href="https://devgiangho.github.io" title="devgiangho">devgiangho</a><br/>Icons made by <a href="https://www.flaticon.com/authors/dinosoftlabs" title="DinosoftLabs">DinosoftLabs</a> from <a href="https://www.flaticon.com/" title="Flaticon">Flaticon</a></p></div></div></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/connection-pooling-tong-quan-va-implement-benchmark/";window.___webpackCompilationHash="1c6bb7eec23aea065acd";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-d5ab38783296e1c773b0.js"],"app":["/app-3d56a7e927d0e18cd127.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-dac1e2e8f46e2904c1f4.js"],"component---src-pages-archive-tsx":["/component---src-pages-archive-tsx-d17a542145ac54c73b71.js"],"component---src-pages-tags-tsx":["/component---src-pages-tags-tsx-3316aecd1d08b21d3d21.js"],"component---src-templates-page-tsx":["/component---src-templates-page-tsx-6bc8dea0877c1c99ae09.js"],"component---src-templates-post-tsx":["/component---src-templates-post-tsx-3cdd1abe5df6730423e9.js"],"component---src-templates-posts-tsx":["/component---src-templates-posts-tsx-f9246684225265d50d3d.js"],"component---src-templates-tag-tsx":["/component---src-templates-tag-tsx-7523085417102b9ac221.js"]};/*]]>*/</script><script src="/polyfill-d5ab38783296e1c773b0.js" nomodule=""></script><script src="/app-3d56a7e927d0e18cd127.js" async=""></script><script src="/framework-bd9150bcf9e535dfa7fa.js" async=""></script><script src="/webpack-runtime-2e0adcb081d9c1d7a8b7.js" async=""></script></body></html>